import{r as g,j as e,L as y,c as S}from"./app-Dyd-VK-i.js";import{u as $}from"./useTranslation-C1duoCZq.js";import{F as h}from"./file-text-D0lOMtzR.js";import{U as N}from"./users-CaGv18Zi.js";import{C as w}from"./chevron-up-3B5JPPo2.js";import{C as q}from"./chevron-down-BdiW-nc9.js";import{C as E}from"./calendar-CWDjbzSs.js";import{R as M}from"./refresh-cw-51J-93ua.js";import{C as F}from"./circle-alert-C3TtVEnV.js";import{C as T}from"./circle-x-DY3We9RK.js";import{C as D}from"./clock-CiSfxGeq.js";import{S as I}from"./send-C6E11V_I.js";import{C as R}from"./circle-check-big-BEvmm_V7.js";import{S as U}from"./square-pen-Cmebj4O1.js";import{T as B}from"./trash-2-xd5U0av9.js";import"./createLucideIcon-CMta4jpe.js";const ae=({data:l,groupedData:i=[],companyId:Q})=>{const{t:s}=$(),[p,f]=g.useState("table"),[o,C]=g.useState(null),[_,d]=g.useState(null),[x,u]=g.useState(null),n=t=>!t&&t!==0?s("quotation_table.currency_format",{amount:0}):new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),j=t=>t?new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):s("quotation_table.not_available"),c=t=>{const a="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(t?.toLowerCase()){case"accepted":case"approved":return e.jsxs("span",{className:`${a} bg-green-100 text-green-800`,children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),s("quotation_table.status_accepted")]});case"sent":return e.jsxs("span",{className:`${a} bg-blue-100 text-blue-800`,children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),s("quotation_table.status_sent")]});case"pending":case"draft":return e.jsxs("span",{className:`${a} bg-yellow-100 text-yellow-800`,children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),s(t==="draft"?"quotation_table.status_draft":"quotation_table.status_pending")]});case"rejected":case"cancelled":return e.jsxs("span",{className:`${a} bg-red-100 text-red-800`,children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),s(t==="rejected"?"quotation_table.status_rejected":"quotation_table.status_cancelled")]});case"expired":return e.jsxs("span",{className:`${a} bg-gray-100 text-gray-800`,children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),s("quotation_table.status_expired")]});case"revised":return e.jsxs("span",{className:`${a} bg-orange-100 text-orange-800`,children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),s("quotation_table.status_revised")]});default:return e.jsx("span",{className:`${a} bg-gray-100 text-gray-800`,children:t||s("quotation_table.status_unknown")})}},m=({text:t,maxLength:a=30,className:r=""})=>t?t.length<=a?e.jsx("span",{className:r,children:t}):e.jsxs("span",{className:`${r} cursor-help truncate`,onMouseEnter:()=>d(t),onMouseLeave:()=>d(null),title:t,children:[t.substring(0,a),"..."]}):e.jsx("span",{className:r,children:s("quotation_table.not_available")}),v=t=>{C(o===t?null:t)},b=async(t,a)=>{if(window.confirm(s("quotation_table.confirm_delete",{number:a}))){u(t);try{S.delete(route("quotation.destroy",t),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{console.log("Delete successful"),u(null),page.props.flash?.success&&alert(page.props.flash.success)},onError:r=>{console.error("Delete error:",r),u(null),r&&r.message?alert(s("quotation_table.delete_error")+": "+r.message):alert(s("quotation_table.delete_error"))},onFinish:()=>{console.log("Delete request finished")}})}catch(r){console.error("Error in delete function:",r),alert(s("quotation_table.delete_error")),u(null)}}},k=({quotation:t})=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-3 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(h,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:t.quotation_number}),t.lead?.company_name&&e.jsxs("p",{className:"text-xs text-gray-500",children:[s("quotation_table.lead"),": ",t.lead.company_name]})]})]}),e.jsx("p",{className:"text-xs text-gray-600",children:e.jsx(m,{text:t.subject,maxLength:40})})]}),c(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s("quotation_table.date")}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:j(t.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s("quotation_table.amount")}),e.jsx("p",{className:"text-sm font-bold text-gray-900 cursor-help",onMouseEnter:()=>d(n(t.total)),onMouseLeave:()=>d(null),children:n(t.total)})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{href:route("quotation.edit",t.id),className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-yellow-50 text-yellow-700 rounded-lg hover:bg-yellow-100 transition-colors text-sm",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:s("quotation_table.edit")})]}),e.jsxs("button",{onClick:()=>b(t.id,t.quotation_number),disabled:x===t.id,className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm disabled:opacity-50",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:x===t.id?s("quotation_table.deleting"):s("quotation_table.delete")})]})]})]}),L=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s("quotation_table.no_quotations_found")}),e.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:s("quotation_table.no_quotations_message")})]});return e.jsxs("div",{children:[_&&e.jsx("div",{className:"fixed z-50 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-lg",children:_}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:s("quotation_table.quotation_list")}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:s("quotation_table.quotation_count",{count:l.length,leadCount:i.length,pluralQuotation:l.length!==1?"s":"",pluralLead:i.length>1?"s":""})})]}),i.length>0&&l.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 hidden sm:block",children:[s("quotation_table.view"),":"]}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>f("table"),className:`px-3 py-1 text-sm flex items-center space-x-1 ${p==="table"?"bg-gray-200":"bg-white hover:bg-gray-50"}`,children:[e.jsx(h,{className:"w-3 h-3"}),e.jsx("span",{children:s("quotation_table.view_all")})]}),e.jsxs("button",{onClick:()=>f("grouped"),className:`px-3 py-1 text-sm flex items-center space-x-1 ${p==="grouped"?"bg-gray-200":"bg-white hover:bg-gray-50"}`,children:[e.jsx(N,{className:"w-3 h-3"}),e.jsx("span",{children:s("quotation_table.view_by_lead")})]})]})]})]}),l.length===0&&e.jsx(L,{}),e.jsx("div",{className:"sm:hidden",children:l.length>0&&e.jsx(e.Fragment,{children:p==="grouped"&&i.length>0?e.jsx("div",{className:"space-y-3",children:i.map(t=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>v(t.lead_id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.lead_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s("quotation_table.quotation_count_simple",{count:t.count,plural:t.count>1?"s":""})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c(t.latest_status),o===t.lead_id?e.jsx(w,{className:"w-4 h-4 text-gray-500"}):e.jsx(q,{className:"w-4 h-4 text-gray-500"})]})]})}),o===t.lead_id&&e.jsx("div",{className:"border-t border-gray-200",children:t.quotations.map((a,r)=>e.jsxs("div",{className:`p-4 hover:bg-gray-50 ${r!==t.quotations.length-1?"border-b border-gray-100":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-4 h-4 text-gray-400"}),e.jsx("h4",{className:"font-medium text-gray-900",children:a.quotation_number})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:j(a.date)})]}),c(a.status)]}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:s("quotation_table.subject")}),e.jsx("p",{className:"text-sm text-gray-900",children:e.jsx(m,{text:a.subject,maxLength:30})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s("quotation_table.total")}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:n(a.total)})]})]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsx(y,{href:route("quotation.edit",a.id),className:"flex-1 text-center px-3 py-1 bg-yellow-50 text-yellow-700 rounded text-xs hover:bg-yellow-100",children:s("quotation_table.edit")}),e.jsx("button",{onClick:()=>b(a.id,a.quotation_number),className:"flex-1 text-center px-3 py-1 bg-red-50 text-red-700 rounded text-xs hover:bg-red-100",children:s("quotation_table.delete")})]})]},a.id))})]},t.lead_id))}):e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsx(k,{quotation:t},t.id))})})}),e.jsx("div",{className:"hidden sm:block",children:l.length>0&&e.jsx(e.Fragment,{children:p==="grouped"&&i.length>0?e.jsx("div",{className:"space-y-4",children:i.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.lead_name}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s("quotation_table.quotation_count_simple",{count:t.count,plural:t.count>1?"s":""})}),e.jsx("span",{className:"text-sm text-gray-600",children:"â€¢"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 cursor-help",onMouseEnter:()=>d(n(t.total_value)),onMouseLeave:()=>d(null),children:n(t.total_value)})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[c(t.latest_status),e.jsx("button",{onClick:()=>v(t.lead_id),className:"text-gray-500 hover:text-gray-700",children:o===t.lead_id?e.jsx(w,{className:"w-4 h-4"}):e.jsx(q,{className:"w-4 h-4"})})]})]})}),o===t.lead_id&&e.jsx("div",{className:"bg-white",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.quotation_number")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.subject")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.amount")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.quotations.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-gray-900",children:a.quotation_number})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-gray-900",children:j(a.date)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(m,{text:a.subject,maxLength:50,className:"text-gray-900"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-gray-900 cursor-pointer transition-all duration-200 hover:bg-gray-100 rounded px-2 py-1",title:n(a.total),children:n(a.total)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:c(a.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(y,{href:route("quotation.edit",a.id),className:"text-yellow-600 hover:text-yellow-900",children:s("quotation_table.edit")}),e.jsx("button",{onClick:()=>b(a.id,a.quotation_number),className:"text-red-600 hover:text-red-900",disabled:x===a.id,children:x===a.id?s("quotation_table.deleting"):s("quotation_table.delete")})]})})]},a.id))})]})})]},t.lead_id))}):e.jsx("div",{className:"overflow-x-auto -mx-2",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm md:text-base",children:[e.jsx("thead",{className:"bg-[#e2e8f0]",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),s("quotation_table.quotation_number")]})}),e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),s("quotation_table.date")]})}),e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.subject")}),e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.lead")}),e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.amount")}),e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"status"}),e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("quotation_table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm md:text-base font-medium text-gray-900",children:t.quotation_number})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm md:text-base text-gray-900",children:j(t.date)})}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsx("div",{className:"max-w-[200px] lg:max-w-[300px]",children:e.jsx(m,{text:t.subject,maxLength:50,className:"text-sm md:text-base text-gray-900"})})}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsx("div",{className:"max-w-[150px]",children:e.jsx(m,{text:t.lead?.company_name||s("quotation_table.not_available"),maxLength:25,className:"text-sm md:text-base text-gray-900"})})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm md:text-base font-semibold text-gray-900 cursor-pointer transition-all duration-200 hover:bg-gray-100 rounded px-2 py-1",title:n(t.total),children:n(t.total)})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:c(t.status)}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(y,{href:route("quotation.edit",t.id),className:"text-yellow-600 hover:text-yellow-900 text-sm md:text-base",children:s("quotation_table.edit")}),e.jsx("button",{onClick:()=>b(t.id,t.quotation_number),className:"text-red-600 hover:text-red-900 text-sm md:text-base",disabled:x===t.id,children:x===t.id?s("quotation_table.deleting"):s("quotation_table.delete")})]})})]},t.id))})]})})})}),l.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 md:p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:s("quotation_table.total_quotations")}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900",children:l.length})]}),e.jsxs("div",{className:"bg-green-50 p-3 md:p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:s("quotation_table.total_leads")}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900",children:i.length||s("quotation_table.not_available")})]}),e.jsxs("div",{className:"bg-purple-50 p-3 md:p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:s("quotation_table.total_value")}),e.jsx("p",{className:"text-base md:text-lg font-bold text-gray-900 cursor-pointer transition-all duration-200 hover:bg-gray-100 rounded px-2 py-1",title:n(l.reduce((t,a)=>t+(a.total||0),0)),children:n(l.reduce((t,a)=>t+(a.total||0),0))})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 md:p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:s("quotation_table.accepted")}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900",children:l.filter(t=>t.status==="accepted"||t.status==="approved").length})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:s("quotation_table.status_breakdown")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["accepted","sent","pending","draft","rejected","expired"].map(t=>{const a=l.filter(r=>r.status===t).length;return a===0?null:e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-gray-100 rounded-full",children:[c(t),e.jsx("span",{className:"text-sm text-gray-700",children:a})]},t)})})]})]})]})};export{ae as default};
