import{r as i,j as e,u as J,c}from"./app-BTbkV42h.js";import{H as P,S as f}from"./HeaderLayout-BOd0q3W-.js";import{T as U}from"./TableLayout-C2tjGemz.js";import{P as W}from"./PrimaryButton-tLhKuWAj.js";import{D as z}from"./DeleteModal-DLmvQqP-.js";import{u as G}from"./useTranslation-CATg2OkV.js";import{S as K}from"./search-OnmWdDDk.js";import{C as V}from"./calendar-BTlTyD--.js";import{F as X}from"./funnel-CeWZDqFF.js";import{R as Y}from"./refresh-cw-c1U8ceJg.js";import"./transition-MPasdNlU.js";import"./settings-CdYEu26S.js";import"./createLucideIcon-DHxmSlVR.js";import"./send-stj9b7Y9.js";import"./globe-CiSLK2lF.js";import"./chevron-down-BBjuMcoq.js";import"./check-CMDYYhgh.js";import"./user-DWczQdUG.js";import"./x-bUU7PHNQ.js";import"./triangle-alert-851T3JNd.js";const C=(x,b="success")=>{f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:d=>{d.onmouseenter=f.stopTimer,d.onmouseleave=f.resumeTimer}}).fire({icon:b,title:x})};function ve({quotations:x,statusOptions:b,summary:y,years:d,filters:r,totals:p,auth_permissions:u}){const[D,g]=i.useState(!1),[j,v]=i.useState(null),[Z,N]=i.useState(null),{t:a}=G();u.can_read;const F=u.can_create===1,w=u.can_update===1,k=u.can_delete===1,$=[{key:"no",label:a("quotations.table.no_date"),render:(t,s)=>e.jsxs("div",{children:[e.jsx("a",{href:`/storage/${s.pdf_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 font-semibold hover:underline flex items-center gap-1",children:t}),e.jsx("div",{className:"text-gray-500 text-sm mt-1",children:new Date(s.date||"-").toLocaleDateString()})]})},{key:"subject",label:a("quotations.table.subject")},{key:"company_name",label:a("quotations.table.company_name"),render:(t,s)=>{const n=!!s.is_client;return e.jsx("span",{className:`font-medium ${n?"text-blue-600":"text-black"}`,children:s.lead?.company_name||t})}},{key:"contact",label:a("quotations.table.contact")},{key:"created_by",label:a("quotations.table.created_by")},{key:"total",label:a("quotations.table.total"),render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t}),e.jsx("div",{className:"text-red-500 text-xs font-semibold mt-0.5 text-right",children:a("quotations.table.ppn_total")})]})},{key:"status",label:a("quotations.table.status"),render:(t,s)=>{const n={sent:"border-blue-500 text-blue-700 bg-blue-50",accepted:"border-green-500 text-green-700 bg-green-50",expired:"border-orange-500 text-orange-700 bg-orange-50",rejected:"border-red-500 text-red-700 bg-red-50",draft:"border-gray-500 text-gray-700 bg-gray-50"},S=["expired"],H=o=>{const q=o.target.value;c.patch(route("quotation.update-status",s.id),{status:q},{preserveScroll:!0,onSuccess:()=>{C("Status updated to "+q.toUpperCase())},onError:()=>{C("Failed to update status","error")}})};if(S.includes(t)){const o=`text-xs font-bold py-1 px-2 rounded-lg border-2 ${n[t]||"border-gray-300"}`;return e.jsx("div",{className:"inline-flex items-center",children:e.jsx("span",{className:o,style:{backgroundImage:"none"},children:a(`quotations.stats.${t}`)})})}return e.jsx("select",{value:t,onChange:H,style:{backgroundImage:"none",WebkitAppearance:"none",MozAppearance:"none"},className:`appearance-none text-xs font-bold py-1 px-2 rounded-lg border-2 focus:ring-0 cursor-pointer transition-all ${n[t]||"border-gray-300"}`,children:Object.keys(n).filter(o=>!S.includes(o)).map(o=>e.jsx("option",{value:o,children:a(`quotations.stats.${o}`)},o))})}}],[l,h]=i.useState({search:r?.search||"",status:r?.status||"all",month:r?.month||"",year:r?.year||""});i.useEffect(()=>{h({search:r?.search||"",status:r?.status||"all",month:r?.month||"",year:r?.year||""})},[r]);const m=(t,s)=>{h(n=>({...n,[t]:s})),_(t,s)},I=()=>{L(route("quotation.index"),{preserveState:!0,preserveScroll:!0,replace:!0,data:{search:l.search,status:l.status!=="all"?l.status:"",month:l.month,year:l.year}})},A=()=>{const t={search:"",status:"all",month:"",year:""};h(t),_(t),c.get(route("quotation.index"),{},{replace:!0,preserveState:!1,preserveScroll:!0})},E=[{value:"",label:a("quotations.filters.all_months")},{value:"1",label:"Jan"},{value:"2",label:"Feb"},{value:"3",label:"Mar"},{value:"4",label:"Apr"},{value:"5",label:"May"},{value:"6",label:"Jun"},{value:"7",label:"Jul"},{value:"8",label:"Aug"},{value:"9",label:"Sep"},{value:"10",label:"Oct"},{value:"11",label:"Nov"},{value:"12",label:"Dec"}],T={sent:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200",icon:"⚡"},accepted:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",icon:"✅"},expired:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200",icon:"⏳"},rejected:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:"❌"}},M=x.data.map(t=>({id:t.id,no:t.quotation_number,date:t.date,subject:t.subject||"-",company_name:t.lead?.company_name||"-",contact:t.lead?.contact_person||"-",created_by:t.creator?.name||"Admin",total:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(t.total||0),status:t.status,pdf_path:t.pdf_path,is_client:t.is_client})),{data:ee,setData:_,get:L}=J({search:r?.search||"",status:r?.status||"all",month:r?.month||"",year:r?.year||""}),Q=t=>{t&&t.id?c.visit(`/quotation/edit/${t.id}`):console.error("Data quotation tidak memiliki ID",t)},R=t=>{v(t.id),N(t),g(!0)},B=()=>{j&&c.delete(route("quotation.destroy",j),{onSuccess:()=>g(!1)})},O=()=>{c.visit("/quotation/create")};return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:a("quotations.title")}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a("quotations.title")}),F&&e.jsxs(W,{onClick:O,className:"w-full sm:w-auto px-5 py-2.5 text-white text-sm font-medium rounded-lg hover:bg-[#004d47] transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:a("quotations.button_add")})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 my-7",children:Object.entries(T).map(([t,s])=>e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${s.border} ${s.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${s.text} uppercase tracking-wide`,children:a(`quotations.stats.${t}`)}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:y[t]||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(p&&p[t]?p[t]:0)})]}),e.jsx("div",{className:`p-3 rounded-full ${s.bg}`,children:s.icon?e.jsx("span",{className:"text-lg",children:s.icon}):e.jsx("div",{className:`w-3 h-3 rounded-full ${s.text.replace("text-","bg-")}`})})]})},t))}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.search_placeholder")}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:a("quotations.filters.search_placeholder"),value:l.search,onChange:t=>m("search",t.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:flex lg:space-x-4 gap-4",children:[e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.status")}),e.jsxs("select",{value:l.status,onChange:t=>m("status",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"all",children:a("quotations.filters.all_status")}),b?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.month")}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("select",{value:l.month,onChange:t=>m("month",t.target.value),className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:E.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"lg:w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.year")}),e.jsxs("select",{value:l.year,onChange:t=>m("year",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"",children:a("quotations.filters.all_years")}),(d||[]).map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{onClick:I,className:"px-4 py-2.5 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors justify-center text-sm font-medium",children:[e.jsx(X,{className:"w-4 h-4"}),a("quotations.filters.apply")]}),e.jsxs("button",{onClick:A,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 justify-center text-sm font-medium",children:[e.jsx(Y,{className:"w-4 h-4"}),a("quotations.filters.reset")]})]})]})}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsx(U,{data:M,columns:$,onEdit:w?Q:null,onDelete:k?R:null,showAction:w||k})})}),e.jsx(z,{show:D,onClose:()=>{g(!1),v(null),N(null)},onConfirm:B,title:"Delete Quotation",message:"Are you sure you want to delete quotation? This action cannot be undone."})]})]})}export{ve as default,C as toast};
