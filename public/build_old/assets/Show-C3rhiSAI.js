import{a as U,r as n,b as p,j as e,H as _,c as b}from"./app--V8YQuQk.js";import W from"./Sidebar-1SAmVSoF.js";import X from"./CompanyHeader-WNkeRZvN.js";import w from"./ProfileTable-Bwchz7U9.js";import z from"./QuotationTable-B5ett_m0.js";import B from"./InvoiceTable-C0PdqfrY.js";import G from"./PaymentTable-Cu1oJlfY.js";import K from"./ProjectTable-Dl4XPywT.js";import Q from"./ContactTable-BXlT4WE2.js";import{H as v}from"./HeaderLayout-Bk7u9NLn.js";import{u as J}from"./useTranslation-DGCn9e9S.js";import{T as V}from"./trash-2-D2TdDDoH.js";import"./building-2-USKoNIue.js";import"./createLucideIcon-D7A-7CJ7.js";import"./file-text-BkpdNTL0.js";import"./receipt-ByUYRvJl.js";import"./credit-card-C6jIzrGW.js";import"./folder-kanban-CFFfnrCP.js";import"./users-Ct2E2Ljn.js";import"./chevron-right-BPE1BH5F.js";import"./map-pin-DXTDSR7Y.js";import"./globe-DUm1N8J0.js";import"./mail-D6ZCm5oy.js";import"./phone-CEvMLKm6.js";import"./info-OEJ7xNNZ.js";import"./building-DXosBoce.js";import"./landmark-ot9IelP-.js";import"./calendar-Bfq9qOyj.js";import"./user-D9rdox91.js";import"./chevron-up-ZWC_-0h_.js";import"./chevron-down-DnOCgVxl.js";import"./refresh-cw-LPNXZfv2.js";import"./circle-alert-CxrL5ccl.js";import"./circle-x-BuWIVh8M.js";import"./clock-mQHhekFu.js";import"./send-BzvzPsAY.js";import"./circle-check-big-CeV7987U.js";import"./square-pen-HBgHTwPe.js";import"./x-DGqtnagE.js";import"./save-ChX0yG6a.js";import"./search-D65wTQHs.js";import"./check-BtXJC3Kt.js";import"./percent-CepjKhjp.js";import"./triangle-alert-tJvvQB1h.js";import"./ContactModal-BToqa-KD.js";import"./briefcase-BWAq_THx.js";import"./plus-D5prKAx_.js";import"./transition-D2W53CQ5.js";import"./index-DvGSOaWZ.js";import"./settings-B2fgqRwV.js";const Ve=({company:s,quotations:N,invoices:l,payments:y,projects:f,contacts:r,statistics:C,grouped_quotations:S})=>{const{props:E}=U(),{t}=J(),[c,T]=n.useState("profile"),[k,Y]=n.useState(!1),[D,h]=n.useState(!1),[d,m]=n.useState(null),[Z,P]=n.useState("create"),[L,x]=n.useState(r||[]),[q,g]=n.useState(!1);console.log("========== SHOW PAGE DATA =========="),console.log("Company:",s),console.log("Contacts data received:",r),console.log("Invoices data received:",l),console.log("Projects data:",f),console.log("==================================="),n.useEffect(()=>{p.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",p.defaults.withCredentials=!0;const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");a&&(p.defaults.headers.common["X-CSRF-TOKEN"]=a)},[]),n.useEffect(()=>{!s||!s.id?console.error("ERROR: Company data is missing!"):console.log("SUCCESS: Company data received:",{id:s.id,name:s.client_code,contact_person:s.contact_person,invoices_count:l?.length||0,contacts_count:r?.length||0}),r&&x(r)},[s,r,l]);const j=async()=>{if(s?.id){g(!0);try{const a=await p.get(`/companies/${s.id}/contacts`);console.log("Fetched contacts:",a.data),a.data.success?x(a.data.data):console.error("Failed to fetch contacts:",a.data.message)}catch(a){console.error("Error fetching contacts:",a),x(r||[])}finally{g(!1)}}};n.useEffect(()=>{c==="contact"&&s?.id&&j()},[c,s?.id]);const u=(a,O="success")=>{document.querySelectorAll(".custom-toast").forEach(F=>F.remove());const i=document.createElement("div");i.className=`custom-toast fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${O==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,i.innerHTML=`
            <div class="flex items-center">
                <span>${a}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                    ✕
                </button>
            </div>
        `,document.body.appendChild(i),setTimeout(()=>{i.parentElement&&i.remove()},3e3)},A=a=>{console.log("Editing project:",a),m(a),P("edit")},H=a=>{console.log("Deleting project:",a),m(a),h(!0)},I=()=>{d&&b.delete(route("projects.destroy",d.id),{preserveScroll:!0,onSuccess:()=>{h(!1),m(null),u(t("companies_show.project_deleted_successfully"),"success")},onError:()=>{u(t("companies_show.failed_to_delete_project"),"error")}})},M=()=>{console.log("Refreshing contacts data..."),j(),u(t("companies_show.contacts_updated_successfully"),"success")};if(!s||!s.id)return e.jsxs(v,{children:[e.jsx(_,{title:t("companies_show.error_title")}),e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("companies_show.company_not_found")}),e.jsx("p",{className:"text-gray-600 mb-6",children:t("companies_show.company_not_found_message")}),e.jsx("button",{onClick:()=>b.visit(route("companies.index")),className:"px-6 py-3 bg-[#054748] text-white rounded-lg hover:bg-[#0a5d5e] transition-colors font-medium",children:t("companies_show.back_to_companies_list")}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("companies_show.debug_info")}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t("companies_show.url"),": ",window.location.href,e.jsx("br",{}),t("companies_show.route"),": companies.show",e.jsx("br",{}),t("companies_show.received_props"),": ",Object.keys(E).join(", ")]})]})]})})]});const o={company:{...s,contact_person:s.contact_person||s.primary_contact?.name||t("companies_show.not_available"),contact_email:s.contact_email||s.primary_contact?.email||t("companies_show.not_available"),contact_phone:s.contact_phone||s.primary_contact?.phone||t("companies_show.not_available"),contact_position:s.contact_position||s.primary_contact?.position||t("companies_show.not_available")},statistics:C||{},quotations:N||[],invoices:l||[],payments:y||[],projects:f||[],contacts:L,grouped_quotations:S||[]},R=()=>{if(k)return e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#054748]"}),e.jsx("span",{className:"ml-3 text-gray-600",children:t("companies_show.loading_data")})]});switch(c){case"profile":return e.jsx(w,{data:o.company});case"quotation":return e.jsx(z,{data:o.quotations,groupedData:o.grouped_quotations,companyId:o.company.id});case"invoice":return e.jsx(B,{data:o.invoices,companyId:s.id});case"payment":return e.jsx(G,{data:o.payments,companyId:o.company.id,showInvoiceAmount:!0});case"project":return e.jsx(K,{data:o.projects,onEdit:A,onDelete:H});case"contact":return e.jsx(Q,{contacts:o.contacts,companyId:o.company.id,onUpdate:M,isLoading:q});default:return e.jsx(w,{data:o.company})}},$=()=>{switch(c){case"contact":return null;default:return null}};return e.jsxs(v,{children:[e.jsx(_,{title:`${o.company.client_code} - ${t("companies_show.detail_company")}`}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(W,{activeTab:c,setActiveTab:T})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"p-0",children:[s&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg mx-6 mt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:t("companies_show.success_loaded_company_data")}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[t("companies_show.viewing"),": ",e.jsx("span",{className:"font-bold",children:o.company.client_code})," |",t("companies_show.invoices"),": ",e.jsx("span",{className:"font-bold",children:o.invoices?.length||0})," |",t("companies_show.contacts"),": ",e.jsx("span",{className:"font-bold",children:o.contacts?.length||0})," |",t("companies_show.projects"),": ",e.jsx("span",{className:"font-bold",children:o.projects?.length||0})]})]})]})}),e.jsx("div",{className:"px-6",children:e.jsx(X,{company:o.company,activeTab:c,data:o,statistics:o.statistics})}),e.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow-sm border border-gray-100 mx-6 p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("div",{}),$()]}),R()]})]})})]}),D&&d&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t("companies_show.delete_project")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t("companies_show.action_cannot_undone")})]})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:t("companies_show.confirm_delete_project",{name:d.project_description})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{h(!1),m(null)},className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex-1",children:t("companies_show.cancel")}),e.jsx("button",{onClick:I,className:"px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex-1",children:t("companies_show.delete")})]})]})})})]})};export{Ve as default};
