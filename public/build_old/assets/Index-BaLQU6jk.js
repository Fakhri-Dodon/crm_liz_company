import{a as te,r as o,b as D,j as e,c as M}from"./app-DSAstNJH.js";import{H as le}from"./HeaderLayout-PFXXfuQf.js";import{T as ne}from"./TableLayout-DeF2PwM4.js";import{u as Z}from"./useTranslation-BTkknNM_.js";import{X as K}from"./x-D-I7aP1o.js";import{F as B}from"./file-text-DfBuK0ep.js";import{S as se}from"./search-DZZ_GgUd.js";import{C as re}from"./chevron-down-CC24HzTf.js";import{B as G}from"./building-CbxBv0Gq.js";import{U as ee}from"./user-QIOkK541.js";import{C as oe}from"./check-ZSv3oBxE.js";import{C as H}from"./circle-alert-DQBZZU21.js";import{B as ce}from"./briefcase-D0vxCb_E.js";import{M as ie}from"./mail-mtuYZD1U.js";import{P as de}from"./phone-ngFM6NGS.js";import{c as Y}from"./createLucideIcon-B1SYFIyP.js";import{M as me}from"./map-pin-xeeoYlc8.js";import{T as ae}from"./trash-2-CVjnwYw9.js";import{T as J}from"./triangle-alert-9alNtL-H.js";import{I as pe}from"./info-DbQY5_Wo.js";import{C as xe}from"./circle-check-big-yLdXT5kW.js";import{C as ue}from"./chevron-right-Ds5V5WBI.js";import{P as ge}from"./plus-Bdnms-js.js";import"./transition-CHb-6Grs.js";import"./settings-BO8HVa9i.js";import"./send-CNJV6gwc.js";import"./globe-DUEaYrgg.js";const he=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_e=Y("lock",he);const be=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],fe=Y("shield-alert",be);const je=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ye=Y("smartphone",je);const ve=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ne=Y("upload",ve),we=({isOpen:v,onClose:$,clientTypes:l,quotationId:j,onSuccess:w})=>{const{flash:n}=te().props,{t:s}=Z(),[a,c]=o.useState({company_name:"",client_type_id:"",contact_person:"",contact_email:"",contact_phone:"",contact_position:"",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,status:"active",quotation_id:j||"",lead_id:""}),[m,_]=o.useState({}),[R,A]=o.useState(!1),[T,O]=o.useState(null),[I,U]=o.useState([]),[F,S]=o.useState(!1),[C,P]=o.useState(null),[Q,y]=o.useState(""),[b,E]=o.useState(null),[X,f]=o.useState(!1);o.useEffect(()=>{D.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",D.defaults.withCredentials=!0;const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");r&&(D.defaults.headers.common["X-CSRF-TOKEN"]=r)},[]),o.useEffect(()=>{v&&(console.log("Modal opened..."),c({company_name:"",client_type_id:"",contact_person:"",contact_email:"",contact_phone:"",contact_position:"",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,status:"active",quotation_id:j||"",lead_id:""}),P(null),E(null),y(""),O(null),_({}),j?g(j):p())},[v,j]);const p=async()=>{S(!0);try{const r=await D.get("/companies/get-accepted-quotations");r&&r.data&&r.data.success?U(r.data.data||[]):U([])}catch(r){console.error("Error:",r),U([])}finally{S(!1)}},x=async r=>{P(r),E(null),c(u=>({...u,quotation_id:r.id,lead_id:r.lead?.id||"",company_name:r.lead?.company_name||u.company_name,contact_person:r.lead?.contact_person||u.contact_person,contact_email:r.lead?.email||u.contact_email,contact_phone:r.lead?.phone||u.contact_phone,contact_position:r.lead?.position||s("companies_create.contact_person")})),r.lead&&E(r.lead)},g=async r=>{if(r){f(!0);try{const u=await D.get(`/companies/get-lead-from-quotation/${r}`);if(u&&u.data&&u.data.success){const L=u.data.data;E(L),c(d=>({...d,quotation_id:r,lead_id:L.id||"",company_name:L.company_name||d.company_name,contact_person:L.contact_person||d.contact_person,contact_email:L.email||d.contact_email,contact_phone:L.phone||d.contact_phone,contact_position:L.position||s("companies_create.contact_person"),city:L.city||d.city,province:L.province||d.province,country:L.country||d.country,postal_code:L.postal_code||d.postal_code}))}}catch(u){console.error("Error:",u)}finally{f(!1)}}},k=()=>{P(null),E(null),c(r=>({...r,quotation_id:"",lead_id:"",company_name:"",contact_person:"",contact_email:"",contact_phone:"",city:"",province:"",country:"",postal_code:""})),y("")},q=I.filter(r=>{if(!Q)return!0;const u=Q.toLowerCase();return r.quotation_number?.toLowerCase().includes(u)||r.subject?.toLowerCase().includes(u)||r.lead?.company_name?.toLowerCase().includes(u)||r.lead?.contact_person?.toLowerCase().includes(u)}),h=r=>{const{name:u,value:L,type:d,files:t}=r.target;if(d==="file"){const i=t[0];if(c(N=>({...N,[u]:i})),i){const N=new FileReader;N.onloadend=()=>{O(N.result)},N.readAsDataURL(i)}else O(null)}else c(i=>({...i,[u]:L}));m[u]&&_(i=>({...i,[u]:null}))},W=async r=>{r.preventDefault(),A(!0),_({}),console.log("=== FORM SUBMISSION STARTED ==="),console.log("Form data before submit:",a);const u=new FormData;if(["company_name","client_type_id","contact_person","contact_email","contact_phone","status"].forEach(d=>{a[d]||_(t=>({...t,[d]:s("companies_create.field_required",{field:d.replace("_"," ")})}))}),Object.keys(m).length>0){A(!1);return}Object.entries(a).forEach(([d,t])=>{t!=null&&(d==="logo"&&t instanceof File?u.append("logo",t):t!==""&&u.append(d,t.toString()))}),a.contact_person&&u.append("name",a.contact_person),j&&!a.quotation_id&&u.append("quotation_id",j);try{console.log("Sending form data...");const d=await D.post("/companies",u,{headers:{"Content-Type":"multipart/form-data"}});console.log("Server response:",d),d&&d.data&&d.data.success?(alert(d.data.message||s("companies_create.client_created_successfully")),$(),c({company_name:"",client_type_id:"",contact_person:"",contact_email:"",contact_phone:"",contact_position:"",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,status:"active",quotation_id:"",lead_id:""}),P(null),E(null),O(null),w&&w(),M.reload({only:["companies","statistics"],preserveScroll:!0})):(_(d?.data?.errors||{}),alert(d?.data?.message||s("companies_create.failed_to_create_client")))}catch(d){if(console.error("Error creating client:",d),console.error("Error details:",d.response?.data),d.response?.status===422){_(d.response.data.errors||{});const t=Object.values(d.response.data.errors||{}).flat().join(`
`);t&&alert(s("companies_create.validation_errors")+`
`+t)}else alert(`${s("companies_create.error_creating_client")}: ${d.response?.data?.message||d.message}`)}finally{A(!1)}};return v?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("companies_create.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("companies_create.subtitle")}),j&&e.jsxs("div",{className:"mt-1 text-sm text-blue-600",children:[s("companies_create.creating_from_quotation"),": ",e.jsx("strong",{children:j})]})]}),e.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(K,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("form",{onSubmit:W,className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[!j&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),s("companies_create.select_from_quotation")]}),F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:s("companies_create.loading_quotations")})]}):e.jsx("div",{className:"space-y-3",children:C?e.jsx("div",{className:"bg-white border border-green-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-green-700",children:C.quotation_number}),e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded",children:s("companies_create.accepted")})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:C.subject}),C.lead&&e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("div",{className:"font-medium text-gray-700",children:C.lead.company_name})})]}),e.jsx("button",{type:"button",onClick:k,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(K,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:s("companies_create.search_quotations"),value:Q,onChange:r=>y(r.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:q.length>0?q.map(r=>e.jsx("div",{onClick:()=>x(r),className:"p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition last:border-b-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.quotation_number}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:r.subject}),r.lead&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:r.lead.company_name})]}),e.jsx(re,{className:"w-5 h-5 text-gray-400"})]})},r.id)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:s("companies_create.no_quotations_found")})})})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),s("companies_create.company_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.company_name")," *"]}),e.jsx("input",{type:"text",name:"company_name",value:a.company_name,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${m.company_name?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.company_name_placeholder")}),m.company_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.company_name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.client_type")," *"]}),e.jsxs("select",{name:"client_type_id",value:a.client_type_id,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${m.client_type_id?"border-red-300":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",children:s("companies_create.select_client_type")}),l&&l.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),m.client_type_id&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.client_type_id})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.city")}),e.jsx("input",{type:"text",name:"city",value:a.city,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.city_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.province")}),e.jsx("input",{type:"text",name:"province",value:a.province,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.province_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.country")}),e.jsx("input",{type:"text",name:"country",value:a.country,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.country_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.postal_code")}),e.jsx("input",{type:"number",name:"postal_code",value:a.postal_code,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.postal_code_placeholder")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.vat_number")}),e.jsx("input",{type:"number",name:"vat_number",value:a.vat_number,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.vat_number_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.nib")}),e.jsx("input",{type:"text",name:"nib",value:a.nib,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.nib_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.website")}),e.jsx("input",{type:"url",name:"website",value:a.website,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.website_placeholder")})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4",children:[e.jsx(ee,{className:"w-5 h-5"}),s("companies_create.contact_information")," *"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.contact_person")," *"]}),e.jsx("input",{type:"text",name:"contact_person",value:a.contact_person,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${m.contact_person?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.contact_person_placeholder")}),m.contact_person&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.contact_person})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.position")}),e.jsx("input",{type:"text",name:"contact_position",value:a.contact_position,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.position_placeholder")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.email")," *"]}),e.jsx("input",{type:"email",name:"contact_email",value:a.contact_email,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${m.contact_email?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.email_placeholder")}),m.contact_email&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.contact_email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.phone")," *"]}),e.jsx("input",{type:"tel",name:"contact_phone",value:a.contact_phone,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${m.contact_phone?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.phone_placeholder")}),m.contact_phone&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.contact_phone})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-6 border-t",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:[s("companies_create.status")," *"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"status",value:"active",checked:a.status==="active",onChange:h,className:"w-4 h-4 text-teal-600 focus:ring-teal-500",required:!0}),e.jsx("span",{className:"ml-2 text-gray-700",children:s("companies_create.active")})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"status",value:"inactive",checked:a.status==="inactive",onChange:h,className:"w-4 h-4 text-teal-600 focus:ring-teal-500"}),e.jsx("span",{className:"ml-2 text-gray-700",children:s("companies_create.inactive")})]})]}),m.status&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.status})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:s("companies_create.company_logo")}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-teal-500 transition",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",name:"logo",onChange:h,accept:"image/*",className:"w-full border border-gray-300 rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("companies_create.file_requirements")})]}),T&&e.jsx("div",{className:"w-16 h-16",children:e.jsx("img",{src:T,alt:s("companies_create.logo_preview"),className:"w-full h-full object-cover rounded-lg border border-gray-300"})})]})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:$,disabled:R,className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:s("companies_create.cancel")}),e.jsx("button",{type:"submit",disabled:R,className:`px-6 py-2 font-medium rounded-lg flex items-center gap-2 ${R?"bg-gray-400 text-white cursor-not-allowed":"bg-teal-700 hover:bg-teal-800 text-white"}`,children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s("companies_create.creating")]}):s("companies_create.create_client")})]})]})]})}):null},Ce=({isOpen:v,onClose:$,company:l,clientTypes:j,onUpdate:w})=>{const{t:n}=Z(),[s,a]=o.useState({company_name:"",client_type_id:"",status:"active",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,logo_preview:"",delete_logo:!1,contact_person:"",contact_email:"",contact_phone:"",contact_position:""}),[c,m]=o.useState({}),[_,R]=o.useState(!1),[A,T]=o.useState(null),[O,I]=o.useState(!1),[U,F]=o.useState(!1),[S,C]=o.useState(!1),P=o.useRef(!1);o.useEffect(()=>{D.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",D.defaults.withCredentials=!0;const f=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");f&&(D.defaults.headers.common["X-CSRF-TOKEN"]=f)},[]),o.useEffect(()=>((async()=>{if(!(!v||!l||j.length===0||P.current)){P.current=!0,C(!1),console.log("=== EDIT MODAL INITIALIZATION ==="),console.log("Full company data received:",l),console.log("Lead data:",l.lead),console.log("Primary contact:",l.primary_contact),console.log("Client Types available:",j);try{const p=l.company_name||l.lead?.company_name||l.client_code||l.name||"",x={contact_person:l.contact_person||l.primary_contact?.name||l.lead?.contact_person||"",contact_email:l.contact_email||l.email||l.primary_contact?.email||l.lead?.email||"",contact_phone:l.contact_phone||l.phone||l.primary_contact?.phone||l.lead?.phone||"",contact_position:l.contact_position||l.primary_contact?.position||l.lead?.position||""};console.log("Company Name resolved:",{fromProp:l.company_name,fromLead:l.lead?.company_name,fromClientCode:l.client_code,fromName:l.name,finalValue:p}),console.log("Contact data resolved:",x);const g={company_name:p,client_type_id:l.client_type_id||(j.length>0?j[0].id:""),status:l.is_active?"active":"inactive",city:l.city||"",province:l.province||"",country:l.country||"",postal_code:l.postal_code?.toString()||"",vat_number:l.vat_number?.toString()||"",nib:l.nib||"",website:l.website||"",logo:null,logo_preview:l.logo_url||"",delete_logo:!1,contact_person:x.contact_person,contact_email:x.contact_email,contact_phone:x.contact_phone,contact_position:x.contact_position};console.log("Form data to be set:",g),a(g);const k=x.contact_person||x.contact_email||x.contact_phone;F(!!k),!k&&l.id&&await Q(l.id,g),console.log("=== FORM INITIALIZED SUCCESSFULLY ===")}catch(p){console.error("Error during form initialization:",p)}finally{C(!0),P.current=!1}}})(),()=>{s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview)}),[v,l,j]);const Q=async(f,p)=>{I(!0);try{console.log("Fetching contact data from API for company:",f);const x=await D.get(`/api/companies/${f}/primary-contact`);if(x.data.success&&x.data.data){const g=x.data.data;console.log("Contact API data received:",g),a(k=>({...k,contact_person:g.name||"",contact_email:g.email||"",contact_phone:g.phone||"",contact_position:g.position||""})),F(!0)}else console.log("No contact data from API"),F(!1)}catch(x){console.error("Error fetching contact data:",x),F(!1)}finally{I(!1)}},y=f=>{const{name:p,value:x,type:g,checked:k,files:q}=f.target;if(p==="company_name"){console.log("Company name is read-only, ignoring change attempt");return}if(g==="radio")a(h=>({...h,[p]:x}));else if(g==="file"){const h=q[0];if(h){T(h);const W=URL.createObjectURL(h);a(r=>({...r,logo:h,logo_preview:W,delete_logo:!1}))}}else a(h=>({...h,[p]:x}));c[p]&&m(h=>({...h,[p]:null}))},b=()=>{s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview),a(f=>({...f,logo:null,logo_preview:"",delete_logo:!0})),T(null)},E=async f=>{f.preventDefault(),R(!0),m({});try{const p={company_name:s.company_name||"",client_type_id:s.client_type_id||"",status:s.status||"active",city:s.city||"",province:s.province||"",country:s.country||"",postal_code:s.postal_code&&parseInt(s.postal_code)||null,vat_number:s.vat_number&&parseInt(s.vat_number)||null,nib:s.nib||"",website:s.website||"",contact_person:s.contact_person||"",contact_email:s.contact_email||"",contact_phone:s.contact_phone||"",contact_position:s.contact_position||"",delete_logo:s.delete_logo?"1":"0"};console.log("=== SUBMITTING UPDATE DATA ==="),console.log("Company ID:",l.id),console.log("Company Name (read-only, for validation):",p.company_name),console.log("Client Code (will remain unchanged):",l.client_code),console.log("Full request data:",p);const x=new FormData;Object.keys(p).forEach(k=>{p[k]!==null&&p[k]!==void 0&&x.append(k,p[k])}),s.logo&&(x.append("logo",s.logo),console.log("Logo file appended:",s.logo.name));const g=await D.post(`/companies/${l.id}`,x,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"},params:{_method:"PUT"}});console.log("Server response:",g.data),g.data.success?(alert(g.data.message||n("companies_edit.client_updated_successfully")),s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview),w&&w(g.data.data||l.id),M.reload({only:["companies","statistics"],preserveScroll:!0}),$()):(console.error("Update failed:",g.data),m(g.data.errors||{}),alert(g.data.message||n("companies_edit.failed_to_update_client")))}catch(p){if(console.error("Error updating client:",p),p.response?.status===422){const x=p.response.data.errors||{};m(x),console.log("Validation errors:",x);const g=Object.entries(x).map(([k,q])=>Array.isArray(q)?`${k}: ${q.join(", ")}`:`${k}: ${q}`);g.length>0?alert(`${n("companies_edit.validation_errors")}:
${g.join(`
`)}`):alert(n("companies_edit.check_form_errors"))}else{const x=p.response?.data?.message||p.message||n("companies_edit.error_occurred");m(g=>({...g,submit:x})),alert(`${n("companies_edit.error_updating_client")}: ${x}`)}}finally{R(!1)}},X=()=>{s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview),$()};return!v||!l||!S?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[95vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:n("companies_edit.title")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-gray-600",children:[n("companies_edit.editing"),": ",e.jsx("span",{className:"font-medium",children:l.client_code})]}),l.id&&e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded text-gray-500",children:["ID: ",l.id]})]}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Company Name: "}),e.jsx("span",{className:"text-blue-600 font-semibold",children:s.company_name}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Read Only - from Leads)"})]}),O?e.jsxs("p",{className:"text-sm text-blue-600 mt-1 flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),n("companies_edit.loading_contact_data")]}):U?e.jsxs("p",{className:"text-sm text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),n("companies_edit.contact_data_loaded")]}):e.jsxs("p",{className:"text-sm text-yellow-600 mt-1 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),n("companies_edit.no_contact_data")]})]}),e.jsx("button",{onClick:X,className:"p-2 hover:bg-gray-100 rounded-lg transition",disabled:_,children:e.jsx(K,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("form",{onSubmit:E,className:"overflow-y-auto max-h-[calc(95vh-180px)]",children:[e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-900 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ee,{className:"w-6 h-6 text-blue-600"})}),n("companies_edit.contact_person_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.contact_person_name")," *"]}),e.jsx("input",{type:"text",name:"contact_person",value:s.contact_person,onChange:y,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition ${c.contact_person?"border-red-300 bg-red-50":"border-blue-200"}`,placeholder:n("companies_edit.contact_person_placeholder"),required:!0}),c.contact_person&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),c.contact_person]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.position")]}),e.jsx("input",{type:"text",name:"contact_position",value:s.contact_position,onChange:y,className:"w-full px-4 py-3 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:n("companies_edit.position_placeholder")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.email_address")," *"]}),e.jsx("input",{type:"email",name:"contact_email",value:s.contact_email,onChange:y,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition ${c.contact_email?"border-red-300 bg-red-50":"border-blue-200"}`,placeholder:n("companies_edit.email_placeholder"),required:!0}),c.contact_email&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),c.contact_email]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.phone_number")," *"]}),e.jsx("input",{type:"tel",name:"contact_phone",value:s.contact_phone,onChange:y,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition ${c.contact_phone?"border-red-300 bg-red-50":"border-blue-200"}`,placeholder:n("companies_edit.phone_placeholder"),required:!0}),c.contact_phone&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),c.contact_phone]}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),n("companies_edit.phone_format")]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-teal-50 to-emerald-50 border border-teal-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-teal-900 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-teal-100 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-teal-600"})}),n("companies_edit.company_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-teal-500"}),n("companies_edit.company_name"),e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-normal bg-blue-50 px-2 py-0.5 rounded",children:"Read Only"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full px-4 py-3 border border-teal-200 rounded-lg bg-gray-50 text-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"font-medium",children:s.company_name})}),e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Locked"})]})]}),e.jsx("input",{type:"hidden",name:"company_name",value:s.company_name})]}),e.jsxs("div",{className:"mt-2 flex items-start text-xs text-gray-500",children:[e.jsx(H,{className:"w-3 h-3 mr-1 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Company name is retrieved from the associated Lead record and cannot be edited here. To change the company name, please update the corresponding Lead in the Leads section."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[n("companies_edit.client_type")," *"]}),e.jsxs("select",{name:"client_type_id",value:s.client_type_id,onChange:y,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition ${c.client_type_id?"border-red-300 bg-red-50":"border-teal-200"}`,required:!0,children:[e.jsx("option",{value:"",children:n("companies_edit.select_client_type")}),j.map(f=>e.jsxs("option",{value:f.id,children:[f.name," ",f.information?`- ${f.information}`:""]},f.id))]}),c.client_type_id&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:c.client_type_id})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-teal-600"}),n("companies_edit.location_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.city")}),e.jsx("input",{type:"text",name:"city",value:s.city,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.city_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.province")}),e.jsx("input",{type:"text",name:"province",value:s.province,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.province_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.country")}),e.jsx("input",{type:"text",name:"country",value:s.country,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.country_placeholder")})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-teal-600"}),n("companies_edit.business_details")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.postal_code")}),e.jsx("input",{type:"text",name:"postal_code",value:s.postal_code,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.postal_code_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.vat_number")}),e.jsx("input",{type:"text",name:"vat_number",value:s.vat_number,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.vat_number_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.nib_number")}),e.jsx("input",{type:"text",name:"nib",value:s.nib,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.nib_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.website")}),e.jsx("input",{type:"url",name:"website",value:s.website,onChange:y,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.website_placeholder")})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:n("companies_edit.status")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer transition ${s.status==="active"?"border-green-500 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"status",value:"active",checked:s.status==="active",onChange:y,className:"w-5 h-5 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n("companies_edit.active")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n("companies_edit.active_description")})]})]}),e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer transition ${s.status==="inactive"?"border-gray-500 bg-gray-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"status",value:"inactive",checked:s.status==="inactive",onChange:y,className:"w-5 h-5 text-gray-600 focus:ring-gray-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n("companies_edit.inactive")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n("companies_edit.inactive_description")})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:n("companies_edit.company_logo")}),s.logo_preview?e.jsx("div",{className:"relative",children:e.jsx("div",{className:"border-2 border-dashed border-teal-300 rounded-xl p-4 bg-gradient-to-br from-teal-50 to-white",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("img",{src:s.logo_preview,alt:n("companies_edit.logo_preview"),className:"w-40 h-40 object-contain rounded-xl shadow-md"}),e.jsx("button",{type:"button",onClick:b,className:"absolute -top-2 -right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition shadow-lg",title:n("companies_edit.remove_logo"),children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:n("companies_edit.current_logo")})]})})}):e.jsxs("div",{className:"border-2 border-dashed border-teal-300 rounded-xl p-6 text-center bg-gradient-to-br from-teal-50 to-white hover:border-teal-400 transition cursor-pointer",children:[e.jsx("input",{type:"file",id:"logo-upload",name:"logo",onChange:y,className:"hidden",accept:"image/*"}),e.jsxs("label",{htmlFor:"logo-upload",className:"cursor-pointer",children:[e.jsx(Ne,{className:"w-12 h-12 text-teal-400 mx-auto mb-3"}),e.jsx("div",{className:"font-medium text-teal-700 hover:text-teal-800",children:n("companies_edit.upload_new_logo")}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:n("companies_edit.file_requirements")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:n("companies_edit.recommended_size")})]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[n("companies_edit.editing_client"),": ",e.jsx("span",{className:"font-semibold",children:l.client_code})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Company Name: ",e.jsx("span",{className:"font-medium text-blue-600",children:s.company_name})]}),e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded",children:"Read Only"})]}),O&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:n("companies_edit.loading_contact_information")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:X,disabled:_,className:"px-5 py-2.5 text-gray-700 hover:text-gray-900 font-medium disabled:opacity-50 hover:bg-gray-200 rounded-lg transition",children:n("companies_edit.cancel")}),e.jsx("button",{type:"submit",disabled:_,className:"px-6 py-2.5 bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all shadow-md hover:shadow-lg",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),n("companies_edit.updating")]}):n("companies_edit.update_client_contact")})]})]})]})]})})},ke=({isOpen:v,onClose:$,company:l,onDelete:j,isBulk:w=!1,selectedCount:n=0,selectedIds:s=[]})=>{const{t:a}=Z(),[c,m]=o.useState(!1),[_,R]=o.useState(""),[A,T]=o.useState(""),[O,I]=o.useState(!1);if(o.useEffect(()=>{D.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",D.defaults.withCredentials=!0;const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");b&&(D.defaults.headers.common["X-CSRF-TOKEN"]=b)},[]),o.useEffect(()=>{const b=()=>{I(window.innerWidth<640)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),o.useEffect(()=>{const b=E=>{E.key==="Escape"&&v&&S()};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[v]),!v)return null;const U=async()=>{m(!0),T("");try{let b;if(w&&s.length>0){const E=s.map(p=>D.delete(`/companies/${p}`)),f=(await Promise.all(E)).filter(p=>p.data?.success).length;if(f>0)b={data:{success:!0,message:a("companies_delete.bulk_delete_success",{count:f})}};else throw new Error(a("companies_delete.bulk_delete_failed"))}else if(l)b=await D.delete(`/companies/${l.id}`);else throw new Error(a("companies_delete.no_company_selected"));b.data.success?(alert(b.data.message||a("companies_delete.delete_success")),j&&j(),M.reload({only:["companies","statistics"],preserveScroll:!0}),$(),F()):(T(b.data.message||a("companies_delete.delete_failed")),alert(b.data.message||a("companies_delete.delete_failed")))}catch(b){console.error("Delete error:",b);const E=b.response?.data?.message||b.message||a("companies_delete.delete_error_try_again");T(E),alert(`${a("companies_delete.error")}: ${E}`)}finally{m(!1)}},F=()=>{R(""),T("")},S=()=>{F(),$()},C=()=>w?a("companies_delete.bulk_delete_title",{count:n}):a("companies_delete.delete_client"),P=()=>w?a("companies_delete.bulk_delete_message",{count:n}):a("companies_delete.delete_message",{name:l?.client_code||l?.name}),Q=()=>w?a("companies_delete.bulk_confirmation",{count:n}):a("companies_delete.confirmation",{name:l?.client_code||l?.name});return(w?s.length>0:l)?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:S}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto relative",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(J,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:C()}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:a("companies_delete.can_be_restored")})]})]}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-lg transition",disabled:c,children:e.jsx(K,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[A&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:A})})]})}),e.jsx("div",{className:"border rounded-lg p-4 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:P()}),!w&&l&&e.jsxs("div",{className:"mt-2 space-y-1",children:[l.client_code&&e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsxs("span",{className:"font-semibold",children:[a("companies_delete.client_code"),":"]})," ",e.jsx("span",{className:"font-mono bg-white px-1 py-0.5 rounded text-xs",children:l.client_code})]}),l.email&&e.jsxs("p",{className:"text-xs text-yellow-600",children:[e.jsxs("span",{className:"font-semibold",children:[a("companies_delete.email"),":"]})," ",l.email]})]}),w&&s.length>0&&e.jsxs("p",{className:"text-xs mt-2 text-yellow-600",children:["ðŸ“‹ ",s.length," ",a("companies_delete.clients_selected")]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(pe,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsxs("span",{className:"font-medium",children:[a("companies_delete.type_to_confirm"),":"]})]}),e.jsx("input",{type:"text",value:_,onChange:b=>R(b.target.value.toUpperCase()),placeholder:a("companies_delete.type_placeholder").toUpperCase(),className:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 font-mono text-center text-base sm:text-lg font-bold uppercase tracking-wider",disabled:c,autoComplete:"off"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${_==="DELETE"?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{children:a(_==="DELETE"?"companies_delete.confirmation_matches":"companies_delete.type_exactly")})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(xe,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:Q()}),e.jsx("p",{className:"text-xs text-gray-500",children:a("companies_delete.can_be_restored_later")})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-4 sm:px-6 py-4 border-t flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{type:"button",onClick:S,disabled:c,className:"px-4 py-2.5 text-gray-700 hover:text-gray-900 font-medium disabled:opacity-50 transition-colors rounded-lg order-2 sm:order-1",children:a("companies_delete.cancel")}),e.jsx("button",{type:"button",onClick:U,disabled:c||_!=="DELETE",className:"px-6 py-2.5 font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors order-1 sm:order-2 bg-red-600 hover:bg-red-700 text-white",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),a("companies_delete.deleting")]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),a("companies_delete.delete_button")]})})]})]})})]}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(J,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a("companies_delete.no_data_selected")}),e.jsx("p",{className:"text-gray-600",children:a("companies_delete.select_client_to_delete")}),e.jsx("button",{onClick:$,className:"mt-4 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:a("companies_delete.close")})]})})})},et=()=>{const{companies:v,statistics:$,types:l,filters:j,fromQuotation:w,quotationId:n,clientTypes:s}=te().props,{t:a}=Z();console.log("DEBUG: Props Received:",{companiesCount:v?.data?.length,clientTypesCount:s?.length||l?.length,typesCount:l?.length,companySample:v?.data?.[0]});const[c,m]=o.useState(j.search||""),[_,R]=o.useState(j.client_type_id||""),[A,T]=o.useState(!1),[O,I]=o.useState(!1),[U,F]=o.useState(!1),[S,C]=o.useState(null),[P,Q]=o.useState([]),[y,b]=o.useState(null),[E,X]=o.useState(null),f=o.useRef(null);o.useEffect(()=>{w&&n&&T(!0)},[w,n]),o.useEffect(()=>{const t=i=>{f.current&&!f.current.contains(i.target)&&b(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const p=o.useCallback(t=>{M.get("/companies",{search:t,client_type_id:_},{preserveState:!0,replace:!0,only:["companies","filters","statistics"]})},[_]),x=o.useCallback(t=>{const i=t===_?"":t;R(i),M.get("/companies",{search:c,client_type_id:i},{preserveState:!0,replace:!0,only:["companies","filters","statistics"]})},[c,_]),g=()=>{m(""),R(""),M.get("/companies",{},{preserveState:!0,replace:!0,only:["companies","filters","statistics"]})},k=()=>{T(!1),M.reload({only:["companies","statistics"],preserveScroll:!0})},q=t=>{console.log("=== EDIT CLICKED ==="),console.log("Original company data:",t),console.log("Lead data:",t.lead),console.log("Primary contact:",t.primary_contact);const i={id:t.id,client_code:t.client_code||"",company_name:t.company_name||t.lead?.company_name||t.client_code||t.name||"",contact_person:t.contact_person||t.primary_contact?.name||t.lead?.contact_person||"",contact_email:t.email||t.primary_contact?.email||t.lead?.email||"",contact_phone:t.phone||t.primary_contact?.phone||t.lead?.phone||"",contact_position:t.contact_position||t.primary_contact?.position||t.lead?.position||"",client_type_id:t.client_type_id||"",city:t.city||"",province:t.province||"",country:t.country||"",postal_code:t.postal_code?.toString()||"",vat_number:t.vat_number?.toString()||"",nib:t.nib||"",website:t.website||"",logo_url:t.logo_url||"",is_active:t.is_active||!1,primary_contact:t.primary_contact,lead:t.lead,name:t.name};console.log("Prepared company data for edit:",i),console.log("Company Name source:",{fromCompanyProp:t.company_name,fromLead:t.lead?.company_name,fromClientCode:t.client_code,finalValue:i.company_name}),C(i),I(!0)},h=t=>{console.log("Delete clicked for:",t.id),C(t),F(!0)},W=t=>{console.log("Update successful:",t),I(!1),C(null),M.reload({only:["companies","statistics"],preserveScroll:!0})},r=async t=>{if(S)try{const i=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");let N=`/companies/${S.id}`;t==="permanent"&&(N=`/companies/force-delete/${S.id}`);const z=await fetch(N,{method:t==="permanent"?"DELETE":"POST",headers:{"X-CSRF-TOKEN":i,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),V=await z.json();if(!z.ok)throw new Error(V.message||a("companies.delete_failed"));alert(V.message||a("companies.client_deleted_successfully")),F(!1),C(null),M.reload({only:["companies","statistics"],preserveScroll:!0})}catch(i){console.error("Delete error:",i),alert(a("companies.delete_failed_try_again"))}};o.useEffect(()=>{const t=setTimeout(()=>{c!==j.search&&p(c)},500);return()=>clearTimeout(t)},[c]);const u=[{key:"client_name",label:a("companies.table.client_name"),render:(t,i)=>{const N=i.company_name||i.lead?.company_name||i.name||"-";return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("button",{onClick:z=>{z.stopPropagation(),d(i)},className:"font-medium text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1 transition-colors",children:[N,e.jsx(ue,{className:"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:i.client_code})]})}},{key:"address",label:a("companies.table.address"),render:(t,i)=>{const N=i.is_active,z=[i.city,i.province,i.country].filter(Boolean),V=z.length>0?z.join(", "):i.address||"-";return e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${N?"text-gray-900":"text-gray-500"}`,children:V}),!N&&e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:a("companies.inactive")})]})}},{key:"contact_person",label:a("companies.table.contact_person"),render:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t||"-"})},{key:"contact_info",label:a("companies.table.contact"),render:(t,i)=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.email||"-"}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:i.phone||"-"})]})},{key:"client_type_name",label:a("companies.table.status"),render:t=>e.jsx("span",{className:"font-semibold text-green-700 bg-green-50 rounded px-2 py-1 text-xs",children:t||"-"})},{key:"client_since",label:a("companies.table.client_since"),render:t=>e.jsx("div",{className:"text-sm text-gray-600",children:t?new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"})}],L=v.data?.map((t,i)=>{const N=t.company_name||t.lead?.company_name||t.client_code||t.name||"-";return{id:t.id,client_name:N,company_name:N,address:t.address||"-",city:t.city||"",province:t.province||"",country:t.country||"",contact_person:t.contact_person||"-",email:t.email||"-",phone:t.phone||"-",contact_position:t.contact_position||"",client_code:t.client_code||"",client_type_name:t.client_type_name||a("companies.unknown"),client_type_id:t.client_type_id||"",is_active:t.is_active||!1,client_since:t.client_since||"-",created_at:t.created_at||"",postal_code:t.postal_code||"",vat_number:t.vat_number||"",nib:t.nib||"",website:t.website||"",logo_url:t.logo_url||"",primary_contact:t.primary_contact,lead:t.lead,name:t.name}})||[],d=t=>{M.visit(`/companies/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{title:a("companies.title"),subtitle:a("companies.subtitle")}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-black uppercase tracking-widest text-gray-800",children:a("companies.title")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a("companies.subtitle")})]}),w&&n&&e.jsx("div",{className:"w-full sm:w-auto bg-blue-50 border border-blue-200 rounded-lg p-3 mb-2 sm:mb-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:a("companies.from_quotation_notification")})]}),e.jsx("button",{onClick:()=>M.get("/companies"),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:a("companies.skip")})]})}),e.jsx("div",{className:"flex gap-3 w-full sm:w-auto",children:e.jsxs("button",{onClick:()=>T(!0),className:"inline-flex items-center rounded-md border border-transparent px-5 py-2.5 text-sm font-medium font-semibold uppercase tracking-widest text-white transition duration-150 ease-in-out bg-[rgb(17,94,89)] hover:bg-[rgb(13,75,71)] focus:bg-[rgb(13,75,71)] focus:outline-none focus:ring-2 focus:ring-[rgb(17,94,89)] focus:ring-offset-2 active:bg-[rgb(10,60,57)] w-full sm:w-auto flex items-center justify-center gap-2 shadow-sm hover:shadow",children:[e.jsx(ge,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:a("companies.add_new_client")})]})})]}),A&&e.jsx(we,{isOpen:A,onClose:()=>T(!1),clientTypes:l,quotationId:n,onSuccess:k}),O&&S&&e.jsx(Ce,{isOpen:O,onClose:()=>{I(!1),C(null)},company:S,clientTypes:s||l,onUpdate:W}),U&&e.jsx(ke,{isOpen:U,onClose:()=>{F(!1),C(null)},company:S,onDelete:r}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 my-7",children:$.client_types?.map((t,i)=>{const N=["border-blue-200 bg-blue-100","border-green-200 bg-green-100","border-orange-200 bg-orange-100","border-purple-200 bg-purple-100"],z=N[i%N.length];return e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${z} transition-transform hover:scale-[1.02] hover:shadow-md min-h-[120px] flex flex-col justify-between`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 uppercase tracking-wide",children:t.name}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:t.count})]}),e.jsx("div",{className:"p-3 rounded-full bg-white",children:e.jsx(G,{className:"w-6 h-6 text-blue-600"})})]})},t.id)})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 mb-6",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(se,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:a("companies.search_placeholder"),value:c,onChange:t=>m(t.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm transition-all duration-200"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:_,onChange:t=>x(t.target.value),className:"w-full sm:w-64 border border-gray-300 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white pr-10",children:[e.jsx("option",{value:"",children:a("companies.all_client_types")}),l.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}),(c||_)&&e.jsxs("button",{onClick:g,className:"px-4 py-3 border border-gray-300 text-gray-700 rounded-xl text-sm font-medium hover:bg-gray-50 transition-colors duration-200 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(K,{className:"h-4 w-4"}),a("companies.clear_filters")]})]}),(c||_)&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[c&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[a("companies.search_label",{search:c}),e.jsx("button",{onClick:()=>m(""),className:"ml-1.5 text-blue-600 hover:text-blue-800",children:"Ã—"})]}),_&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[`${a("companies.type_label")}: ${l.find(t=>t.id===_)?.name||a("companies.selected")}`,e.jsx("button",{onClick:()=>R(""),className:"ml-1.5 text-green-600 hover:text-green-800",children:"Ã—"})]})]})]})})}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsx(ne,{columns:u,data:L,onEdit:q,onDelete:h,showAction:!0,pagination:{currentPage:v.current_page||1,totalPages:v.last_page||1,totalItems:v.total||0,itemsPerPage:v.per_page||10,onPageChange:t=>{M.get("/companies",{page:t,search:c,client_type_id:_},{preserveState:!0,replace:!0})}},onRowClick:d})})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-500"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Total:"})," ",v.total||0," clients |",e.jsx("strong",{children:" Active:"})," ",$.active||0," |",e.jsx("strong",{children:" Inactive:"})," ",$.inactive||0]})]})})]})]})};export{et as default};
