import{r as d,u as se,j as e,b as M,H as ne,c as N}from"./app-DSAstNJH.js";import{H as re,F as le,S as F}from"./HeaderLayout-PFXXfuQf.js";import{T as oe}from"./TableLayout-DeF2PwM4.js";import{u as de}from"./useTranslation-BTkknNM_.js";import{S as ie}from"./search-DZZ_GgUd.js";import{C as me}from"./calendar-G4u4f0fT.js";import{F as ce}from"./funnel-BOCY2HbZ.js";import{R as ue}from"./refresh-cw-m21x-Xyc.js";import{F as xe}from"./file-text-DfBuK0ep.js";import{X as $}from"./x-D-I7aP1o.js";import"./transition-CHb-6Grs.js";import"./settings-BO8HVa9i.js";import"./createLucideIcon-B1SYFIyP.js";import"./send-CNJV6gwc.js";import"./globe-DUEaYrgg.js";import"./chevron-down-CC24HzTf.js";import"./check-ZSv3oBxE.js";import"./user-QIOkK541.js";const Pe=(w,b="success")=>{F.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:h=>{h.onmouseenter=F.stopTimer,h.onmouseleave=F.resumeTimer}}).fire({icon:b,title:w})};function Te({payments:w=[],stats:b={},filters:g={},auth_permissions:h}){const{t:a}=de(),[_,c]=d.useState(!1),[L,f]=d.useState(!1),[l,E]=d.useState(null),[q,I]=d.useState(null),[v,P]=d.useState([]),[y,k]=d.useState(null),[u,x]=d.useState(!1);h.can_read;const B=h.can_create===1,T=h.can_update===1,A=h.can_delete===1,[n,i]=d.useState({invoice_id:"",company_name:"",amount:"",method:"transfer",date:"",bank:"",note:""}),H=[a("payments.method.transfer"),a("payments.method.cash"),a("payments.method.check")],O=[{value:"",label:a("payments.filters.all_months")||"All Months"},{value:"1",label:a("payments.month.january")},{value:"2",label:a("payments.month.february")},{value:"3",label:a("payments.month.march")},{value:"4",label:a("payments.month.april")},{value:"5",label:a("payments.month.may")},{value:"6",label:a("payments.month.june")},{value:"7",label:a("payments.month.july")},{value:"8",label:a("payments.month.august")},{value:"9",label:a("payments.month.september")},{value:"10",label:a("payments.month.october")},{value:"11",label:a("payments.month.november")},{value:"12",label:a("payments.month.december")}],z={total_payment:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200",icon:"ðŸ“Š"},transfer:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",icon:"ðŸ’¸"},cash:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200",icon:"ðŸ’µ"},check:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:"ðŸ§¾"}},U=["total_payment","transfer","cash","check"],{data:o,setData:R,get:Y}=se({keyword:g.keyword||"",method:g.method||"all",month:g.month||"",year:g.year||""}),[m,C]=d.useState({keyword:o.keyword||"",method:o.method||"all",month:o.month||"",year:o.year||""});d.useEffect(()=>{C({keyword:o.keyword||"",method:o.method||"all",month:o.month||"",year:o.year||""})},[o.keyword,o.method,o.month,o.year]);const j=(t,s)=>{C(r=>({...r,[t]:s})),R(t,s)},G=()=>{Y(route("payment.index"),{preserveState:!0,preserveScroll:!0,replace:!0,data:{keyword:m.keyword,method:m.method!=="all"?m.method:"",month:m.month,year:m.year}})},X=()=>{const t={keyword:"",method:"all",month:"",year:""};C(t),R(t),N.get(route("payment.index"),{},{replace:!0,preserveState:!1,preserveScroll:!0})},S=t=>new Intl.NumberFormat("id-ID").format(t),J=[{key:"no",label:a("payments.table.no_date")||"No & Date",render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:t}),e.jsx("div",{className:"text-xs text-gray-500",children:s.date})]})},{key:"invoice",label:a("payments.table.invoice")},{key:"date",label:a("payments.table.date")},{key:"company_name",label:a("payments.table.company_name")},{key:"amount",label:a("payments.table.amount")},{key:"method",label:a("payments.table.method")},{key:"bank",label:a("payments.table.bank")},{key:"note",label:a("payments.table.note")}],K=w.map(t=>({id:t.id,no:t.invoice_number||`#${t.id}`,date:t.payment_date,invoice:t.invoice_number,company_name:t.company_name||"N/A",amount:`Rp ${S(t.amount)}`,method:t.methode,bank:t.bank||"-",note:t.note||"-",original:t}));d.useEffect(()=>{_&&!l&&Q()},[_]);const Q=async()=>{try{const t=await M.get(route("payment.get-invoices"));P(t.data)}catch(t){console.error("Failed to load invoices:",t)}},V=()=>{E(null),k(null),i({invoice_id:"",company_name:"",amount:"",method:"transfer",date:"",bank:"",note:""}),c(!0)},W=t=>{const s=v.find(r=>r.id===t);s&&(k(s),i(r=>({...r,invoice_id:t,company_name:s.company_name,amount:s.remaining_amount||s.total_amount-s.paid_amount})))},Z=async t=>{E(t);const s=r=>{let p=r.find(D=>D.id===t.invoice_id);!p&&t.invoice_id&&(p={id:t.invoice_id,invoice_number:t.invoice_number,company_name:t.company_name,remaining_amount:t.amount,total_amount:t.amount,paid_amount:0},r=[...r,p],P(r)),k(p||null),i({invoice_id:t.invoice_id||"",company_name:p?p.company_name:t.company_name,amount:t.amount,method:t.methode?t.methode.toLowerCase():"transfer",date:t.payment_date?t.payment_date.split("-").reverse().join("-"):"",bank:t.bank||"",note:t.note||""})};if(v.length>0)s(v),c(!0);else try{const r=await M.get(route("payment.get-invoices"));s(r.data),c(!0)}catch{i({invoice_id:t.invoice_id||"",company_name:t.company_name,amount:t.amount,method:t.methode?t.methode.toLowerCase():"transfer",date:t.payment_date?t.payment_date.split("-").reverse().join("-"):"",bank:t.bank||"",note:t.note||""}),c(!0)}},ee=t=>{I(t),f(!0)},te=t=>{t.preventDefault(),x(!0);const s={invoice_id:n.invoice_id,amount:n.amount,method:n.method,date:n.date,bank:n.bank,note:n.note};l?N.patch(route("payment.update",l.id),s,{preserveScroll:!0,onSuccess:()=>{c(!1),x(!1)},onError:()=>{x(!1)}}):N.post(route("payment.store"),s,{preserveScroll:!0,onSuccess:()=>{c(!1),x(!1)},onError:()=>{x(!1)}})},ae=()=>{x(!0),N.delete(route("payment.destroy",q.id),{preserveScroll:!0,onSuccess:()=>{f(!1),I(null),x(!1)},onError:()=>{x(!1)}})};return e.jsxs(re,{children:[e.jsx(ne,{title:a("payments.title")}),e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a("payments.title")}),B&&e.jsx("button",{onClick:V,className:"bg-teal-700 hover:bg-teal-800 text-white px-6 py-2 rounded-md transition-colors",children:a("payments.button_add")})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:U.map(t=>{const s=z[t],r=a(t==="total_payment"?"payments.title":`payments.method.${t}`),p=t==="total_payment"?b.total_payment?.count||0:b[t]?.count||0,D=t==="total_payment"?b.total_payment?.amount||0:b[t]?.amount||0;return e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${s.border} ${s.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${s.text} uppercase tracking-wide`,children:r}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:p}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Rp ",S(D)]})]}),e.jsx("div",{className:`p-3 rounded-full ${s.bg}`,children:e.jsx("span",{className:"text-lg",children:s.icon})})]})},t)})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.search_placeholder")}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:a("payments.filters.search_placeholder"),value:m.keyword,onChange:t=>j("keyword",t.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:flex lg:space-x-4 gap-4",children:[e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.method")}),e.jsxs("select",{value:m.method,onChange:t=>j("method",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"all",children:a("payments.filters.all_methods")||"All Methods"}),H.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.month")}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("select",{value:m.month,onChange:t=>j("month",t.target.value),className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:O.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"lg:w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.year")}),e.jsxs("select",{value:m.year,onChange:t=>j("year",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"",children:a("payments.filters.all_years")||"All Years"}),e.jsx("option",{value:"2024",children:"2024"}),e.jsx("option",{value:"2025",children:"2025"}),e.jsx("option",{value:"2026",children:"2026"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{onClick:G,className:"px-4 py-2.5 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors justify-center text-sm font-medium",children:[e.jsx(ce,{className:"w-4 h-4"}),a("payments.filters.apply")]}),e.jsxs("button",{onClick:X,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 justify-center text-sm font-medium",children:[e.jsx(ue,{className:"w-4 h-4"}),a("payments.filters.reset")]})]})]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsx(oe,{data:K,columns:J,onEdit:T?Z:null,onDelete:A?ee:null,showAction:T||A})})}),_&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#005954]/10 rounded-lg",children:e.jsx(xe,{className:"w-6 h-6 text-[#005954]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:a(l?"payments.edit_title":"payments.add_title")}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:l?a("payments.edit_subtitle")||"Update payment details":a("payments.add_subtitle")||"Create a new payment"})]})]}),e.jsx("button",{onClick:()=>c(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",disabled:u,children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:te,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.invoice"),e.jsx("span",{className:"text-red-500",children:"*"})]}),l?e.jsx("input",{type:"text",value:(y&&y.invoice_number?y.invoice_number+" - ":l.invoice_number?l.invoice_number+" - ":"")+(y&&y.company_name?y.company_name:l.company_name||"No Company"),disabled:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-100 text-sm"}):e.jsxs("select",{value:n.invoice_id,onChange:t=>W(t.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0,children:[e.jsx("option",{value:"",children:a("payments.select_invoice")||"Select Invoice"}),(()=>{let t=v.slice();return l&&n.invoice_id&&(t.some(r=>r.id===n.invoice_id)||t.push({id:n.invoice_id,invoice_number:l.invoice_number,company_name:l.company_name,remaining_amount:l.amount,total_amount:l.amount,paid_amount:0})),t.length>0?t.map(s=>e.jsxs("option",{value:s.id,children:[s.invoice_number," - ",s.company_name||"No Company"," (Remaining: Rp ",S(s.remaining_amount||s.total_amount-s.paid_amount),")"]},s.id)):e.jsx("option",{value:"",disabled:!0,children:a("payments.no_unpaid_invoice")||"No unpaid invoices available"})})()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.table.company_name")}),e.jsx("input",{type:"text",value:n.company_name,disabled:!0,placeholder:"Appears when selecting invoice",className:"w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-100 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.amount"),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:n.amount,onChange:t=>i({...n,amount:t.target.value}),placeholder:"Rp.",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.method"),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.method,onChange:t=>i({...n,method:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0,children:[e.jsx("option",{value:"transfer",children:a("payments.method.transfer")}),e.jsx("option",{value:"cash",children:a("payments.method.cash")}),e.jsx("option",{value:"check",children:a("payments.method.check")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.date"),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:n.date,onChange:t=>i({...n,date:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.table.bank")}),e.jsx("input",{type:"text",value:n.bank,onChange:t=>i({...n,bank:t.target.value}),placeholder:"Bank name and branch",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.table.note")}),e.jsx("textarea",{value:n.note,onChange:t=>i({...n,note:t.target.value}),rows:"3",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent min-h-[100px] resize-none text-sm"})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-6 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),disabled:u,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:a("payments.close")||"CANCEL"}),e.jsx("button",{type:"submit",disabled:u,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d47] transition-colors font-medium flex-1 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm hover:shadow-md",children:u?a("payments.processing")||"PROCESSING...":a("payments.submit")||"SUBMIT"})]})]})]})})}),L&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#005954]/10 rounded-lg",children:e.jsx("span",{className:"text-[#005954]",children:e.jsx(le,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a("payments.delete_title")||"Delete Payment"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a("payments.delete_confirm")||"Are you sure?"})]})]}),e.jsx("button",{onClick:()=>f(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",disabled:u,children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"border border-gray-300 rounded-md p-4 mb-6",children:e.jsx("p",{className:"text-red-600 text-center",children:a("payments.delete_warning")||"Do you really want to delete this payment permanently. You cannot undo this action"})}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>f(!1),disabled:u,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:a("payments.no")||"NO"}),e.jsx("button",{onClick:ae,disabled:u,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d47] transition-colors font-medium flex-1 disabled:opacity-50",children:u?a("payments.deleting")||"DELETING...":a("payments.yes")||"YES"})]})]})]})})})]})]})}export{Te as default,Pe as toast};
