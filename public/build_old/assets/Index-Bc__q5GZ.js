import{b as W,r as i,j as e}from"./app-Dyd-VK-i.js";import{H as ue}from"./HeaderLayout-Btj1rOYY.js";import{T as xe}from"./TableLayout-BIe_S7av.js";import{F as he}from"./file-text-D0lOMtzR.js";import{c as fe}from"./createLucideIcon-CMta4jpe.js";import{X as pe}from"./x-Dg_sVrJD.js";import{L as ge}from"./loader-circle-DFyo62iO.js";import{S as be}from"./save-C5ygkR14.js";import{P as Z}from"./PrimaryButton-BnqY-Jkt.js";import{u as ye}from"./useTranslation-C1duoCZq.js";import"./transition-BVEVT5Dk.js";import"./index-BAWYnhaJ.js";import"./settings-D0070qy7.js";import"./send-C6E11V_I.js";import"./globe-36e_mGF8.js";import"./chevron-down-BdiW-nc9.js";import"./check-BdTeYIzn.js";import"./user-DGMjLAi-.js";const je=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ve=fe("user-plus",je),G={async getAll(){try{console.log("ðŸ“ž GET /api/leads");const r=await W.get("/api/leads");return console.log("âœ… GET Response:",r.data),r}catch(r){throw console.error("âŒ GET Error:",r.response?.data||r.message),r}},async create(r){try{console.log("ðŸ“ POST /api/leads",r);const a=await W.post("/api/leads",r);return console.log("âœ… POST Response:",a.data),a}catch(a){throw a.response?.data?.message&&console.error("âŒ Server Message:",a.response.data.message),a.response?.data?.errors&&console.error("âŒ Validation Errors:",a.response.data.errors),console.error("âŒ POST Error Detail:",a.response?.data||a.message),a}},async update(r,a){try{console.log("ðŸ“ PUT /api/leads/"+r,a);const d=await W.put(`/api/leads/${r}`,a);return console.log("âœ… PUT Response:",d.data),d}catch(d){throw console.error("âŒ PUT Error:",d.response?.data||d.message),d}},async delete(r){try{console.log("ðŸ—‘ï¸ DELETE /api/leads/"+r);const a=await W.delete(`/api/leads/${r}`);return console.log("âœ… DELETE Response:",a.data),a}catch(a){throw console.error("âŒ DELETE Error:",a.response?.data||a.message),a}}};function we({open:r,onClose:a,onSubmit:d,initialData:l,currentUser:x,isAdmin:S=!1}){const[c,O]=i.useState({company_name:"",address:"",contact_person:"",email:"",phone:"",position:"",assigned_to:""}),[L,m]=i.useState([]),[$,_]=i.useState([]),[H,F]=i.useState(!1),[D,R]=i.useState(!1),[h,k]=i.useState(!1);i.useEffect(()=>{r&&(j(),U(),k(!1))},[r]),i.useEffect(()=>{const o=u=>{u.keyCode===27&&a()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[a]);const q=()=>{const o=L.find(u=>u.name.toLowerCase()==="new");return o?o.id:L.length>0?L[0].id:null},j=async()=>{try{F(!0);const u=await(await fetch("/api/lead-statuses")).json();m(u)}catch(o){console.error("Failed to fetch statuses:",o),m([])}finally{F(!1)}},U=async()=>{try{R(!0);const o=await fetch("/api/users");if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const u=await o.json();if(u.error){await f();return}_(u)}catch(o){console.error("Failed to fetch users:",o),await f()}finally{R(!1)}},f=async()=>{try{const o=await fetch("/api/users-simple");if(o.ok){const u=await o.json();_(u)}else _([{id:x?.id||"1",name:x?.name||"Current User",email:x?.email||"user@example.com"},{id:"2",name:"John Doe",email:"john@example.com"},{id:"3",name:"Jane Smith",email:"jane@example.com"}])}catch(o){console.error("Fallback also failed:",o),_([])}};i.useEffect(()=>{r&&O(l?{company_name:l.company_name||"",address:l.address||"",contact_person:l.contact_person||"",email:l.email||"",phone:l.phone||"",position:l.position||"",assigned_to:l.assigned_to||""}:{company_name:"",address:"",contact_person:"",email:"",phone:"",position:"",assigned_to:x?.id||""})},[l,r,x]);const v=o=>{const{name:u,value:P}=o.target;O(J=>({...J,[u]:P}))},I=async o=>{if(o.preventDefault(),!h){k(!0);try{if(!c.company_name.trim()||!c.contact_person.trim()){alert("Please fill required fields"),k(!1);return}const u=q();if(!u){alert('Status "new" not found. Please try again.'),k(!1);return}const P={...c,lead_statuses_id:u,assigned_to:c.assigned_to||(l?c.assigned_to:x?.id||null)};await d(P)}catch(u){console.error("Error submitting form:",u),alert("Failed to submit form.")}finally{k(!1)}}},E=()=>c.assigned_to?$.find(o=>o.id===c.assigned_to):null;if(!r)return null;const A=E(),z=l?he:ve;return e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50 transition-all duration-300",children:e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#005954]/10 rounded-lg",children:e.jsx(z,{className:"w-6 h-6 text-[#005954]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:l?"Edit Lead":"Create New Lead"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:l?"Update lead information":"Add a new lead to your database"})]})]}),e.jsx("button",{onClick:a,disabled:h,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"company_name",value:c.company_name,onChange:v,disabled:h,placeholder:"Enter company name",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all disabled:bg-gray-50",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"contact_person",value:c.contact_person,onChange:v,disabled:h,placeholder:"Full Name",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Position ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"position",value:c.position,onChange:v,disabled:h,placeholder:"Job Title",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:[" Email ",e.jsx("span",{className:"text-red-500",children:"*"})," "]}),e.jsx("input",{name:"email",type:"email",value:c.email,onChange:v,disabled:h,placeholder:"name@company.com",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:[" Phone ",e.jsx("span",{className:"text-red-500",children:"*"})," "]}),e.jsx("input",{name:"phone",value:c.phone,onChange:v,disabled:h,placeholder:"+62...",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:" Assign To "}),e.jsxs("select",{name:"assigned_to",value:c.assigned_to||"",onChange:v,disabled:h||D,className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Unassigned"}),$.map(o=>e.jsxs("option",{value:o.id,children:[o.name," ",o.id===x?.id?"(You)":""]},o.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:" Address "}),e.jsx("textarea",{name:"address",value:c.address,onChange:v,disabled:h,rows:"2",placeholder:"Enter full address",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all resize-none"})]})]}),A&&e.jsxs("div",{className:"mt-2 p-3 bg-[#005954]/5 border border-[#005954]/10 rounded-xl flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#005954] rounded-full flex items-center justify-center text-white text-xs font-bold",children:A.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:A.name}),e.jsx("p",{className:"text-xs text-gray-500",children:A.email})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex flex-col-reverse sm:flex-row gap-3",children:[e.jsx("button",{type:"button",onClick:a,disabled:h,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:h||!c.company_name,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d48] transition-all font-medium flex-1 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[h?e.jsx(ge,{className:"w-5 h-5 animate-spin"}):e.jsx(be,{className:"w-5 h-5"}),l?"Update Lead":"Create Lead"]})]})]})]})})})}const Ne=({isOpen:r,onClose:a,onConfirm:d,lead:l})=>r?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:a}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[e.jsx("div",{className:"bg-white px-6 py-5",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Lead"}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:l?.company_name}),"?"]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:()=>d(l),className:"inline-flex w-full justify-center rounded-md bg-red-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto transition-colors",children:"Delete"}),e.jsx("button",{type:"button",onClick:a,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-4 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto transition-colors",children:"Cancel"})]})]})})]}):null,ke=({isOpen:r,onClose:a,type:d,title:l,message:x})=>{if(!r)return null;const S={success:{bg:"bg-green-100",text:"text-green-600",icon:"âœ“"},error:{bg:"bg-red-100",text:"text-red-600",icon:"!"},warning:{bg:"bg-yellow-100",text:"text-yellow-600",icon:"âš "},info:{bg:"bg-blue-100",text:"text-blue-600",icon:"i"}},c=S[d]||S.info;return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:a}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"bg-white px-6 py-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full ${c.bg}`,children:e.jsx("span",{className:`text-lg font-bold ${c.text}`,children:c.icon})}),e.jsxs("div",{className:"ml-4 text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-sm text-gray-500",children:x})})]})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-4",children:e.jsx("button",{type:"button",onClick:a,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 transition-colors",children:"OK"})})]})})]})},ee=(r,a)=>{if(!r||r.length<7)return`rgba(59, 130, 246, ${a})`;const d=parseInt(r.slice(1,3),16),l=parseInt(r.slice(3,5),16),x=parseInt(r.slice(5,7),16);return`rgba(${d}, ${l}, ${x}, ${a})`},_e=(r,a)=>{if(r.length<7)return"#2563eb";let d=parseInt(r.slice(1,3),16),l=parseInt(r.slice(3,5),16),x=parseInt(r.slice(5,7),16);return d=Math.floor(d*(100-a)/100),l=Math.floor(l*(100-a)/100),x=Math.floor(x*(100-a)/100),`rgb(${d}, ${l}, ${x})`};function He({leads:r=[],auth:a,auth_permissions:d}){const[l,x]=i.useState(r),[S,c]=i.useState([]),[O,L]=i.useState(!1),{t:m}=ye();d.can_read;const $=d.can_create===1,_=d.can_update===1,H=d.can_delete===1,[F,D]=i.useState(!1),[R,h]=i.useState(!1),[k,q]=i.useState(null),[j,U]=i.useState(""),[f,v]=i.useState(""),[I,E]=i.useState(!1),[A,z]=i.useState(!1),[o,u]=i.useState({type:"success",title:"",message:""}),[P,J]=i.useState(null),[C,Y]=i.useState([]),p=a?.user||null,se=p?.is_admin||!1;i.useEffect(()=>{te(),ae()},[]);const te=async()=>{try{L(!0);const s=await fetch("/api/users");if(s.ok){const t=await s.json();c(t)}}catch(s){console.error("Failed to fetch users:",s),c([])}finally{L(!1)}},ae=async()=>{try{const s=await fetch("/api/lead-statuses");if(s.ok){const t=await s.json();Y(t)}else console.error("Failed to fetch lead statuses:",s.status),X()}catch(s){console.error("Error fetching lead statuses:",s),X()}},X=async()=>{try{const s=await fetch("/api/lead-status");if(s.ok){const t=await s.json();Y(t)}else{const t=await fetch("/api/leads");if(t.ok){const n=await t.json(),g=[],y=new Set;n.forEach(b=>{b.status_id&&b.status_name&&b.status_color&&!y.has(b.status_id)&&(y.add(b.status_id),g.push({id:b.status_id,name:b.status_name,color:b.status_color}))}),g.length>0?Y(g):console.error("No lead statuses available")}}}catch(s){console.error("Error fetching lead statuses from alternative source:",s)}};i.useEffect(()=>{console.log("=== LEAD STATUSES FROM DATABASE ==="),console.log("Total statuses:",C.length),console.log("Statuses data:",C)},[C]);const re=async(s,t)=>{try{D(!0);const n=C.find(y=>y.id===t);if(!n)throw new Error("Status not found");console.log("Selected status object:",n),console.log("Lead ID to update:",s);const g={lead_statuses_id:t,status:n.name,status_name:n.name,status_color:n.color||"#3b82f6",_method:"PUT"};console.log("Updating status with payload:",g);try{const y=await fetch(`/api/leads/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(g)}),b=await y.json();if(console.log("Update response:",b),!y.ok)throw new Error(b.message||b.error||`Update failed with status ${y.status}`);x(B=>B.map(T=>T.id===s?{...T,lead_statuses_id:t,status_id:t,status_name:n.name,status_color:n.color||"#3b82f6",status:n.name}:T)),N("success","Status Updated",`Lead status changed to ${n.name}`)}catch(y){throw console.error("Fetch error:",y),y}}catch(n){console.error("Status update error:",n),console.error("Full error:",n);let g="Failed to update status";n.response?.data?g=n.response.data.message||n.response.data.error||JSON.stringify(n.response.data.errors||n.response.data):n.message&&(g=n.message),N("error","Update Failed",g)}finally{D(!1)}},ne=[{key:"company_name",label:m("leads.table.company_name")||"Company Name",sortable:!0},{key:"address",label:m("leads.table.address")||"Address"},{key:"contact_person",label:m("leads.table.contact_person")||"Contact Person",render:(s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.contact_person||"-"}),e.jsx("div",{className:"text-gray-500 text-sm mt-1",children:t.position||"-"})]})},{key:"email",label:m("leads.table.email_phone")||"Email & Phone",render:(s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.email||"-"}),e.jsx("div",{className:"text-gray-500 text-sm mt-1",children:t.phone||"-"})]})},{key:"assigned_user",label:m("leads.table.assigned_to")||"Assigned To",render:(s,t)=>{if(s&&s.name){const n=p&&s.id===p.id;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:[s.name,n&&e.jsx("span",{className:"ml-1 text-xs font-normal text-green-600",children:"(You)"})]}),s.email&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:s.email})]})]})}return t.assigned_to&&!s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-semibold text-sm",children:"?"})}),e.jsxs("div",{className:"text-sm text-gray-500",children:["User ID: ",t.assigned_to.substring(0,8),"..."]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})})}),e.jsx("span",{className:"text-gray-400 text-sm",children:"Unassigned"})]})}},{key:"status_name",label:m("leads.table.status")||"Status",render:(s,t)=>{const n=C.find(w=>w.id===t.lead_statuses_id||w.id===t.status_id||w.name===(t.status_name||t.status)),g=n?.color||t.status_color||"#3b82f6",y=n?.name||t.status_name||t.status||"New",b=n?.id||t.lead_statuses_id||t.status_id,B=ee(g,.1),T=_e(g,20);return _?e.jsxs("div",{className:"relative min-w-[100px] max-w-[150px]",children:[e.jsxs("select",{value:b||"",onChange:w=>re(t.id,w.target.value),className:"appearance-none text-xs font-bold py-1 px-2 rounded-lg border-2 focus:ring-0 cursor-pointer transition-all truncate w-full",style:{backgroundColor:B,color:g,borderColor:T,backgroundImage:"none",appearance:"none",MozAppearance:"none",WebkitAppearance:"none",paddingRight:"1.5rem"},disabled:!p||C.length===0||F,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Status"}),C.map(w=>{const ce=ee(w.color||"#3b82f6",.1),me=w.color||"#3b82f6";return e.jsx("option",{value:w.id,className:"py-1",style:{backgroundColor:ce,color:me,fontWeight:"bold"},children:w.name.toUpperCase()},w.id)})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-1",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M19 9l-7 7-7-7"})})}),F&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-white/50",children:e.jsx("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}):e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-bold border-2 truncate max-w-[120px] inline-block",style:{backgroundColor:B,color:g,borderColor:T},children:y.toUpperCase()})}},{key:"created_at",label:m("leads.table.created_at")||"Created",render:s=>e.jsx("div",{className:"text-sm text-gray-600",children:s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"})}],N=(s,t,n)=>{u({type:s,title:t,message:n}),z(!0)},K=()=>{if(!p){N("error","Authentication Required","Please login to create a lead");return}q(null),h(!0)},oe=s=>{if(!p){N("error","Authentication Required","Please login to edit leads");return}q(s),h(!0)},le=async s=>{console.log("Submitting lead:",s);try{k?(await G.update(k.id,s),N("success","Success","Lead updated successfully!")):(await G.create(s),N("success","Success","Lead created successfully!")),h(!1),window.location.reload()}catch(t){console.error("Submit error:",t),N("error","Save Failed",t.response?.data?.message||t.message)}},ie=s=>{if(!p){N("error","Authentication Required","Please login to delete leads");return}J(s),E(!0)},de=async s=>{try{await G.delete(s.id),x(t=>t.filter(n=>n.id!==s.id)),E(!1),N("success","Deleted",`"${s.company_name}" has been deleted.`),setTimeout(()=>{window.location.reload()},1e3)}catch(t){E(!1),N("error","Delete Failed",t.response?.data?.message||t.message)}},V=Array.isArray(l)?l.filter(s=>{const t=s.company_name?.toLowerCase().includes(j.toLowerCase())||s.contact_person?.toLowerCase().includes(j.toLowerCase())||s.email?.toLowerCase().includes(j.toLowerCase())||(s.assigned_user?.name||"").toLowerCase().includes(j.toLowerCase())||(s.assigned_user?.email||"").toLowerCase().includes(j.toLowerCase());let n=!0;return f&&(f==="unassigned"?n=!s.assigned_to||s.assigned_to==="":f==="me"?n=p&&s.assigned_to===p.id:f==="others"?n=p&&s.assigned_to&&s.assigned_to!==p.id:n=s.assigned_to===f),t&&n}):[];Array.isArray(l)&&[...new Set(l.filter(s=>s.company_name).map(s=>s.company_name).sort())];const Q=()=>{U(""),v("")},M=j||f;return e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:m("leads.title")||"Leads Management",subtitle:m("leads.sub_title")||"Manage all company leads"}),e.jsx("div",{className:"px-8 py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:m("leads.title")})}),e.jsx("div",{className:"sm:w-auto",children:$&&e.jsxs(Z,{onClick:K,disabled:!p,className:"inline-flex items-center rounded-md border border-transparent px-5 py-2.5 text-sm font-medium font-semibold uppercase tracking-widest text-white transition duration-150 ease-in-out bg-[rgb(17,94,89)] hover:bg-[rgb(13,75,71)] focus:bg-[rgb(13,75,71)] focus:outline-none focus:ring-2 focus:ring-[rgb(17,94,89)] focus:ring-offset-2 active:bg-[rgb(10,60,57)] w-full sm:w-auto flex items-center justify-center gap-2 shadow-sm hover:shadow",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"font-semibold",children:m("leads.button_add")||"Add New Lead"})]})})]})}),e.jsx("div",{className:"bg-white border-b border-gray-200 px-8",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:m("leads.filters.search_placeholder"),value:j,onChange:s=>U(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm transition-all duration-200"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:f,onChange:s=>v(s.target.value),className:"w-full sm:w-64 border border-gray-300 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white pr-10",children:[e.jsx("option",{value:"",children:m("leads.filters.all_assignments")||"All Assignments"}),e.jsx("option",{value:"me",children:m("leads.filters.assigned_to_me")||"Assigned to Me"}),e.jsx("option",{value:"unassigned",children:m("leads.filters.unassigned")||"Unassigned"}),e.jsx("option",{value:"others",children:m("leads.filters.assined_to_others")||"Assigned to Others"}),e.jsx("optgroup",{label:m("leads.filters.specific_user")||"Specific Users",children:S.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",p&&s.id===p.id&&"(You)"]},s.id))})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}),M&&e.jsxs("button",{onClick:Q,className:"px-4 py-3 border border-gray-300 text-gray-700 rounded-xl text-sm font-medium hover:bg-gray-50 transition-colors duration-200 flex items-center gap-2 whitespace-nowrap",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),m("leads.filters.clear_search")||"Clear Filters"]})]}),M&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[j&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:['Search: "',j,'"',e.jsx("button",{onClick:()=>U(""),className:"ml-1.5 text-blue-600 hover:text-blue-800",children:"Ã—"})]}),f&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[f==="me"&&"Assigned to Me",f==="unassigned"&&"Unassigned",f==="others"&&"Assigned to Others",!["me","unassigned","others"].includes(f)&&`Assigned to: ${S.find(s=>s.id===f)?.name||"User"}`,e.jsx("button",{onClick:()=>v(""),className:"ml-1.5 text-green-600 hover:text-green-800",children:"Ã—"})]})]})]})})}),e.jsx("div",{className:"px-8 py-6",children:p?V.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50",children:[e.jsx("div",{className:"h-16 w-16 text-gray-300 mb-5",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-500 font-medium mb-2 text-lg",children:M?"No matching leads found":"No leads in database"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6 text-center max-w-md",children:M?"Try adjusting your search criteria or filters":"Get started by adding your first lead to the system"}),e.jsxs("div",{className:"flex gap-3",children:[M&&e.jsx("button",{onClick:Q,className:"px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors",children:"Clear All Filters"}),!M&&e.jsxs(Z,{onClick:K,className:"px-6 py-3 text-sm font-semibold",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Your First Lead"]})]})]}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx(xe,{columns:ne,data:V,onEdit:_?oe:null,onDelete:H?ie:null,showAction:_||H})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50",children:[e.jsx("div",{className:"h-16 w-16 text-gray-300 mb-5",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("p",{className:"text-gray-500 font-medium mb-2 text-lg",children:"Authentication Required"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6 text-center max-w-md",children:"You need to be logged in to view and manage leads. Please sign in to continue."})]})}),e.jsx(we,{open:R,onClose:()=>h(!1),onSubmit:le,initialData:k,currentUser:p,isAdmin:se,users:S,statuses:C}),e.jsx(Ne,{isOpen:I,onClose:()=>E(!1),onConfirm:de,lead:P}),e.jsx(ke,{isOpen:A,onClose:()=>z(!1),type:o.type,title:o.title,message:o.message})]})}export{He as default};
