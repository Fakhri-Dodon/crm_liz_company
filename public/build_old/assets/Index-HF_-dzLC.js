import{r as i,j as t,u as J,c}from"./app--V8YQuQk.js";import{H as P,S as f}from"./HeaderLayout-Bk7u9NLn.js";import{T as U}from"./TableLayout-BTyK602-.js";import{P as W}from"./PrimaryButton-D8xKtEFh.js";import{D as z}from"./DeleteModal-DHZPJn7_.js";import{u as V}from"./useTranslation-DGCn9e9S.js";import{S as G}from"./search-D65wTQHs.js";import{C as K}from"./calendar-Bfq9qOyj.js";import{F as X}from"./funnel-CHJrTea-.js";import{R as Y}from"./refresh-cw-LPNXZfv2.js";import"./transition-D2W53CQ5.js";import"./index-DvGSOaWZ.js";import"./settings-B2fgqRwV.js";import"./createLucideIcon-D7A-7CJ7.js";import"./send-BzvzPsAY.js";import"./globe-DUm1N8J0.js";import"./chevron-down-DnOCgVxl.js";import"./check-BtXJC3Kt.js";import"./user-D9rdox91.js";import"./x-DGqtnagE.js";import"./triangle-alert-tJvvQB1h.js";const C=(x,p="success")=>{f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:d=>{d.onmouseenter=f.stopTimer,d.onmouseleave=f.resumeTimer}}).fire({icon:p,title:x})};function Ne({quotations:x,statusOptions:p,summary:y,years:d,filters:r,totals:b,auth_permissions:u}){const[D,g]=i.useState(!1),[j,v]=i.useState(null),[Z,N]=i.useState(null),{t:a}=V();u.can_read;const F=u.can_create===1,w=u.can_update===1,k=u.can_delete===1,$=[{key:"no",label:a("quotations.table.no_date"),render:(e,s)=>t.jsxs("div",{children:[t.jsx("a",{href:`/storage/${s.pdf_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 font-semibold hover:underline flex items-center gap-1",children:e}),t.jsx("div",{className:"text-gray-500 text-sm mt-1",children:new Date(s.date||"-").toLocaleDateString()})]})},{key:"subject",label:a("quotations.table.subject")},{key:"company_name",label:a("quotations.table.company_name"),render:(e,s)=>{const o=!!s.is_client;return t.jsx("span",{className:`font-medium ${o?"text-blue-600":"text-black"}`,children:s.lead?.company_name||e})}},{key:"contact",label:a("quotations.table.contact")},{key:"created_by",label:a("quotations.table.created_by")},{key:"total",label:a("quotations.table.total"),render:(e,s)=>{const o=s.tax||0;return t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:e}),o>0&&t.jsx("div",{className:"text-red-500 text-xs font-semibold mt-0.5 text-right",children:a("quotations.table.ppn_total")})]})}},{key:"status",label:a("quotations.table.status"),render:(e,s)=>{const o={sent:"border-blue-500 text-blue-700 bg-blue-50",accepted:"border-green-500 text-green-700 bg-green-50",expired:"border-orange-500 text-orange-700 bg-orange-50",rejected:"border-red-500 text-red-700 bg-red-50",draft:"border-gray-500 text-gray-700 bg-gray-50"},S=["expired"],H=n=>{const q=n.target.value;c.patch(route("quotation.update-status",s.id),{status:q},{preserveScroll:!0,onSuccess:()=>{C("Status updated to "+q.toUpperCase())},onError:()=>{C("Failed to update status","error")}})};if(S.includes(e)){const n=`text-xs font-bold py-1 px-2 rounded-lg border-2 ${o[e]||"border-gray-300"}`;return t.jsx("div",{className:"inline-flex items-center",children:t.jsx("span",{className:n,style:{backgroundImage:"none"},children:a(`quotations.stats.${e}`)})})}return t.jsx("select",{value:e,onChange:H,style:{backgroundImage:"none",WebkitAppearance:"none",MozAppearance:"none"},className:`appearance-none text-xs font-bold py-1 px-2 rounded-lg border-2 focus:ring-0 cursor-pointer transition-all ${o[e]||"border-gray-300"}`,children:Object.keys(o).filter(n=>!S.includes(n)).map(n=>t.jsx("option",{value:n,children:a(`quotations.stats.${n}`)},n))})}}],[l,h]=i.useState({search:r?.search||"",status:r?.status||"all",month:r?.month||"",year:r?.year||""});i.useEffect(()=>{h({search:r?.search||"",status:r?.status||"all",month:r?.month||"",year:r?.year||""})},[r]);const m=(e,s)=>{h(o=>({...o,[e]:s})),_(e,s)},I=()=>{L(route("quotation.index"),{preserveState:!0,preserveScroll:!0,replace:!0,data:{search:l.search,status:l.status!=="all"?l.status:"",month:l.month,year:l.year}})},A=()=>{const e={search:"",status:"all",month:"",year:""};h(e),_(e),c.get(route("quotation.index"),{},{replace:!0,preserveState:!1,preserveScroll:!0})},E=[{value:"",label:a("quotations.filters.all_months")},{value:"1",label:"Jan"},{value:"2",label:"Feb"},{value:"3",label:"Mar"},{value:"4",label:"Apr"},{value:"5",label:"May"},{value:"6",label:"Jun"},{value:"7",label:"Jul"},{value:"8",label:"Aug"},{value:"9",label:"Sep"},{value:"10",label:"Oct"},{value:"11",label:"Nov"},{value:"12",label:"Dec"}],T={sent:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200",icon:"⚡"},accepted:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",icon:"✅"},expired:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200",icon:"⏳"},rejected:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:"❌"}},M=x.data.map(e=>({id:e.id,no:e.quotation_number,date:e.date,subject:e.subject||"-",company_name:e.lead?.company_name||"-",contact:e.lead?.contact_person||"-",created_by:e.creator?.name||"Admin",total:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e.total||0),status:e.status,pdf_path:e.pdf_path,is_client:e.is_client,tax:e.tax})),{data:ee,setData:_,get:L}=J({search:r?.search||"",status:r?.status||"all",month:r?.month||"",year:r?.year||""}),Q=e=>{e&&e.id?c.visit(`/quotation/edit/${e.id}`):console.error("Data quotation tidak memiliki ID",e)},R=e=>{v(e.id),N(e),g(!0)},B=()=>{j&&c.delete(route("quotation.destroy",j),{onSuccess:()=>g(!1)})},O=()=>{c.visit("/quotation/create")};return t.jsxs(t.Fragment,{children:[t.jsx(P,{title:a("quotations.title")}),t.jsxs("div",{className:"px-8 py-6",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a("quotations.title")}),F&&t.jsxs(W,{onClick:O,className:"w-full sm:w-auto px-5 py-2.5 text-white text-sm font-medium rounded-lg hover:bg-[#004d47] transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[t.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),t.jsx("span",{children:a("quotations.button_add")})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 my-7",children:Object.entries(T).map(([e,s])=>t.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${s.border} ${s.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:`text-sm font-medium ${s.text} uppercase tracking-wide`,children:a(`quotations.stats.${e}`)}),t.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:y[e]||0}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(b&&b[e]?b[e]:0)})]}),t.jsx("div",{className:`p-3 rounded-full ${s.bg}`,children:s.icon?t.jsx("span",{className:"text-lg",children:s.icon}):t.jsx("div",{className:`w-3 h-3 rounded-full ${s.text.replace("text-","bg-")}`})})]})},e))}),t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.search_placeholder")}),t.jsxs("div",{className:"relative",children:[t.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),t.jsx("input",{type:"text",placeholder:a("quotations.filters.search_placeholder"),value:l.search,onChange:e=>m("search",e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:flex lg:space-x-4 gap-4",children:[t.jsxs("div",{className:"lg:w-40",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.status")}),t.jsxs("select",{value:l.status,onChange:e=>m("status",e.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[t.jsx("option",{value:"all",children:a("quotations.filters.all_status")}),p?.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})]}),t.jsxs("div",{className:"lg:w-40",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.month")}),t.jsxs("div",{className:"relative",children:[t.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("select",{value:l.month,onChange:e=>m("month",e.target.value),className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:E.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{className:"lg:w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("quotations.filters.year")}),t.jsxs("select",{value:l.year,onChange:e=>m("year",e.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[t.jsx("option",{value:"",children:a("quotations.filters.all_years")}),(d||[]).map(e=>t.jsx("option",{value:e,children:e},e))]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[t.jsxs("button",{onClick:I,className:"px-4 py-2.5 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors justify-center text-sm font-medium",children:[t.jsx(X,{className:"w-4 h-4"}),a("quotations.filters.apply")]}),t.jsxs("button",{onClick:A,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 justify-center text-sm font-medium",children:[t.jsx(Y,{className:"w-4 h-4"}),a("quotations.filters.reset")]})]})]})}),t.jsx("div",{className:"py-8",children:t.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:t.jsx(U,{data:M,columns:$,onEdit:w?Q:null,onDelete:k?R:null,showAction:w||k})})}),t.jsx(z,{show:D,onClose:()=>{g(!1),v(null),N(null)},onConfirm:B,title:"Delete Quotation",message:"Are you sure you want to delete quotation? This action cannot be undone."})]})]})}export{Ne as default,C as toast};
