import{a as W,r,b as m,j as e,H as N,c as _}from"./app-Dyd-VK-i.js";import z from"./Sidebar-D55IPc4F.js";import B from"./CompanyHeader-D7gTgSRz.js";import S from"./ProfileTable-Dia8D5Nf.js";import G from"./QuotationTable-DcYWX_B5.js";import K from"./InvoiceTable-3hIALYQH.js";import Q from"./PaymentTable-DngDNypB.js";import J from"./ProjectTable-eI4MvDLk.js";import V from"./ContactTable-_38nHN90.js";import{H as E}from"./HeaderLayout-Btj1rOYY.js";import{u as Y}from"./useTranslation-C1duoCZq.js";import{T as Z}from"./trash-2-xd5U0av9.js";import"./building-2-BjbEIYrJ.js";import"./createLucideIcon-CMta4jpe.js";import"./file-text-D0lOMtzR.js";import"./receipt-DSeQ-N8R.js";import"./credit-card-DcnPWp4b.js";import"./folder-kanban-CZP1WEnP.js";import"./users-CaGv18Zi.js";import"./chevron-right-CkR_1ISW.js";import"./map-pin-CstW7RZX.js";import"./globe-36e_mGF8.js";import"./mail-BkQVmhWp.js";import"./phone-BFp8ONkp.js";import"./info-DDaJRL86.js";import"./building-DpHZTUnz.js";import"./calendar-CWDjbzSs.js";import"./user-DGMjLAi-.js";import"./chevron-up-3B5JPPo2.js";import"./chevron-down-BdiW-nc9.js";import"./refresh-cw-51J-93ua.js";import"./circle-alert-C3TtVEnV.js";import"./circle-x-DY3We9RK.js";import"./clock-CiSfxGeq.js";import"./send-C6E11V_I.js";import"./circle-check-big-BEvmm_V7.js";import"./square-pen-Cmebj4O1.js";import"./search-AUTQuBot.js";import"./loader-C7d5DLY0.js";import"./percent-BH4ewhPU.js";import"./x-Dg_sVrJD.js";import"./save-C5ygkR14.js";import"./loader-circle-DFyo62iO.js";import"./ContactModal-DG8w-z_K.js";import"./briefcase-L_GldUNp.js";import"./check-BdTeYIzn.js";import"./plus-B5n9R1EM.js";import"./transition-BVEVT5Dk.js";import"./index-BAWYnhaJ.js";import"./settings-D0070qy7.js";const rt=({company:s,quotations:C,invoices:p,payments:T,projects:b,contacts:i,statistics:k,grouped_quotations:P})=>{const{props:M}=W(),{t}=Y(),[d,q]=r.useState("profile"),[D,ee]=r.useState(!1),[L,u]=r.useState(!1),[h,x]=r.useState(null),[te,se]=r.useState("create"),[oe,ae]=r.useState(!1),[re,ne]=r.useState(null),[ce,ie]=r.useState({project_description:"",start_date:"",deadline:"",status:"pending",note:""}),[R,w]=r.useState(!1),[H,f]=r.useState(i||[]),[I,v]=r.useState(!1);console.log("========== SHOW PAGE DATA =========="),console.log("Company:",s),console.log("Contacts data received:",i),console.log("Invoices data received:",p),console.log("Projects data:",b),console.log("==================================="),r.useEffect(()=>{m.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",m.defaults.withCredentials=!0;const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");a&&(m.defaults.headers.common["X-CSRF-TOKEN"]=a)},[]),r.useEffect(()=>{!s||!s.id?console.error("ERROR: Company data is missing!"):console.log("SUCCESS: Company data received:",{id:s.id,name:s.client_code,contact_person:s.contact_person,invoices_count:p?.length||0,contacts_count:i?.length||0}),i&&f(i)},[s,i,p]);const y=async()=>{if(s?.id){v(!0);try{const a=await m.get(`/companies/${s.id}/contacts`);console.log("Fetched contacts:",a.data),a.data.success?f(a.data.data):console.error("Failed to fetch contacts:",a.data.message)}catch(a){console.error("Error fetching contacts:",a),f(i||[])}finally{v(!1)}}};r.useEffect(()=>{d==="contact"&&s?.id&&y()},[d,s?.id]);const l=(a,n="success")=>{document.querySelectorAll(".custom-toast").forEach(j=>j.remove());const c=document.createElement("div");c.className=`custom-toast fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${n==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,c.innerHTML=`
            <div class="flex items-center">
                <span>${a}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                    ✕
                </button>
            </div>
        `,document.body.appendChild(c),setTimeout(()=>{c.parentElement&&c.remove()},3e3)},A=async a=>{console.log("handleProjectEdit called with:",a);try{w(!0);const n=await m.put(`/companies/${s.id}/projects/${a.id}`,a,{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});return console.log("Update response:",n.data),n.data.success?(l(t("companies_show.project_updated_successfully"),"success"),_.reload({preserveScroll:!0}),!0):(l(n.data.message||t("companies_show.failed_to_update_project"),"error"),!1)}catch(n){if(console.error("Error updating project:",n),n.response?.status===422){const g=n.response.data.errors;let c=t("companies_show.validation_errors")+`:
`;Object.keys(g).forEach(j=>{c+=`- ${g[j].join(", ")}
`}),l(c,"error")}else l(n.response?.data?.message||t("companies_show.failed_to_update_project"),"error");return!1}finally{w(!1)}},$=a=>{console.log("Deleting project:",a),x(a),u(!0)},F=()=>{h&&_.delete(route("projects.destroy",h.id),{preserveScroll:!0,onSuccess:()=>{u(!1),x(null),l(t("companies_show.project_deleted_successfully"),"success")},onError:()=>{l(t("companies_show.failed_to_delete_project"),"error")}})},O=()=>{console.log("Refreshing contacts data..."),y(),l(t("companies_show.contacts_updated_successfully"),"success")};if(!s||!s.id)return e.jsxs(E,{children:[e.jsx(N,{title:t("companies_show.error_title")}),e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("companies_show.company_not_found")}),e.jsx("p",{className:"text-gray-600 mb-6",children:t("companies_show.company_not_found_message")}),e.jsx("button",{onClick:()=>_.visit(route("companies.index")),className:"px-6 py-3 bg-[#054748] text-white rounded-lg hover:bg-[#0a5d5e] transition-colors font-medium",children:t("companies_show.back_to_companies_list")}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("companies_show.debug_info")}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t("companies_show.url"),": ",window.location.href,e.jsx("br",{}),t("companies_show.route"),": companies.show",e.jsx("br",{}),t("companies_show.received_props"),": ",Object.keys(M).join(", ")]})]})]})})]});const o={company:{...s,contact_person:s.contact_person||s.primary_contact?.name||t("companies_show.not_available"),contact_email:s.contact_email||s.primary_contact?.email||t("companies_show.not_available"),contact_phone:s.contact_phone||s.primary_contact?.phone||t("companies_show.not_available"),contact_position:s.contact_position||s.primary_contact?.position||t("companies_show.not_available")},statistics:k||{},quotations:C||[],invoices:p||[],payments:T||[],projects:b||[],contacts:H,grouped_quotations:P||[]},X=()=>{if(D)return e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#054748]"}),e.jsx("span",{className:"ml-3 text-gray-600",children:t("companies_show.loading_data")})]});switch(d){case"profile":return e.jsx(S,{data:o.company});case"quotation":return e.jsx(G,{data:o.quotations,groupedData:o.grouped_quotations,companyId:o.company.id});case"invoice":return e.jsx(K,{data:o.invoices,companyId:s.id});case"payment":return e.jsx(Q,{data:o.payments,companyId:o.company.id,showInvoiceAmount:!0});case"project":return e.jsx(J,{data:o.projects,onEdit:A,onDelete:$});case"contact":return e.jsx(V,{contacts:o.contacts,companyId:o.company.id,onUpdate:O,isLoading:I});default:return e.jsx(S,{data:o.company})}},U=()=>{switch(d){case"contact":return null;default:return null}};return e.jsxs(E,{children:[e.jsx(N,{title:`${o.company.client_code} - ${t("companies_show.detail_company")}`}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(z,{activeTab:d,setActiveTab:q})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"p-0",children:[s&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg mx-6 mt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:t("companies_show.success_loaded_company_data")}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[t("companies_show.viewing"),": ",e.jsx("span",{className:"font-bold",children:o.company.client_code})," |",t("companies_show.invoices"),": ",e.jsx("span",{className:"font-bold",children:o.invoices?.length||0})," |",t("companies_show.contacts"),": ",e.jsx("span",{className:"font-bold",children:o.contacts?.length||0})," |",t("companies_show.projects"),": ",e.jsx("span",{className:"font-bold",children:o.projects?.length||0})]})]})]})}),e.jsx("div",{className:"px-6",children:e.jsx(B,{company:o.company,activeTab:d,data:o,statistics:o.statistics})}),e.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow-sm border border-gray-100 mx-6 p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("div",{}),U()]}),X()]})]})})]}),L&&h&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Z,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t("companies_show.delete_project")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t("companies_show.action_cannot_undone")})]})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:t("companies_show.confirm_delete_project",{name:h.project_description})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{u(!1),x(null)},className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex-1",children:t("companies_show.cancel")}),e.jsx("button",{onClick:F,className:"px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex-1",children:t("companies_show.delete")})]})]})})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-700",children:t("companies_show.saving_project")})]})})]})};export{rt as default};
