import{r as f,c as q,j as m}from"./app-DSAstNJH.js";import{_ as P,t as F}from"./index-MEVmEr_H.js";function $({name:h}){const[b,g]=f.useState(!1),w=f.useRef(null),S=f.useRef([]);f.useEffect(()=>{g(!0);const e=P.init({container:"#gjs",height:"100vh",fromElement:!1,storageManager:!1,allowScripts:1,blockManager:{expandState:!1},canvas:{styles:["/templates/css/icons/iconfont.css","/templates/css/plugins/bootstrap.min.css","/templates/css/font-awesome.min.css","http://fonts.googleapis.com/css?family=Lato:300,400,700,900,300italic,400italic,700italic,900italic","/templates/css/plugins/magnific-popup.css","/templates/css/plugins/owl.carousel.css","/templates/css/plugins/loaders.css","/templates/css/plugins/animate.css","/templates/css/style.css","/templates/css/responsive.css"],scripts:["/templates/js/plugins/jquery1.11.2.min.js","/templates/js/plugins/bootstrap.min.js","/templates/js/plugins/jquery.easing.1.3.min.js","/templates/js/plugins/jquery.countTo.js","/templates/js/plugins/jquery.formchimp.min.js","/templates/js/plugins/jquery.jCounter-0.1.4.js","/templates/js/plugins/jquery.magnific-popup.min.js","/templates/js/plugins/jquery.vide.min.js","/templates/js/plugins/owl.carousel.min.js","/templates/js/plugins/twitterFetcher_min.js","/templates/js/plugins/wow.min.js","/templates/js/custom.js"]}});e.Panels.addButton("options",[{id:"save-page",className:"fa fa-save",command:()=>{confirm("Apakah Anda yakin ingin menyimpan halaman ini?")&&x(e)},attributes:{title:"Save Page"}},{id:"go-back",className:"fa fa-arrow-left",command:()=>{confirm("Perubahan yang belum disimpan akan hilang. Kembali?")&&q.visit(document.referrer||route("settings.proposals"))},attributes:{title:"Kembali"}}]),fetch("/api/proposal/templates").then(s=>s.json()).then(s=>{S.current=s,s.forEach((t,a)=>{e.BlockManager.add(`template-${a}`,{category:t.category||"Templates",media:`<img src="${t.preview}" style="width: 100%; height: auto; display: block;" />`,content:`<input type="hidden" data-template-category="${t.category||"Templates"}">${t.html}<style>${t.css}</style>`,attributes:{class:"gjs-block-section"}})})}).finally(()=>g(!1)),w.current=e},[]);const x=async e=>{const s=e.getHtml(),a=new DOMParser().parseFromString(s,"text/html"),p=[...new Set([...a.querySelectorAll("[data-template-category]")].map(i=>i.dataset.templateCategory))],r=e.getConfig().canvas,n=async i=>{try{const T=await(await fetch(i)).text();return d(T,a)}catch{return console.error("Gagal mengambil CSS:",i),""}},l=r.styles.map(i=>n(i)),o=await Promise.all(l),u=d(e.getCss(),a),C=o.join(`
`)+`
`+u,v=e.Canvas.getFrameEl().contentDocument.body,R=await F(v,{backgroundColor:"#ffffff",pixelRatio:2}),k=await new Promise(i=>{const c=new FileReader;c.onloadend=()=>i(c.result),c.readAsDataURL(R)}),y=await(await fetch("/setting/proposal-element",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({name:h,html:s,css:C,categories:p,image:k})})).json();y.success&&(alert("Simpan Berhasil!"),window.location.href=y.redirect)};function d(e,s){if(!e)return"";const t=new CSSStyleSheet;try{t.replaceSync(e)}catch{return e}let a="";const p=t.cssRules;for(let r=0;r<p.length;r++){const n=p[r];if(n instanceof CSSMediaRule){let l="";for(let o=0;o<n.cssRules.length;o++){const u=n.cssRules[o];j(u.selectorText,s)&&(l+=u.cssText+`
`)}l&&(a+=`@media ${n.conditionText} {
${l}}
`)}else n.selectorText?j(n.selectorText,s)&&(a+=n.cssText+`
`):a+=n.cssText+`
`}return a}function j(e,s){if(!e)return!1;const t=e.split(":")[0].split(",")[0].trim();if(!t)return!0;try{return s.querySelector(t)!==null}catch{return!0}}return m.jsxs(m.Fragment,{children:[b&&m.jsx("div",{className:"fixed inset-0 bg-white/70 flex items-center justify-center z-50",children:m.jsx("span",{className:"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full"})}),m.jsx("div",{id:"gjs",className:"ps-2 pb-4"})]})}export{$ as default};
