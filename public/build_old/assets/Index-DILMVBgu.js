import{a as te,r as i,b as S,j as e,c as O}from"./app--V8YQuQk.js";import{H as re}from"./HeaderLayout-Bk7u9NLn.js";import{T as ne}from"./TableLayout-BTyK602-.js";import{u as G}from"./useTranslation-DGCn9e9S.js";import{X as V}from"./x-DGqtnagE.js";import{F as ee}from"./file-text-BkpdNTL0.js";import{S as se}from"./search-D65wTQHs.js";import{C as le}from"./chevron-down-DnOCgVxl.js";import{B}from"./building-DXosBoce.js";import{U as J}from"./user-D9rdox91.js";import{C as oe}from"./check-BtXJC3Kt.js";import{C as K}from"./circle-alert-CxrL5ccl.js";import{B as ce}from"./briefcase-BWAq_THx.js";import{M as ie}from"./mail-D6ZCm5oy.js";import{P as de}from"./phone-CEvMLKm6.js";import{c as Y}from"./createLucideIcon-D7A-7CJ7.js";import{M as me}from"./map-pin-DXTDSR7Y.js";import{T as ae}from"./trash-2-D2TdDDoH.js";import{T as Z}from"./triangle-alert-tJvvQB1h.js";import{I as pe}from"./info-OEJ7xNNZ.js";import{C as xe}from"./circle-check-big-CeV7987U.js";import{C as ue}from"./chevron-right-BPE1BH5F.js";import{P as he}from"./plus-D5prKAx_.js";import"./transition-D2W53CQ5.js";import"./index-DvGSOaWZ.js";import"./settings-B2fgqRwV.js";import"./send-BzvzPsAY.js";import"./globe-DUm1N8J0.js";const ge=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_e=Y("lock",ge);const be=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],fe=Y("shield-alert",be);const je=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ye=Y("smartphone",je);const ve=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ne=Y("upload",ve),we=({isOpen:v,onClose:M,clientTypes:r,quotationId:d,onSuccess:C})=>{const{flash:n}=te().props,{t:s}=G(),[a,m]=i.useState({company_name:"",client_type_id:"",contact_person:"",contact_email:"",contact_phone:"",contact_position:"",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,status:"active",quotation_id:d||"",lead_id:""}),[c,b]=i.useState({}),[F,q]=i.useState(!1),[T,P]=i.useState(null),[z,X]=i.useState([]),[$,E]=i.useState(!1),[u,U]=i.useState(null),[I,N]=i.useState(""),[f,L]=i.useState(null),[W,j]=i.useState(!1),x=()=>{const l=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return console.log("CSRF Token found:",l?"Yes":"No"),l};i.useEffect(()=>{const l=x();S.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",S.defaults.withCredentials=!0,l?(S.defaults.headers.common["X-CSRF-TOKEN"]=l,console.log("CSRF Token set for axios")):console.warn("CSRF Token not found!"),S.defaults.headers.common.Accept="application/json"},[]),i.useEffect(()=>{v&&(console.log("Modal opened..."),m({company_name:"",client_type_id:"",contact_person:"",contact_email:"",contact_phone:"",contact_position:"",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,status:"active",quotation_id:d||"",lead_id:""}),U(null),L(null),N(""),P(null),b({}),d?k(d):h())},[v,d]);const h=async()=>{E(!0);try{const l=x(),_=await S.get("/companies/get-accepted-quotations",{headers:{"X-CSRF-TOKEN":l,Accept:"application/json"}});_&&_.data&&_.data.success?X(_.data.data||[]):X([])}catch(l){console.error("Error fetching quotations:",l),X([])}finally{E(!1)}},g=async l=>{U(l),L(null),m(_=>({..._,quotation_id:l.id,lead_id:l.lead?.id||"",company_name:l.lead?.company_name||_.company_name,contact_person:l.lead?.contact_person||_.contact_person,contact_email:l.lead?.email||_.contact_email,contact_phone:l.lead?.phone||_.contact_phone,contact_position:l.lead?.position||s("companies_create.contact_person"),vat_number:l.lead?.vat_number||"",nib:l.lead?.nib||"",website:l.lead?.website||""})),l.lead&&L(l.lead)},k=async l=>{if(l){j(!0);try{const _=x(),A=await S.get(`/companies/get-lead-from-quotation/${l}`,{headers:{"X-CSRF-TOKEN":_,Accept:"application/json"}});if(A&&A.data&&A.data.success){const t=A.data.data;L(t),m(o=>({...o,quotation_id:l,lead_id:t.id||"",company_name:t.company_name||o.company_name,contact_person:t.contact_person||o.contact_person,contact_email:t.email||o.contact_email,contact_phone:t.phone||o.contact_phone,contact_position:t.position||s("companies_create.contact_person"),city:t.city||o.city,province:t.province||o.province,country:t.country||o.country,postal_code:t.postal_code||o.postal_code,vat_number:t.vat_number||"",nib:t.nib||"",website:t.website||""}))}}catch(_){console.error("Error fetching lead:",_)}finally{j(!1)}}},Q=()=>{U(null),L(null),m(l=>({...l,quotation_id:"",lead_id:"",company_name:"",contact_person:"",contact_email:"",contact_phone:"",vat_number:"",nib:"",website:"",city:"",province:"",country:"",postal_code:""})),N("")},R=z.filter(l=>{if(!I)return!0;const _=I.toLowerCase();return l.quotation_number?.toLowerCase().includes(_)||l.subject?.toLowerCase().includes(_)||l.lead?.company_name?.toLowerCase().includes(_)||l.lead?.contact_person?.toLowerCase().includes(_)}),w=l=>{const{name:_,value:A,type:t,files:o}=l.target;if(t==="file"){const y=o[0];if(m(p=>({...p,[_]:y})),y){const p=new FileReader;p.onloadend=()=>{P(p.result)},p.readAsDataURL(y)}else P(null)}else m(y=>({...y,[_]:A}));c[_]&&b(y=>({...y,[_]:null}))},H=async l=>{l.preventDefault(),q(!0),b({}),console.log("=== FORM SUBMISSION STARTED ==="),console.log("Form data before submit:",a);const _=["company_name","client_type_id","contact_person","contact_email","contact_phone","status"];let A=!1;const t={};if(_.forEach(p=>{a[p]||(t[p]=s("companies_create.field_required",{field:p.replace("_"," ")}),A=!0)}),A){b(t),q(!1);return}const o=new FormData,y=x();y&&o.append("_token",y),Object.entries(a).forEach(([p,D])=>{D!=null&&D!==""&&(p==="logo"&&D instanceof File?o.append("logo",D):o.append(p,D.toString()))}),a.contact_person&&o.append("name",a.contact_person),d&&!a.quotation_id&&o.append("quotation_id",d);try{console.log("Sending form data..."),console.log("CSRF Token to send:",y);const p=await S.post("/companies",o,{headers:{"Content-Type":"multipart/form-data"}});console.log("Server response:",p),p&&p.data&&p.data.success?(alert(p.data.message||s("companies_create.client_created_successfully")),M(),m({company_name:"",client_type_id:"",contact_person:"",contact_email:"",contact_phone:"",contact_position:"",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,status:"active",quotation_id:"",lead_id:""}),U(null),L(null),P(null),C&&C(),O.reload({only:["companies","statistics"],preserveScroll:!0})):(b(p?.data?.errors||{}),alert(p?.data?.message||s("companies_create.failed_to_create_client")))}catch(p){if(console.error("Error creating client:",p),console.error("Error details:",p.response?.data),p.response?.status===419){const D=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");console.log("Current CSRF token:",D),alert("CSRF token expired. Please refresh the page and try again."),window.location.reload()}else if(p.response?.status===422){b(p.response.data.errors||{});const D=Object.values(p.response.data.errors||{}).flat().join(`
`);D&&alert(s("companies_create.validation_errors")+`
`+D)}else alert(`${s("companies_create.error_creating_client")}: ${p.response?.data?.message||p.message}`)}finally{q(!1)}};return v?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("companies_create.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("companies_create.subtitle")}),d&&e.jsxs("div",{className:"mt-1 text-sm text-blue-600",children:[s("companies_create.creating_from_quotation"),": ",e.jsx("strong",{children:d})]})]}),e.jsx("button",{onClick:M,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(V,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("form",{onSubmit:H,className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[!d&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),s("companies_create.select_from_quotation"),e.jsx("span",{className:"text-red-600",children:"*"})]}),$?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:s("companies_create.loading_quotations")})]}):e.jsx("div",{className:"space-y-3",children:u?e.jsx("div",{className:"bg-white border border-green-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-green-700",children:u.quotation_number}),e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded",children:s("companies_create.accepted")})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:u.subject}),u.lead&&e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("div",{className:"font-medium text-gray-700",children:u.lead.company_name})})]}),e.jsx("button",{type:"button",onClick:Q,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(V,{className:"w-5 h-5"})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:s("companies_create.search_quotations"),value:I,onChange:l=>N(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:R.length>0?R.map(l=>e.jsx("div",{onClick:()=>g(l),className:"p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition last:border-b-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.quotation_number}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:l.subject}),l.lead&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l.lead.company_name})]}),e.jsx(le,{className:"w-5 h-5 text-gray-400"})]})},l.id)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:s("companies_create.no_quotations_found")})})})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),s("companies_create.company_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.company_name")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"company_name",value:a.company_name,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.company_name?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.company_name_placeholder"),disabled:!d&&!u}),c.company_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.company_name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.client_type")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{name:"client_type_id",value:a.client_type_id,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.client_type_id?"border-red-300":"border-gray-300"}`,required:!0,disabled:!d&&!u,children:[e.jsx("option",{value:"",children:s("companies_create.select_client_type")}),r&&r.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),c.client_type_id&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.client_type_id})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.city")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"city",value:a.city,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.city?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.city_placeholder"),disabled:!d&&!u}),c.city&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.city})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.province")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"province",value:a.province,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.province?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.province_placeholder"),disabled:!d&&!u}),c.province&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.province})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.country")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"country",value:a.country,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.country?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.country_placeholder"),disabled:!d&&!u}),c.country&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.country})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.postal_code")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"postal_code",value:a.postal_code,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.postal_code?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.postal_code_placeholder"),disabled:!d&&!u}),c.postal_code&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.postal_code})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.vat_number")}),e.jsx("input",{type:"text",name:"vat_number",value:a.vat_number,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.vat_number_placeholder"),disabled:!d&&!u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.nib")}),e.jsx("input",{type:"text",name:"nib",value:a.nib,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.nib_placeholder"),disabled:!d&&!u})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("companies_create.website")}),e.jsx("input",{type:"url",name:"website",value:a.website,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:s("companies_create.website_placeholder"),disabled:!d&&!u})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"w-5 h-5"}),s("companies_create.contact_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.contact_person")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"contact_person",value:a.contact_person,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.contact_person?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.contact_person_placeholder"),disabled:!d&&!u}),c.contact_person&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.contact_person})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.position")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"contact_position",value:a.contact_position,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.contact_position?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.position_placeholder"),disabled:!d&&!u}),c.contact_position&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.contact_position})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.email")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"email",name:"contact_email",value:a.contact_email,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.contact_email?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.email_placeholder"),disabled:!d&&!u}),c.contact_email&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.contact_email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("companies_create.phone")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"tel",name:"contact_phone",value:a.contact_phone,onChange:w,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${c.contact_phone?"border-red-300":"border-gray-300"}`,required:!0,placeholder:s("companies_create.phone_placeholder"),disabled:!d&&!u}),c.contact_phone&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.contact_phone})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-6 border-t",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:s("companies_create.company_logo")}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 hover:border-teal-500 transition",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",name:"logo",onChange:w,accept:"image/*",className:"w-full border border-gray-300 rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!d&&!u}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("companies_create.file_requirements")})]}),T&&e.jsx("div",{className:"w-16 h-16",children:e.jsx("img",{src:T,alt:s("companies_create.logo_preview"),className:"w-full h-full object-cover rounded-lg border border-gray-300"})})]})})]})})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:M,disabled:F,className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:s("companies_create.cancel")}),e.jsx("button",{type:"submit",disabled:F||!d&&!u,className:`px-6 py-2 font-medium rounded-lg flex items-center gap-2 ${F||!d&&!u?"bg-gray-400 text-white cursor-not-allowed":"bg-teal-700 hover:bg-teal-800 text-white"}`,children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s("companies_create.creating")]}):s("companies_create.create_client")})]})]})]})}):null},Ce=({isOpen:v,onClose:M,company:r,clientTypes:d,onUpdate:C})=>{const{t:n}=G(),[s,a]=i.useState({company_name:"",client_type_id:"",status:"active",city:"",province:"",country:"",postal_code:"",vat_number:"",nib:"",website:"",logo:null,logo_preview:"",delete_logo:!1,contact_person:"",contact_email:"",contact_phone:"",contact_position:""}),[m,c]=i.useState({}),[b,F]=i.useState(!1),[q,T]=i.useState(null),[P,z]=i.useState(!1),[X,$]=i.useState(!1),[E,u]=i.useState(!1),U=i.useRef(!1);i.useEffect(()=>{S.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",S.defaults.withCredentials=!0;const j=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");j&&(S.defaults.headers.common["X-CSRF-TOKEN"]=j)},[]),i.useEffect(()=>((async()=>{if(!(!v||!r||d.length===0||U.current)){U.current=!0,u(!1),console.log("=== EDIT MODAL INITIALIZATION ==="),console.log("Full company data received:",r),console.log("Lead data:",r.lead),console.log("Primary contact:",r.primary_contact),console.log("Client Types available:",d);try{const x=r.company_name||r.lead?.company_name||r.client_code||r.name||"",h={contact_person:r.contact_person||r.primary_contact?.name||r.lead?.contact_person||"",contact_email:r.contact_email||r.email||r.primary_contact?.email||r.lead?.email||"",contact_phone:r.contact_phone||r.phone||r.primary_contact?.phone||r.lead?.phone||"",contact_position:r.contact_position||r.primary_contact?.position||r.lead?.position||""};console.log("Company Name resolved:",{fromProp:r.company_name,fromLead:r.lead?.company_name,fromClientCode:r.client_code,fromName:r.name,finalValue:x}),console.log("Contact data resolved:",h);const g={company_name:x,client_type_id:r.client_type_id||(d.length>0?d[0].id:""),status:r.is_active?"active":"inactive",city:r.city||"",province:r.province||"",country:r.country||"",postal_code:r.postal_code?.toString()||"",vat_number:r.vat_number?.toString()||"",nib:r.nib||"",website:r.website||"",logo:null,logo_preview:r.logo_url||"",delete_logo:!1,contact_person:h.contact_person,contact_email:h.contact_email,contact_phone:h.contact_phone,contact_position:h.contact_position};console.log("Form data to be set:",g),a(g);const k=h.contact_person||h.contact_email||h.contact_phone;$(!!k),!k&&r.id&&await I(r.id,g),console.log("=== FORM INITIALIZED SUCCESSFULLY ===")}catch(x){console.error("Error during form initialization:",x)}finally{u(!0),U.current=!1}}})(),()=>{s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview)}),[v,r,d]);const I=async(j,x)=>{z(!0);try{console.log("Fetching contact data from API for company:",j);const h=await S.get(`/api/companies/${j}/primary-contact`);if(h.data.success&&h.data.data){const g=h.data.data;console.log("Contact API data received:",g),a(k=>({...k,contact_person:g.name||"",contact_email:g.email||"",contact_phone:g.phone||"",contact_position:g.position||""})),$(!0)}else console.log("No contact data from API"),$(!1)}catch(h){console.error("Error fetching contact data:",h),$(!1)}finally{z(!1)}},N=j=>{const{name:x,value:h,type:g,checked:k,files:Q}=j.target;if(x==="company_name"){console.log("Company name is read-only, ignoring change attempt");return}if(g==="radio")a(R=>({...R,[x]:h}));else if(g==="file"){const R=Q[0];if(R){T(R);const w=URL.createObjectURL(R);a(H=>({...H,logo:R,logo_preview:w,delete_logo:!1}))}}else a(R=>({...R,[x]:h}));m[x]&&c(R=>({...R,[x]:null}))},f=()=>{s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview),a(j=>({...j,logo:null,logo_preview:"",delete_logo:!0})),T(null)},L=async j=>{j.preventDefault(),F(!0),c({});try{const x={company_name:s.company_name||"",client_type_id:s.client_type_id||"",status:s.status||"active",city:s.city||"",province:s.province||"",country:s.country||"",postal_code:s.postal_code&&parseInt(s.postal_code)||null,vat_number:s.vat_number&&parseInt(s.vat_number)||null,nib:s.nib||"",website:s.website||"",contact_person:s.contact_person||"",contact_email:s.contact_email||"",contact_phone:s.contact_phone||"",contact_position:s.contact_position||"",delete_logo:s.delete_logo?"1":"0"};console.log("=== SUBMITTING UPDATE DATA ==="),console.log("Company ID:",r.id),console.log("Company Name (read-only, for validation):",x.company_name),console.log("Client Code (will remain unchanged):",r.client_code),console.log("Full request data:",x);const h=new FormData;Object.keys(x).forEach(k=>{x[k]!==null&&x[k]!==void 0&&h.append(k,x[k])}),s.logo&&(h.append("logo",s.logo),console.log("Logo file appended:",s.logo.name));const g=await S.post(`/companies/${r.id}`,h,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"},params:{_method:"PUT"}});console.log("Server response:",g.data),g.data.success?(alert(g.data.message||n("companies_edit.client_updated_successfully")),s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview),C&&C(g.data.data||r.id),O.reload({only:["companies","statistics"],preserveScroll:!0}),M()):(console.error("Update failed:",g.data),c(g.data.errors||{}),alert(g.data.message||n("companies_edit.failed_to_update_client")))}catch(x){if(console.error("Error updating client:",x),x.response?.status===422){const h=x.response.data.errors||{};c(h),console.log("Validation errors:",h);const g=Object.entries(h).map(([k,Q])=>Array.isArray(Q)?`${k}: ${Q.join(", ")}`:`${k}: ${Q}`);g.length>0?alert(`${n("companies_edit.validation_errors")}:
${g.join(`
`)}`):alert(n("companies_edit.check_form_errors"))}else{const h=x.response?.data?.message||x.message||n("companies_edit.error_occurred");c(g=>({...g,submit:h})),alert(`${n("companies_edit.error_updating_client")}: ${h}`)}}finally{F(!1)}},W=()=>{s.logo_preview&&s.logo_preview.startsWith("blob:")&&URL.revokeObjectURL(s.logo_preview),M()};return!v||!r||!E?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[95vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:n("companies_edit.title")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-gray-600",children:[n("companies_edit.editing"),": ",e.jsx("span",{className:"font-medium",children:r.client_code})]}),r.id&&e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded text-gray-500",children:["ID: ",r.id]})]}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Company Name: "}),e.jsx("span",{className:"text-blue-600 font-semibold",children:s.company_name}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Read Only - from Leads)"})]}),P?e.jsxs("p",{className:"text-sm text-blue-600 mt-1 flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),n("companies_edit.loading_contact_data")]}):X?e.jsxs("p",{className:"text-sm text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),n("companies_edit.contact_data_loaded")]}):e.jsxs("p",{className:"text-sm text-yellow-600 mt-1 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),n("companies_edit.no_contact_data")]})]}),e.jsx("button",{onClick:W,className:"p-2 hover:bg-gray-100 rounded-lg transition",disabled:b,children:e.jsx(V,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("form",{onSubmit:L,className:"overflow-y-auto max-h-[calc(95vh-180px)]",children:[e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-900 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(J,{className:"w-6 h-6 text-blue-600"})}),n("companies_edit.contact_person_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.contact_person_name")," *"]}),e.jsx("input",{type:"text",name:"contact_person",value:s.contact_person,onChange:N,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition ${m.contact_person?"border-red-300 bg-red-50":"border-blue-200"}`,placeholder:n("companies_edit.contact_person_placeholder"),required:!0}),m.contact_person&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),m.contact_person]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.position")]}),e.jsx("input",{type:"text",name:"contact_position",value:s.contact_position,onChange:N,className:"w-full px-4 py-3 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:n("companies_edit.position_placeholder")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.email_address")," *"]}),e.jsx("input",{type:"email",name:"contact_email",value:s.contact_email,onChange:N,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition ${m.contact_email?"border-red-300 bg-red-50":"border-blue-200"}`,placeholder:n("companies_edit.email_placeholder"),required:!0}),m.contact_email&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),m.contact_email]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-500"}),n("companies_edit.phone_number")," *"]}),e.jsx("input",{type:"tel",name:"contact_phone",value:s.contact_phone,onChange:N,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition ${m.contact_phone?"border-red-300 bg-red-50":"border-blue-200"}`,placeholder:n("companies_edit.phone_placeholder"),required:!0}),m.contact_phone&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),m.contact_phone]}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),n("companies_edit.phone_format")]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-teal-50 to-emerald-50 border border-teal-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-teal-900 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-teal-100 rounded-lg",children:e.jsx(B,{className:"w-6 h-6 text-teal-600"})}),n("companies_edit.company_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-teal-500"}),n("companies_edit.company_name")," ",e.jsx("span",{className:"text-red-600",children:"*"}),e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-normal bg-blue-50 px-2 py-0.5 rounded",children:"Read Only"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full px-4 py-3 border border-teal-200 rounded-lg bg-gray-50 text-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"font-medium",children:s.company_name})}),e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Locked"})]})]}),e.jsx("input",{type:"hidden",name:"company_name",value:s.company_name,required:!0})]}),e.jsxs("div",{className:"mt-2 flex items-start text-xs text-gray-500",children:[e.jsx(K,{className:"w-3 h-3 mr-1 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Company name is retrieved from the associated Lead record and cannot be edited here. To change the company name, please update the corresponding Lead in the Leads section."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[n("companies_edit.client_type")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{name:"client_type_id",value:s.client_type_id,onChange:N,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition ${m.client_type_id?"border-red-300 bg-red-50":"border-teal-200"}`,required:!0,children:[e.jsx("option",{value:"",children:n("companies_edit.select_client_type")}),d.map(j=>e.jsxs("option",{value:j.id,children:[j.name," ",j.information?`- ${j.information}`:""]},j.id))]}),m.client_type_id&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m.client_type_id})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-teal-600"}),n("companies_edit.location_information")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[n("companies_edit.city")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"city",value:s.city,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.city_placeholder"),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[n("companies_edit.province")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"province",value:s.province,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.province_placeholder"),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[n("companies_edit.country")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"country",value:s.country,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.country_placeholder"),required:!0})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-teal-600"}),n("companies_edit.business_details")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[n("companies_edit.postal_code")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"postal_code",value:s.postal_code,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.postal_code_placeholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.vat_number")}),e.jsx("input",{type:"text",name:"vat_number",value:s.vat_number,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.vat_number_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.nib_number")}),e.jsx("input",{type:"text",name:"nib",value:s.nib,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.nib_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("companies_edit.website")}),e.jsx("input",{type:"url",name:"website",value:s.website,onChange:N,className:"w-full px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n("companies_edit.website_placeholder")})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:n("companies_edit.company_logo")}),s.logo_preview?e.jsx("div",{className:"relative",children:e.jsx("div",{className:"border-2 border-dashed border-teal-300 rounded-xl p-4 bg-gradient-to-br from-teal-50 to-white",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("img",{src:s.logo_preview,alt:n("companies_edit.logo_preview"),className:"w-40 h-40 object-contain rounded-xl shadow-md"}),e.jsx("button",{type:"button",onClick:f,className:"absolute -top-2 -right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition shadow-lg",title:n("companies_edit.remove_logo"),children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:n("companies_edit.current_logo")})]})})}):e.jsxs("div",{className:"border-2 border-dashed border-teal-300 rounded-xl p-6 text-center bg-gradient-to-br from-teal-50 to-white hover:border-teal-400 transition cursor-pointer",children:[e.jsx("input",{type:"file",id:"logo-upload",name:"logo",onChange:N,className:"hidden",accept:"image/*"}),e.jsxs("label",{htmlFor:"logo-upload",className:"cursor-pointer",children:[e.jsx(Ne,{className:"w-12 h-12 text-teal-400 mx-auto mb-3"}),e.jsx("div",{className:"font-medium text-teal-700 hover:text-teal-800",children:n("companies_edit.upload_new_logo")}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:n("companies_edit.file_requirements")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:n("companies_edit.recommended_size")})]})]})]})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[n("companies_edit.editing_client"),": ",e.jsx("span",{className:"font-semibold",children:r.client_code})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Company Name: ",e.jsx("span",{className:"font-medium text-blue-600",children:s.company_name})]}),e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded",children:"Read Only"})]}),P&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:n("companies_edit.loading_contact_information")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:W,disabled:b,className:"px-5 py-2.5 text-gray-700 hover:text-gray-900 font-medium disabled:opacity-50 hover:bg-gray-200 rounded-lg transition",children:n("companies_edit.cancel")}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2.5 bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all shadow-md hover:shadow-lg",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),n("companies_edit.updating")]}):n("companies_edit.update_client_contact")})]})]})]})]})})},ke=({isOpen:v,onClose:M,company:r,onDelete:d,isBulk:C=!1,selectedCount:n=0,selectedIds:s=[]})=>{const{t:a}=G(),[m,c]=i.useState(!1),[b,F]=i.useState(""),[q,T]=i.useState(""),[P,z]=i.useState(!1);if(i.useEffect(()=>{S.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",S.defaults.withCredentials=!0;const f=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");f&&(S.defaults.headers.common["X-CSRF-TOKEN"]=f)},[]),i.useEffect(()=>{const f=()=>{z(window.innerWidth<640)};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),i.useEffect(()=>{const f=L=>{L.key==="Escape"&&v&&E()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[v]),!v)return null;const X=async()=>{c(!0),T("");try{let f;if(C&&s.length>0){const L=s.map(x=>S.delete(`/companies/${x}`)),j=(await Promise.all(L)).filter(x=>x.data?.success).length;if(j>0)f={data:{success:!0,message:a("companies_delete.bulk_delete_success",{count:j})}};else throw new Error(a("companies_delete.bulk_delete_failed"))}else if(r)f=await S.delete(`/companies/${r.id}`);else throw new Error(a("companies_delete.no_company_selected"));f.data.success?(alert(f.data.message||a("companies_delete.delete_success")),d&&d(),O.reload({only:["companies","statistics"],preserveScroll:!0}),M(),$()):(T(f.data.message||a("companies_delete.delete_failed")),alert(f.data.message||a("companies_delete.delete_failed")))}catch(f){console.error("Delete error:",f);const L=f.response?.data?.message||f.message||a("companies_delete.delete_error_try_again");T(L),alert(`${a("companies_delete.error")}: ${L}`)}finally{c(!1)}},$=()=>{F(""),T("")},E=()=>{$(),M()},u=()=>C?a("companies_delete.bulk_delete_title",{count:n}):a("companies_delete.delete_client"),U=()=>C?a("companies_delete.bulk_delete_message",{count:n}):a("companies_delete.delete_message",{name:r?.client_code||r?.name}),I=()=>C?a("companies_delete.bulk_confirmation",{count:n}):a("companies_delete.confirmation",{name:r?.client_code||r?.name});return(C?s.length>0:r)?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:E}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto relative",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:u()}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:a("companies_delete.can_be_restored")})]})]}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 rounded-lg transition",disabled:m,children:e.jsx(V,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[q&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:q})})]})}),e.jsx("div",{className:"border rounded-lg p-4 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:U()}),!C&&r&&e.jsxs("div",{className:"mt-2 space-y-1",children:[r.client_code&&e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsxs("span",{className:"font-semibold",children:[a("companies_delete.client_code"),":"]})," ",e.jsx("span",{className:"font-mono bg-white px-1 py-0.5 rounded text-xs",children:r.client_code})]}),r.email&&e.jsxs("p",{className:"text-xs text-yellow-600",children:[e.jsxs("span",{className:"font-semibold",children:[a("companies_delete.email"),":"]})," ",r.email]})]}),C&&s.length>0&&e.jsxs("p",{className:"text-xs mt-2 text-yellow-600",children:["ðŸ“‹ ",s.length," ",a("companies_delete.clients_selected")]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(pe,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsxs("span",{className:"font-medium",children:[a("companies_delete.type_to_confirm"),":"]})]}),e.jsx("input",{type:"text",value:b,onChange:f=>F(f.target.value.toUpperCase()),placeholder:a("companies_delete.type_placeholder").toUpperCase(),className:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 font-mono text-center text-base sm:text-lg font-bold uppercase tracking-wider",disabled:m,autoComplete:"off"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${b==="DELETE"?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{children:a(b==="DELETE"?"companies_delete.confirmation_matches":"companies_delete.type_exactly")})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(xe,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-700 font-medium mb-1",children:I()}),e.jsx("p",{className:"text-xs text-gray-500",children:a("companies_delete.can_be_restored_later")})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-4 sm:px-6 py-4 border-t flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{type:"button",onClick:E,disabled:m,className:"px-4 py-2.5 text-gray-700 hover:text-gray-900 font-medium disabled:opacity-50 transition-colors rounded-lg order-2 sm:order-1",children:a("companies_delete.cancel")}),e.jsx("button",{type:"button",onClick:X,disabled:m||b!=="DELETE",className:"px-6 py-2.5 font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors order-1 sm:order-2 bg-red-600 hover:bg-red-700 text-white",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),a("companies_delete.deleting")]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),a("companies_delete.delete_button")]})})]})]})})]}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a("companies_delete.no_data_selected")}),e.jsx("p",{className:"text-gray-600",children:a("companies_delete.select_client_to_delete")}),e.jsx("button",{onClick:M,className:"mt-4 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:a("companies_delete.close")})]})})})},tt=()=>{const{companies:v,statistics:M,types:r,filters:d,fromQuotation:C,quotationId:n,clientTypes:s}=te().props,{t:a}=G();console.log("DEBUG: Props Received:",{companiesCount:v?.data?.length,clientTypesCount:s?.length||r?.length,typesCount:r?.length,companySample:v?.data?.[0]});const[m,c]=i.useState(d.search||""),[b,F]=i.useState(d.client_type_id||""),[q,T]=i.useState(!1),[P,z]=i.useState(!1),[X,$]=i.useState(!1),[E,u]=i.useState(null),[U,I]=i.useState([]),[N,f]=i.useState(null),[L,W]=i.useState(null),j=i.useRef(null);i.useEffect(()=>{C&&n&&T(!0)},[C,n]),i.useEffect(()=>{const t=o=>{j.current&&!j.current.contains(o.target)&&f(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const x=i.useCallback(t=>{O.get("/companies",{search:t,client_type_id:b},{preserveState:!0,replace:!0,only:["companies","filters","statistics"]})},[b]),h=i.useCallback(t=>{const o=t===b?"":t;F(o),O.get("/companies",{search:m,client_type_id:o},{preserveState:!0,replace:!0,only:["companies","filters","statistics"]})},[m,b]),g=()=>{c(""),F(""),O.get("/companies",{},{preserveState:!0,replace:!0,only:["companies","filters","statistics"]})},k=()=>{T(!1),O.reload({only:["companies","statistics"],preserveScroll:!0})},Q=t=>{console.log("=== EDIT CLICKED ==="),console.log("Original company data:",t),console.log("Lead data:",t.lead),console.log("Primary contact:",t.primary_contact);const o={id:t.id,client_code:t.client_code||"",company_name:t.company_name||t.lead?.company_name||t.client_code||t.name||"",contact_person:t.contact_person||t.primary_contact?.name||t.lead?.contact_person||"",contact_email:t.email||t.primary_contact?.email||t.lead?.email||"",contact_phone:t.phone||t.primary_contact?.phone||t.lead?.phone||"",contact_position:t.contact_position||t.primary_contact?.position||t.lead?.position||"",client_type_id:t.client_type_id||"",city:t.city||"",province:t.province||"",country:t.country||"",postal_code:t.postal_code?.toString()||"",vat_number:t.vat_number?.toString()||"",nib:t.nib||"",website:t.website||"",logo_url:t.logo_url||"",is_active:t.is_active||!1,primary_contact:t.primary_contact,lead:t.lead,name:t.name};console.log("Prepared company data for edit:",o),console.log("Company Name source:",{fromCompanyProp:t.company_name,fromLead:t.lead?.company_name,fromClientCode:t.client_code,finalValue:o.company_name}),u(o),z(!0)},R=t=>{console.log("Delete clicked for:",t.id),u(t),$(!0)},w=t=>{console.log("Update successful:",t),z(!1),u(null),O.reload({only:["companies","statistics"],preserveScroll:!0})},H=async t=>{if(E)try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");let y=`/companies/${E.id}`;t==="permanent"&&(y=`/companies/force-delete/${E.id}`);const p=await fetch(y,{method:t==="permanent"?"DELETE":"POST",headers:{"X-CSRF-TOKEN":o,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),D=await p.json();if(!p.ok)throw new Error(D.message||a("companies.delete_failed"));alert(D.message||a("companies.client_deleted_successfully")),$(!1),u(null),O.reload({only:["companies","statistics"],preserveScroll:!0})}catch(o){console.error("Delete error:",o),alert(a("companies.delete_failed_try_again"))}};i.useEffect(()=>{const t=setTimeout(()=>{m!==d.search&&x(m)},500);return()=>clearTimeout(t)},[m]);const l=[{key:"client_name",label:a("companies.table.client_name"),render:(t,o)=>{const y=o.company_name||o.lead?.company_name||o.name||"-";return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("button",{onClick:p=>{p.stopPropagation(),A(o)},className:"font-medium text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1 transition-colors",children:[y,e.jsx(ue,{className:"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:o.client_code})]})}},{key:"address",label:a("companies.table.address"),render:(t,o)=>{const y=o.is_active,p=[o.city,o.province,o.country].filter(Boolean),D=p.length>0?p.join(", "):o.address||"-";return e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${y?"text-gray-900":"text-gray-500"}`,children:D}),!y&&e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:a("companies.inactive")})]})}},{key:"contact_person",label:a("companies.table.contact_person"),render:(t,o)=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t||"-"}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:o.contact_position||"-"})]})},{key:"contact_info",label:a("companies.table.contact"),render:(t,o)=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.email||"-"}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:o.phone||"-"})]})},{key:"client_type_name",label:a("companies.table.status"),render:t=>e.jsx("span",{className:"font-semibold text-green-700 bg-green-50 rounded px-2 py-1 text-xs",children:t||"-"})},{key:"client_since",label:a("companies.table.client_since"),render:t=>e.jsx("div",{className:"text-sm text-gray-600",children:t?new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"})}],_=v.data?.map((t,o)=>{const y=t.company_name||t.lead?.company_name||t.client_code||t.name||"-";return{id:t.id,client_name:y,company_name:y,address:t.address||"-",city:t.city||"",province:t.province||"",country:t.country||"",contact_person:t.contact_person||"-",email:t.email||"-",phone:t.phone||"-",contact_position:t.contact_position||"",client_code:t.client_code||"",client_type_name:t.client_type_name||a("companies.unknown"),client_type_id:t.client_type_id||"",is_active:t.is_active||!1,client_since:t.client_since||"-",created_at:t.created_at||"",postal_code:t.postal_code||"",vat_number:t.vat_number||"",nib:t.nib||"",website:t.website||"",logo_url:t.logo_url||"",primary_contact:t.primary_contact,lead:t.lead,name:t.name}})||[],A=t=>{O.visit(`/companies/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsx(re,{title:a("companies.title")}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xl font-black uppercase tracking-widest text-gray-800",children:a("companies.title")})}),C&&n&&e.jsx("div",{className:"w-full sm:w-auto bg-blue-50 border border-blue-200 rounded-lg p-3 mb-2 sm:mb-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:a("companies.from_quotation_notification")})]}),e.jsx("button",{onClick:()=>O.get("/companies"),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:a("companies.skip")})]})}),e.jsx("div",{className:"flex gap-3 w-full sm:w-auto",children:e.jsxs("button",{onClick:()=>T(!0),className:"inline-flex items-center rounded-md border border-transparent px-5 py-2.5 text-sm font-medium font-semibold uppercase tracking-widest text-white transition duration-150 ease-in-out bg-[rgb(17,94,89)] hover:bg-[rgb(13,75,71)] focus:bg-[rgb(13,75,71)] focus:outline-none focus:ring-2 focus:ring-[rgb(17,94,89)] focus:ring-offset-2 active:bg-[rgb(10,60,57)] w-full sm:w-auto flex items-center justify-center gap-2 shadow-sm hover:shadow",children:[e.jsx(he,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:a("companies.add_new_client")})]})})]}),q&&e.jsx(we,{isOpen:q,onClose:()=>T(!1),clientTypes:r,quotationId:n,onSuccess:k}),P&&E&&e.jsx(Ce,{isOpen:P,onClose:()=>{z(!1),u(null)},company:E,clientTypes:s||r,onUpdate:w}),X&&e.jsx(ke,{isOpen:X,onClose:()=>{$(!1),u(null)},company:E,onDelete:H}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 my-7",children:M.client_types?.map((t,o)=>{const y=["border-blue-200 bg-blue-100","border-green-200 bg-green-100","border-orange-200 bg-orange-100","border-purple-200 bg-purple-100"],p=y[o%y.length];return e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${p} transition-transform hover:scale-[1.02] hover:shadow-md min-h-[120px] flex flex-col justify-between`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 uppercase tracking-wide",children:t.name}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:t.count})]}),e.jsx("div",{className:"p-3 rounded-full bg-white",children:e.jsx(B,{className:"w-6 h-6 text-blue-600"})})]})},t.id)})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 mb-6",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(se,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:a("companies.search_placeholder"),value:m,onChange:t=>c(t.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm transition-all duration-200"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b,onChange:t=>h(t.target.value),className:"w-full sm:w-64 border border-gray-300 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white pr-10",children:[e.jsx("option",{value:"",children:a("companies.all_client_types")}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}),(m||b)&&e.jsxs("button",{onClick:g,className:"px-4 py-3 border border-gray-300 text-gray-700 rounded-xl text-sm font-medium hover:bg-gray-50 transition-colors duration-200 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(V,{className:"h-4 w-4"}),a("companies.clear_filters")]})]}),(m||b)&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[m&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[a("companies.search_label",{search:m}),e.jsx("button",{onClick:()=>c(""),className:"ml-1.5 text-blue-600 hover:text-blue-800",children:"Ã—"})]}),b&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[`${a("companies.type_label")}: ${r.find(t=>t.id===b)?.name||a("companies.selected")}`,e.jsx("button",{onClick:()=>F(""),className:"ml-1.5 text-green-600 hover:text-green-800",children:"Ã—"})]})]})]})})}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsx(ne,{columns:l,data:_,onEdit:Q,onDelete:R,showAction:!0,pagination:{currentPage:v.current_page||1,totalPages:v.last_page||1,totalItems:v.total||0,itemsPerPage:v.per_page||10,onPageChange:t=>{O.get("/companies",{page:t,search:m,client_type_id:b},{preserveState:!0,replace:!0})}},onRowClick:A})})})]})]})};export{tt as default};
