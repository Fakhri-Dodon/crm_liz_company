import{r as n,j as e}from"./app-D-CXuYp-.js";import{u as H}from"./useTranslation-C5DOJpQ8.js";import{C as J}from"./circle-x-BPC9WWbp.js";import{c as $}from"./createLucideIcon-Da68c0mB.js";import{C as Q}from"./circle-check-big-DBPc4ZFd.js";import{F as R}from"./folder-kanban-BEhscMpt.js";import{C as W}from"./calendar-BLzufnGW.js";import{C as Y}from"./clock-C8BQT89T.js";import{S as T}from"./square-pen-BuP-lLgl.js";import{T as O}from"./trash-2-C428PtZi.js";import{X as Z}from"./x-7oBENnvo.js";import{L as ee}from"./loader-circle-Cmn6e3Cc.js";import{S as te}from"./save-BGJLkOYD.js";const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],re=$("circle-pause",se);const ae=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],le=$("circle-play",ae);const ne=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],ce=$("ellipsis-vertical",ne),_e=({data:m,onEdit:w,onDelete:b,auth_permissions:B})=>{const{t:s}=H(),[k,C]=n.useState(null),[S,j]=n.useState(!1),[i,f]=n.useState(null),[a,y]=n.useState({project_description:"",start_date:"",deadline:"",status:"pending",note:""}),[d,M]=n.useState(!1),[c,p]=n.useState({}),o=n.useRef(null),L=n.useRef(null),_=B||{};_.can_read,_.can_create;const N=_.can_update===1,v=_.can_delete===1,u=n.useCallback(t=>{if(!t)return"pending";const r=t.toLowerCase();return["progress","active","on_progress","in_progress"].includes(r)?"in_progress":["done","finished","completed"].includes(r)?"completed":["canceled","cancelled","rejected"].includes(r)?"cancelled":(["delayed","overdue","draft","new","pending"].includes(r),"pending")},[]),z=n.useCallback(t=>({in_progress:"in_progress",completed:"completed",cancelled:"cancelled",pending:"pending"})[t]||"pending",[]);n.useEffect(()=>{if(i){const t=u(i.status);y({project_description:i.project_description||"",start_date:i.start_date?new Date(i.start_date).toISOString().split("T")[0]:"",deadline:i.deadline?new Date(i.deadline).toISOString().split("T")[0]:"",status:t,note:i.note||""}),p({}),setTimeout(()=>{if(o.current){o.current.focus();const r=o.current.value.length;o.current.setSelectionRange(r,r)}},50)}},[i,u]),n.useEffect(()=>{S||setTimeout(()=>{y({project_description:"",start_date:"",deadline:"",status:"pending",note:""}),p({}),M(!1)},300)},[S]);const g=n.useCallback(t=>{if(!t)return s("project_table.not_available");try{return new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}catch{return t}},[s]),P=n.useCallback(t=>{if(!t)return 0;try{const r=new Date,x=new Date(t)-r;return Math.ceil(x/(1e3*60*60*24))}catch{return 0}},[]),E=n.useCallback(t=>{const r="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(u(t)){case"in_progress":return e.jsxs("span",{className:`${r} bg-blue-100 text-blue-800`,children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),s("project_table.status_in_progress")]});case"completed":return e.jsxs("span",{className:`${r} bg-green-100 text-green-800`,children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),s("project_table.status_completed")]});case"pending":return e.jsxs("span",{className:`${r} bg-yellow-100 text-yellow-800`,children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),s("project_table.status_pending")]});case"cancelled":return e.jsxs("span",{className:`${r} bg-red-100 text-red-800`,children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),s("project_table.status_cancelled")]});default:return e.jsx("span",{className:`${r} bg-gray-100 text-gray-800`,children:t||s("project_table.status_unknown")})}},[u,s]),D=n.useCallback((t,r)=>{const l=u(r);return l==="completed"?s("project_table.completed"):l==="cancelled"?s("project_table.cancelled"):t!=null?t<0?s("project_table.days_late",{days:Math.abs(t)}):t===0?s("project_table.today"):t===1?s("project_table.tomorrow"):s("project_table.days_left",{days:t}):s("project_table.not_available")},[u,s]),F=n.useCallback((t,r)=>{const l=u(r);return l==="completed"?"text-green-800 bg-green-100":l==="cancelled"?"text-red-800 bg-red-100":t!=null?t<0?"text-red-800 bg-red-100":t<=7?"text-yellow-800 bg-yellow-100":"text-green-800 bg-green-100":"text-gray-800 bg-gray-100"},[u]),A=t=>{C(k===t?null:t)},q=t=>{console.log("Opening edit modal for project:",t),f(t),j(!0),C(null)},h=n.useCallback(t=>{const{name:r,value:l}=t.target;if(r==="project_description"&&o.current){const x=o.current.selectionStart;y(G=>({...G,[r]:l})),setTimeout(()=>{o.current&&(o.current.focus(),o.current.setSelectionRange(x,x))},0)}else y(x=>({...x,[r]:l}));c[r]&&p(x=>({...x,[r]:""}))},[c]),U=n.useCallback(()=>{const t={};return a.project_description.trim()||(t.project_description=s("project_table.errors.description_required")),a.start_date||(t.start_date=s("project_table.errors.start_date_required")),a.deadline?a.start_date&&a.deadline<a.start_date&&(t.deadline=s("project_table.errors.deadline_before_start")):t.deadline=s("project_table.errors.deadline_required"),a.status||(t.status=s("project_table.errors.status_required")),t},[a,s]),V=async t=>{t.preventDefault(),console.log("Submitting form data:",a);const r=U();if(Object.keys(r).length>0){p(r),console.error("Form validation errors:",r);return}M(!0);try{const l={...i,project_description:a.project_description,start_date:a.start_date,deadline:a.deadline,status:z(a.status),note:a.note};console.log("Calling onEdit with updated project:",l),w&&typeof w=="function"?await w(l)?(j(!1),f(null),p({}),console.log("Project edit successful")):console.error("Parent onEdit callback returned false"):(console.warn("onEdit prop not provided or not a function"),j(!1),f(null))}catch(l){console.error("Error in form submission:",l),p({submit:s("project_table.errors.submission_failed")})}finally{M(!1)}},I=()=>{d||(j(!1),f(null),p({}))},X=n.useCallback(({project:t,index:r})=>{const l=t.days_left!==void 0?t.days_left:P(t.deadline);return e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-3 hover:shadow-sm transition-shadow",children:e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-50 p-2 rounded-lg",children:e.jsx(R,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 text-sm leading-tight mb-1",children:[r+1,"."," ",t.project_description?.substring(0,60)||s("project_table.no_description"),t.project_description?.length>60&&"..."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),s("project_table.start"),":"," ",g(t.start_date)]}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),s("project_table.deadline"),":"," ",g(t.deadline)]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>A(r),className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(ce,{className:"w-4 h-4"})}),k===r&&(N||v)&&e.jsxs("div",{className:"absolute right-0 mt-1 w-32 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[N&&e.jsxs("button",{onClick:()=>q(t),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-2"}),s("project_table.edit")]}),v&&e.jsxs("button",{onClick:()=>{b&&typeof b=="function"&&b(t),C(null)},className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-gray-50 flex items-center",children:[e.jsx(O,{className:"w-3 h-3 mr-2"}),s("project_table.delete")]})]})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("div",{className:`px-2 py-1 rounded text-xs ${F(l,t.status)}`,children:D(l,t.status)}),E(t.status)]}),t.note&&e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s("project_table.note_label"),":"]})," ",t.note]})]})]})})})},[k,P,g,F,D,E,b,s]),K=()=>!S||!i?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{ref:L,className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("project_table.edit_project_title")||"Edit Proyek"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s("project_table.edit_project_subtitle")||"Ubah detail proyek"})]})]}),e.jsx("button",{type:"button",onClick:I,disabled:d,className:"text-gray-400 hover:text-gray-600 p-1 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:V,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("project_table.project_description")||"Deskripsi Proyek",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("textarea",{ref:o,name:"project_description",value:a.project_description,onChange:h,onBlur:t=>{!t.target.value.trim()&&!c.project_description&&p(r=>({...r,project_description:s("project_table.errors.description_required")}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${c.project_description?"border-red-300":"border-gray-300"}`,rows:"4",placeholder:s("project_table.description_placeholder")||"Masukkan deskripsi proyek...",required:!0,disabled:d,autoComplete:"off",spellCheck:"true","data-lpignore":"true","data-form-type":"other"}),c.project_description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.project_description}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[a.project_description.length," ","karakter"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("project_table.start_date")||"Tanggal Mulai",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"date",name:"start_date",value:a.start_date,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${c.start_date?"border-red-300":"border-gray-300"}`,required:!0,disabled:d}),c.start_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.start_date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("project_table.deadline")||"Deadline",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"date",name:"deadline",value:a.deadline,onChange:h,min:a.start_date,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${c.deadline?"border-red-300":"border-gray-300"}`,required:!0,disabled:d}),c.deadline&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.deadline})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("project_table.status")||"Status",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{name:"status",value:a.status,onChange:h,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${c.status?"border-red-300":"border-gray-300"}`,required:!0,disabled:d,children:[e.jsx("option",{value:"pending",children:s("project_table.status_pending")||"Pending"}),e.jsx("option",{value:"in_progress",children:s("project_table.status_in_progress")||"In Progress"}),e.jsx("option",{value:"completed",children:s("project_table.status_completed")||"Completed"}),e.jsx("option",{value:"cancelled",children:s("project_table.status_cancelled")||"Cancelled"})]}),c.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("project_table.note")||"Catatan"}),e.jsx("textarea",{name:"note",value:a.note,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",rows:"3",placeholder:s("project_table.note_placeholder")||"Masukkan catatan tambahan...",disabled:d})]})]}),c.submit&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:c.submit})}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:d,children:s("project_table.cancel")||"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center min-w-[120px]",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2 animate-spin"}),s("project_table.saving")||"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),s("project_table.save_changes")||"Simpan Perubahan"]})})]})]})]})});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:s("project_table.title")||"Daftar Proyek"}),e.jsx("div",{className:"sm:hidden",children:m.map((t,r)=>e.jsx(X,{project:t,index:r},t.id||r))}),e.jsx("div",{className:"hidden sm:block overflow-hidden rounded-lg border border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.no")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.project_description")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.start_date")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.deadline")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.time_left")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.status")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.note")}),(N||v)&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:s("project_table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((t,r)=>{const l=t.days_left!==void 0?t.days_left:P(t.deadline);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:r+1}),e.jsx("td",{className:"px-4 py-3 max-w-[300px]",children:e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:t.project_description||s("project_table.not_available")})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:g(t.start_date)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:g(t.deadline)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${F(l,t.status)}`,children:D(l,t.status)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:E(t.status)}),e.jsx("td",{className:"px-4 py-3 max-w-[200px]",children:e.jsx("div",{className:"text-sm text-gray-600 truncate",title:t.note,children:t.note||s("project_table.not_available")})}),(N||v)&&e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>q(t),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:s("project_table.edit_project"),children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{b&&typeof b=="function"&&b(t)},className:"p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:s("project_table.delete_project"),children:e.jsx(O,{className:"w-4 h-4"})})]})})]},t.id||r)})})]})})}),m.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s("project_table.no_projects_found")}),e.jsx("p",{className:"text-gray-600",children:s("project_table.no_projects_message")})]}),m.length>0&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("project_table.total_projects")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.length})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("project_table.completed")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.filter(t=>["completed","done","finished"].includes(t.status?.toLowerCase())).length})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("project_table.pending")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.filter(t=>["pending","delayed","overdue","draft","new"].includes(t.status?.toLowerCase())).length})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("project_table.cancelled")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.filter(t=>["cancelled","canceled","rejected"].includes(t.status?.toLowerCase())).length})]})]})}),e.jsx(K,{})]})};export{_e as default};
