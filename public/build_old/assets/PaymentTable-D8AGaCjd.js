import{r as d,j as e}from"./app-D-CXuYp-.js";import{u as ne}from"./useTranslation-C5DOJpQ8.js";import{C as oe}from"./credit-card-DQOa8dG8.js";import{C as I}from"./circle-check-big-DBPc4ZFd.js";import{C as z}from"./circle-alert-DIyWWGnv.js";import{S as de}from"./search-BSE1nh5m.js";import{L as A}from"./loader-D_qCqTK_.js";import{T as H}from"./trash-2-C428PtZi.js";import{S as ce}from"./square-pen-BuP-lLgl.js";import{X as ie}from"./x-7oBENnvo.js";import{S as me}from"./save-BGJLkOYD.js";import"./createLucideIcon-Da68c0mB.js";const Le=({data:T,companyId:j,showInvoiceAmount:xe=!1,auth_permissions:K})=>{const{t:s}=ne(),[u,v]=d.useState(T||[]),[l,p]=d.useState(!1),[ue,he]=d.useState(null),[W,C]=d.useState(!1),[J,E]=d.useState(!1),[c,k]=d.useState(null),[n,b]=d.useState({amount:"",method:"transfer",date:"",bank:"",note:""}),[y,$]=d.useState({}),[h,U]=d.useState(""),[S,V]=d.useState("all"),[M,pe]=d.useState("date"),[q,be]=d.useState("desc"),[m,N]=d.useState([]),[w,O]=d.useState({show:!1,type:"success",message:""}),D=K||{};D.can_read,D.can_create;const P=D.can_update===1,_=D.can_delete===1;d.useEffect(()=>{v(T||[])},[T]);const i=(t,r)=>{O({show:!0,type:t,message:r}),setTimeout(()=>{O({show:!1,type:"success",message:""})},3e3)},L=t=>!t&&t!==0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),X=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}catch{return"-"}},g=d.useMemo(()=>u.filter(t=>{const r=h===""||t.invoice_number&&t.invoice_number.toLowerCase().includes(h.toLowerCase())||t.invoice?.invoice_number&&t.invoice.invoice_number.toLowerCase().includes(h.toLowerCase())||t.bank&&t.bank.toLowerCase().includes(h.toLowerCase())||t.note&&t.note.toLowerCase().includes(h.toLowerCase())||t.method&&t.method.toLowerCase().includes(h.toLowerCase()),a=S==="all"||t.method?.toLowerCase()===S;return r&&a}).sort((t,r)=>{if(M==="date"){const a=t.date?new Date(t.date):new Date(0),o=r.date?new Date(r.date):new Date(0);return q==="desc"?o-a:a-o}if(M==="amount"){const a=Number(t.amount||0),o=Number(r.amount||0);return q==="desc"?o-a:a-o}return 0}),[u,h,S,M,q]),F=t=>t.invoice?.invoice_number||`INV-${t.invoice_id?.substring(0,8)||"N/A"}`,Y=t=>{const r=(t||"").toLowerCase(),a="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(r){case"transfer":return e.jsx("span",{className:`${a} bg-blue-100 text-blue-800`,children:s("payment_table.transfer")});case"cash":return e.jsx("span",{className:`${a} bg-green-100 text-green-800`,children:s("payment_table.cash")});case"check":return e.jsx("span",{className:`${a} bg-purple-100 text-purple-800`,children:s("payment_table.check")});default:return e.jsx("span",{className:`${a} bg-gray-100 text-gray-800`,children:r||"-"})}},G=t=>{k(t);let r="";if(t.date)try{const a=new Date(t.date);if(!isNaN(a.getTime())){const o=a.getFullYear(),x=String(a.getMonth()+1).padStart(2,"0"),f=String(a.getDate()).padStart(2,"0");r=`${o}-${x}-${f}`}}catch{r=new Date().toISOString().split("T")[0]}else r=new Date().toISOString().split("T")[0];b({amount:t.amount||"",method:t.method||"transfer",date:r,bank:t.bank||"",note:t.note||""}),$({}),C(!0)},Q=async()=>{if(!c||!j){i("error",s("payment_table.missing_data"));return}if(!n.amount||!n.date){$({amount:n.amount?"":s("payment_table.amount_required"),date:n.date?"":s("payment_table.date_required")});return}p(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",a=await(await fetch(`/companies/${j}/payments/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"include",body:JSON.stringify(n)})).json();if(a.success){const o={...c,amount:n.amount,method:n.method,date:n.date,bank:n.bank,note:n.note,updated_at:new Date().toISOString()};v(x=>x.map(f=>f.id===c.id?o:f)),i("success",a.message||s("payment_table.payment_updated")),C(!1),k(null),setTimeout(()=>{window.location.reload()},1e3)}else $(a.errors||{}),i("error",a.message||s("payment_table.update_failed"))}catch(t){console.error("Error:",t),i("error",s("payment_table.network_error"))}finally{p(!1)}},Z=t=>{k(t),E(!0)},ee=async()=>{if(!c||!j){i("error",s("payment_table.missing_data"));return}p(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",a=await(await fetch(`/companies/${j}/payments/${c.id}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"include"})).json();a.success?(v(o=>o.filter(x=>x.id!==c.id)),N(o=>o.filter(x=>x!==c.id)),i("success",a.message||s("payment_table.payment_deleted")),E(!1),k(null),setTimeout(()=>{window.location.reload()},1e3)):i("error",a.message||s("payment_table.delete_failed"))}catch(t){console.error("Error:",t),i("error",s("payment_table.network_error"))}finally{p(!1)}},te=async()=>{if(m.length===0){i("warning",s("payment_table.no_selection"));return}const t=s("payment_table.bulk_delete_confirm",{count:m.length});if(window.confirm(t)){p(!0);try{const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",o=await(await fetch(`/companies/${j}/payments/bulk-delete`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"include",body:JSON.stringify({payment_ids:m})})).json();o.success?(v(x=>x.filter(f=>!m.includes(f.id))),N([]),i("success",o.message||s("payment_table.payments_deleted")),setTimeout(()=>{window.location.reload()},1e3)):i("error",o.message||s("payment_table.delete_failed"))}catch(r){console.error("Error:",r),i("error",s("payment_table.network_error"))}finally{p(!1)}}},se=()=>{m.length===g.length&&g.length>0?N([]):N(g.map(t=>t.id))},ae=t=>{N(r=>r.includes(t)?r.filter(a=>a!==t):[...r,t])},R=u.length,B=u.reduce((t,r)=>t+(Number(r.amount)||0),0),re=u.filter(t=>t.method?.toLowerCase()==="transfer").length,le=u.filter(t=>t.method?.toLowerCase()==="cash").length;return u.filter(t=>t.method?.toLowerCase()==="check").length,u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s("payment_table.no_payments_found")}),e.jsx("p",{className:"text-gray-500",children:s("payment_table.no_payments_message")})]}):e.jsxs("div",{className:"relative",children:[w.show&&e.jsx("div",{className:`fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg ${w.type==="success"?"bg-green-100 text-green-800 border border-green-200":w.type==="error"?"bg-red-100 text-red-800 border border-red-200":"bg-yellow-100 text-yellow-800 border border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[w.type==="success"?e.jsx(I,{className:"w-5 h-5 mr-2"}):e.jsx(z,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:w.message})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:s("payment_table.payment_history")}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R," ",s("payment_table.total_payments").toLowerCase(),R!==1?"s":""," • ",L(B)," ",s("payment_table.total_received").toLowerCase()]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:s("payment_table.search_placeholder"),value:h,onChange:t=>U(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:l})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("select",{value:S,onChange:t=>V(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:l,children:[e.jsx("option",{value:"all",children:s("payment_table.all_methods")}),e.jsx("option",{value:"transfer",children:s("payment_table.transfer")}),e.jsx("option",{value:"cash",children:s("payment_table.cash")}),e.jsx("option",{value:"check",children:s("payment_table.check")})]})})]}),m.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("span",{className:"font-medium text-blue-800",children:[m.length," ",s("payment_table.selected")]})]}),e.jsxs("button",{onClick:te,disabled:l,className:"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 flex items-center disabled:opacity-50",children:[l?e.jsx(A,{className:"w-4 h-4 animate-spin mr-1"}):e.jsx(H,{className:"w-4 h-4 mr-1"}),s("payment_table.delete_selected")]})]})})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[_&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:e.jsx("input",{type:"checkbox",checked:m.length===g.length&&g.length>0,onChange:se,className:"h-4 w-4 text-blue-600 rounded",disabled:l})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.invoice")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.date")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.amount")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.method")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.bank")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.notes")}),(P||_)&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:s("payment_table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[_&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:m.includes(t.id),onChange:()=>ae(t.id),className:"h-4 w-4 text-blue-600 rounded",disabled:l})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"font-medium text-gray-900",children:F(t)})}),e.jsx("td",{className:"px-4 py-3",children:X(t.date)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"font-bold text-green-700",children:L(t.amount)})}),e.jsx("td",{className:"px-4 py-3",children:Y(t.method)}),e.jsx("td",{className:"px-4 py-3",children:t.bank||"-"}),e.jsx("td",{className:"px-4 py-3 max-w-[200px]",children:e.jsx("div",{className:"text-sm text-gray-600 truncate",children:t.note||"-"})}),(P||_)&&e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex space-x-2",children:[P&&e.jsx("button",{onClick:()=>G(t),disabled:l,className:"p-1 text-blue-600 hover:text-blue-900 hover:bg-blue-50 rounded disabled:opacity-50",title:s("payment_table.edit_payment"),children:e.jsx(ce,{className:"w-4 h-4"})}),_&&e.jsx("button",{onClick:()=>Z(t),disabled:l,className:"p-1 text-red-600 hover:text-red-900 hover:bg-red-50 rounded disabled:opacity-50",title:s("payment_table.delete"),children:e.jsx(H,{className:"w-4 h-4"})})]})})]},t.id))})]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("payment_table.total_payments")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("payment_table.total_received")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:L(B)})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("payment_table.transfers")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:re})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s("payment_table.cash")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:le})]})]}),W&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s("payment_table.edit_payment")}),e.jsx("button",{onClick:()=>C(!1),disabled:l,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("payment_table.amount")," *"]}),e.jsx("input",{type:"number",step:"0.01",value:n.amount,onChange:t=>b({...n,amount:t.target.value}),className:`w-full px-3 py-2 border ${y.amount?"border-red-300":"border-gray-300"} rounded-lg`,required:!0,disabled:l}),y.amount&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:y.amount})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("payment_table.method")," *"]}),e.jsxs("select",{value:n.method,onChange:t=>b({...n,method:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",disabled:l,children:[e.jsx("option",{value:"transfer",children:s("payment_table.transfer")}),e.jsx("option",{value:"cash",children:s("payment_table.cash")}),e.jsx("option",{value:"check",children:s("payment_table.check")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("payment_table.date")," *"]}),e.jsx("input",{type:"date",value:n.date,onChange:t=>b({...n,date:t.target.value}),className:`w-full px-3 py-2 border ${y.date?"border-red-300":"border-gray-300"} rounded-lg`,required:!0,disabled:l}),y.date&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:y.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("payment_table.bank")}),e.jsx("input",{type:"text",value:n.bank,onChange:t=>b({...n,bank:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("payment_table.notes")}),e.jsx("textarea",{value:n.note,onChange:t=>b({...n,note:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:"3",disabled:l})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t",children:[e.jsx("button",{onClick:()=>C(!1),disabled:l,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:s("payment_table.cancel")}),e.jsxs("button",{onClick:Q,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center",children:[l?e.jsx(A,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(me,{className:"w-4 h-4 mr-2"}),s("payment_table.update")]})]})]})})}),J&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(z,{className:"w-8 h-8 text-red-600 mr-3"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s("payment_table.confirm_delete")})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("payment_table.delete_confirm_message")}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded mb-6",children:[e.jsxs("p",{className:"font-medium",children:[s("payment_table.invoice"),": ",F(c)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[X(c.date)," • ",L(c.amount)]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>E(!1),disabled:l,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:s("payment_table.cancel")}),e.jsx("button",{onClick:ee,disabled:l,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 flex items-center",children:l?e.jsx(A,{className:"w-4 h-4 animate-spin"}):s("payment_table.delete")})]})]})})})]})};export{Le as default};
