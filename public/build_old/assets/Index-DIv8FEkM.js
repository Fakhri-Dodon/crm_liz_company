import{a as O,r as v,u as B,j as t,c as p}from"./app-Dyd-VK-i.js";import{S as y,H as V}from"./HeaderLayout-Btj1rOYY.js";import{T as J}from"./TableLayout-BIe_S7av.js";import{P as M}from"./PrimaryButton-BnqY-Jkt.js";import{u as H}from"./useTranslation-C1duoCZq.js";import{S as Y}from"./search-AUTQuBot.js";import{C as q}from"./calendar-CWDjbzSs.js";import{F as z}from"./funnel-BzYyzyFn.js";import{R as G}from"./refresh-cw-51J-93ua.js";import"./transition-BVEVT5Dk.js";import"./index-BAWYnhaJ.js";import"./settings-D0070qy7.js";import"./createLucideIcon-CMta4jpe.js";import"./send-C6E11V_I.js";import"./globe-36e_mGF8.js";import"./chevron-down-BdiW-nc9.js";import"./check-BdTeYIzn.js";import"./user-DGMjLAi-.js";const _=(c,a="success")=>{y.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:x=>{x.onmouseenter=y.stopTimer,x.onmouseleave=y.resumeTimer}}).fire({icon:a,title:c})};function K({auth_permissions:c}){const{t:a}=H(),{props:u}=O();c.can_read;const x=c.can_create===1,j=c.can_update===1,N=c.can_delete===1;v.useEffect(()=>{u.flash?.success&&console.log("Flash message:",u.flash.success)},[u.flash]);const d=u.invoices??[{id:1,number:"INV-00001",date:"21-10-2024",company:"PT. Pumigas Indonesia",amount:12e6,total:1278e4,paid_amount:6e6,tax:{ppn:66e4,pph:12e4},due_amount:654e4,status:"Draft"},{id:2,number:"INV-00002",date:"28-10-2024",company:"PT. Pumigas Indonesia",amount:12e6,total:12468e3,paid_amount:36e5,tax:{ppn:396e3,pph:72e3},due_amount:3924e3,status:"Paid"},{id:3,number:"INV-00003",date:"11-11-2024",company:"China Communication Engineering Construction",amount:12e6,total:12312e3,paid_amount:24e5,tax:{ppn:264e3,pph:48e3},due_amount:2616e3,status:"Unpaid"}];d.reduce((e,r)=>e+(r.total??r.amount??0),0),d.reduce((e,r)=>e+(r.paid_amount||0),0),d.filter(e=>e.status==="Paid").length,d.filter(e=>e.status==="Unpaid").length,d.filter(e=>e.status==="Cancelled").length;const S=new Date().getFullYear(),w=[];for(let e=S;e>=2020;e--)w.push(e);const h=e=>e.toLocaleString("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}),P=[{value:"",label:a("invoices.filters.all_months")||"All Months"},{value:"1",label:"Jan"},{value:"2",label:"Feb"},{value:"3",label:"Mar"},{value:"4",label:"Apr"},{value:"5",label:"May"},{value:"6",label:"Jun"},{value:"7",label:"Jul"},{value:"8",label:"Aug"},{value:"9",label:"Sep"},{value:"10",label:"Oct"},{value:"11",label:"Nov"},{value:"12",label:"Dec"}],{data:n,setData:C,get:D}=B({search:"",status:"all",month:"",year:""}),[i,b]=v.useState({search:n.search||"",status:n.status||"all",month:n.month||"",year:n.year||""});v.useEffect(()=>{b({search:n.search||"",status:n.status||"all",month:n.month||"",year:n.year||""})},[n.search,n.status,n.month,n.year]);const g=(e,r)=>{b(o=>({...o,[e]:r})),C(e,r)},F=()=>{D(route("invoice.index"),{preserveState:!0,preserveScroll:!0,replace:!0,data:{search:i.search,status:i.status!=="all"?i.status:"",month:i.month,year:i.year}})},k=()=>{const e={search:"",status:"all",month:"",year:""};b(e),C(e),p.get(route("invoice.index"),{},{replace:!0,preserveState:!1,preserveScroll:!0})},m=u.statuses??[],I=[{key:"no",label:a("invoices.table.no_date")||"Invoice",render:(e,r,o)=>(console.log(r),t.jsxs("div",{children:[t.jsx("a",{className:"text-blue-600 font-semibold hover:underline flex items-center gap-1 cursor-pointer",href:`/storage/${r.pdf_path}`,target:"_blank",rel:"noopener noreferrer",children:e}),t.jsx("div",{className:"text-xs text-gray-500",children:new Date(r.date||"-").toLocaleDateString()})]}))},{key:"company_name",label:a("invoices.table.company_name")||"Company Name"},{key:"amount",label:a("invoices.table.amount")||"Invoice Amount"},{key:"payment",label:a("invoices.table.payment")||"Payment"},{key:"tax",label:a("invoices.table.tax")||"Tax"},{key:"due_amount",label:a("invoices.table.due_amount")||"Amount Due"},{key:"status",label:a("invoices.table.status")||"Status",render:(e,r)=>{const o=m.find(s=>s.name===e);if(o&&o.is_system||e==="Cancelled"){const s={borderColor:o?.color||"#e5e7eb",color:o?.color||"#374151"};return t.jsx("span",{className:"text-xs font-bold py-1 px-2 rounded-lg border-2",style:s,children:e})}return t.jsx("select",{value:e,onChange:s=>$(r.id,s.target.value),className:"appearance-none text-xs font-bold py-1 px-2 rounded-lg border-2 focus:ring-0 cursor-pointer transition-all",style:{borderColor:o?.color||void 0,color:o?.color||void 0},children:m.length?m.map(s=>t.jsx("option",{value:s.name,style:{color:s.color},children:s.name},s.id)):t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"Draft",children:a("invoices.stats.draft")||"Draft"}),t.jsx("option",{value:"Unpaid",children:a("invoices.stats.unpaid")||"Unpaid"}),t.jsx("option",{value:"Paid",children:a("invoices.stats.paid")||"Paid"}),t.jsx("option",{value:"Cancelled",children:a("invoices.stats.cancelled")||"Cancelled"})]})})}}],E=d.map(e=>({id:e.id,no:e.number,date:e.date,company_name:e.company,amount:h(e.amount),pdf_path:e.pdf_path||null,payment:h(e.paid_amount||0),tax:`PPN ${e.tax?.ppn?e.tax.ppn.toLocaleString():0} / PPh ${e.tax?.pph?e.tax.pph.toLocaleString():0}`,due_amount:h(e.due_amount),status:e.status,original:e})),T=()=>{p.visit(route("invoice.create"))},L=e=>{p.visit(route("invoice.edit",e))},U=(e,r)=>{confirm(`Are you sure you want to delete invoice ${r}?`)&&p.delete(route("invoice.destroy",e),{onSuccess:()=>{},onError:o=>{console.error("Delete failed:",o),alert("Failed to delete invoice")}})},$=(e,r)=>{p.patch(route("invoice.update-status",e),{status:r},{preserveScroll:!0,onStart:()=>{},onSuccess:o=>{_("Status updated to "+r.toUpperCase())},onError:o=>{console.error("Update failed:",o),_("Failed to update status","error")}})};return t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-3",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-700",children:a("invoices.title")||"INVOICE"}),x&&t.jsx(M,{onClick:T,className:"w-full sm:w-auto px-5 py-2.5 text-white text-sm font-medium rounded-lg",children:t.jsx("span",{children:a("invoices.button_add")||"Add Invoice"})})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 my-7",children:(()=>{const e={Paid:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",icon:"âœ…"},Unpaid:{bg:"bg-orange-100",text:"text-orange-800",border:"border-orange-200",icon:"â³"},Draft:{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200",icon:"ðŸ“"},Cancelled:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:"âŒ"}},r=d.reduce((l,s)=>(l[s.status]=(l[s.status]||0)+1,l),{}),o=d.reduce((l,s)=>{const f=s.total??s.amount??0;return l[s.status]=(l[s.status]||0)+f,l},{});return Object.keys(e).map(l=>{const s=e[l],f=r[l]||0,A=o[l]||0,R=a(`invoices.stats.${l.toLowerCase()}`)||l;return t.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${s.border} ${s.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:`text-sm font-medium ${s.text} uppercase tracking-wide`,children:R}),t.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:f}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Rp ",h(A).replace(/^Rp\s?/,"")]})]}),t.jsx("div",{className:`p-3 rounded-full ${s.bg}`,children:t.jsx("span",{className:"text-lg",children:s.icon})})]})},l)})})()}),t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("invoices.filters.search_placeholder")}),t.jsxs("div",{className:"relative",children:[t.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),t.jsx("input",{type:"text",placeholder:a("invoices.filters.search_placeholder"),value:i.search,onChange:e=>g("search",e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:flex lg:space-x-4 gap-4",children:[t.jsxs("div",{className:"lg:w-40",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("invoices.filters.status")}),t.jsxs("select",{value:i.status,onChange:e=>g("status",e.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[t.jsx("option",{value:"all",children:a("invoices.filters.all_status")}),m.length?m.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id)):t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"Paid",children:a("invoices.stats.paid")}),t.jsx("option",{value:"Unpaid",children:a("invoices.stats.unpaid")}),t.jsx("option",{value:"Draft",children:a("invoices.stats.draft")}),t.jsx("option",{value:"Partial",children:a("invoices.stats.partial")}),t.jsx("option",{value:"Cancelled",children:a("invoices.stats.cancelled")})]})]})]}),t.jsxs("div",{className:"lg:w-40",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("invoices.filters.month")}),t.jsxs("div",{className:"relative",children:[t.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("select",{value:i.month,onChange:e=>g("month",e.target.value),className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:P.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),t.jsxs("div",{className:"lg:w-32",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("invoices.filters.year")}),t.jsxs("select",{value:i.year,onChange:e=>g("year",e.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[t.jsx("option",{value:"",children:a("invoices.filters.all_years")}),w.map(e=>t.jsx("option",{value:e,children:e},e))]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[t.jsxs("button",{onClick:F,className:"px-4 py-2.5 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors justify-center text-sm font-medium",children:[t.jsx(z,{className:"w-4 h-4"}),a("invoices.filters.apply")]}),t.jsxs("button",{onClick:k,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 justify-center text-sm font-medium",children:[t.jsx(G,{className:"w-4 h-4"}),a("invoices.filters.reset")]})]})]})}),t.jsx("div",{className:"py-8",children:t.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:t.jsx(J,{data:E,columns:I,onEdit:j?L:null,onDelete:N?U:null,showAction:j||N})})})]})}K.layout=c=>t.jsx(V,{children:c});export{K as default,_ as toast};
