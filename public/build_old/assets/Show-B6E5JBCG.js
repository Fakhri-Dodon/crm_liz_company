import{a as z,r,b as p,j as e,H as S,c as b}from"./app-D-CXuYp-.js";import B from"./Sidebar-Bgx5t9QD.js";import G from"./CompanyHeader-DSP_ZVbF.js";import E from"./ProfileTable-C3eg_Tue.js";import K from"./QuotationTable-BV6mZ67B.js";import Q from"./InvoiceTable-B9YNkva6.js";import J from"./PaymentTable-D8AGaCjd.js";import V from"./ProjectTable-CYDKIgOS.js";import Y from"./ContactTable-Bl4mwzkg.js";import{H as C}from"./HeaderLayout-DNM94YMu.js";import{u as Z}from"./useTranslation-C5DOJpQ8.js";import{T as ee}from"./trash-2-C428PtZi.js";import"./building-2-C0t7apox.js";import"./createLucideIcon-Da68c0mB.js";import"./file-text-cCH1Ukzd.js";import"./receipt-CweEn7rr.js";import"./credit-card-DQOa8dG8.js";import"./folder-kanban-BEhscMpt.js";import"./users-SlK5PrXt.js";import"./chevron-right-6qHYXvPl.js";import"./map-pin-ugqY3VG7.js";import"./globe-Ct8OYrI2.js";import"./mail-CPS2hZM_.js";import"./phone-CLSBwmXQ.js";import"./info-C0m5B7C5.js";import"./building-BasvS8Ni.js";import"./calendar-BLzufnGW.js";import"./user-FnYjhWZf.js";import"./chevron-up-C1grY4UU.js";import"./chevron-down-D5S3ga3K.js";import"./refresh-cw-DQMJkT9J.js";import"./circle-alert-DIyWWGnv.js";import"./circle-x-BPC9WWbp.js";import"./clock-C8BQT89T.js";import"./send-WSU91zWN.js";import"./circle-check-big-DBPc4ZFd.js";import"./square-pen-BuP-lLgl.js";import"./search-BSE1nh5m.js";import"./loader-D_qCqTK_.js";import"./percent-Cpxk42sT.js";import"./x-7oBENnvo.js";import"./save-BGJLkOYD.js";import"./loader-circle-Cmn6e3Cc.js";import"./ContactModal-CexXoaEx.js";import"./briefcase-MmDWfAjW.js";import"./check-BdhqU_fL.js";import"./plus-9mmXNL9j.js";import"./transition-Dd6dQS9p.js";import"./index-Dml3iHVq.js";import"./settings--wXcYxvN.js";const nt=({company:s,quotations:T,invoices:h,payments:k,projects:w,contacts:i,statistics:P,grouped_quotations:M,auth_permissions:d})=>{const{props:q}=z(),{t}=Z(),[m,D]=r.useState("profile"),[L,te]=r.useState(!1),[R,x]=r.useState(!1),[u,f]=r.useState(null),[se,oe]=r.useState("create");console.log("permissions: ",d);const[ae,re]=r.useState(!1),[ne,ce]=r.useState(null),[ie,le]=r.useState({project_description:"",start_date:"",deadline:"",status:"pending",note:""}),[H,v]=r.useState(!1),[I,g]=r.useState(i||[]),[A,y]=r.useState(!1);console.log("========== SHOW PAGE DATA =========="),console.log("Company:",s),console.log("Contacts data received:",i),console.log("Invoices data received:",h),console.log("Projects data:",w),console.log("==================================="),r.useEffect(()=>{p.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",p.defaults.withCredentials=!0;const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");a&&(p.defaults.headers.common["X-CSRF-TOKEN"]=a)},[]),r.useEffect(()=>{!s||!s.id?console.error("ERROR: Company data is missing!"):console.log("SUCCESS: Company data received:",{id:s.id,name:s.client_code,contact_person:s.contact_person,invoices_count:h?.length||0,contacts_count:i?.length||0}),i&&g(i)},[s,i,h]);const N=async()=>{if(s?.id){y(!0);try{const a=await p.get(`/companies/${s.id}/contacts`);console.log("Fetched contacts:",a.data),a.data.success?g(a.data.data):console.error("Failed to fetch contacts:",a.data.message)}catch(a){console.error("Error fetching contacts:",a),g(i||[])}finally{y(!1)}}};r.useEffect(()=>{m==="contact"&&s?.id&&N()},[m,s?.id]);const l=(a,n="success")=>{document.querySelectorAll(".custom-toast").forEach(_=>_.remove());const c=document.createElement("div");c.className=`custom-toast fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${n==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,c.innerHTML=`
            <div class="flex items-center">
                <span>${a}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                    ✕
                </button>
            </div>
        `,document.body.appendChild(c),setTimeout(()=>{c.parentElement&&c.remove()},3e3)},$=async a=>{console.log("handleProjectEdit called with:",a);try{v(!0);const n=await p.put(`/companies/${s.id}/projects/${a.id}`,a,{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});return console.log("Update response:",n.data),n.data.success?(l(t("companies_show.project_updated_successfully"),"success"),b.reload({preserveScroll:!0}),!0):(l(n.data.message||t("companies_show.failed_to_update_project"),"error"),!1)}catch(n){if(console.error("Error updating project:",n),n.response?.status===422){const j=n.response.data.errors;let c=t("companies_show.validation_errors")+`:
`;Object.keys(j).forEach(_=>{c+=`- ${j[_].join(", ")}
`}),l(c,"error")}else l(n.response?.data?.message||t("companies_show.failed_to_update_project"),"error");return!1}finally{v(!1)}},F=a=>{console.log("Deleting project:",a),f(a),x(!0)},O=()=>{u&&b.delete(route("projects.destroy",u.id),{preserveScroll:!0,onSuccess:()=>{x(!1),f(null),l(t("companies_show.project_deleted_successfully"),"success")},onError:()=>{l(t("companies_show.failed_to_delete_project"),"error")}})},X=()=>{console.log("Refreshing contacts data..."),N(),l(t("companies_show.contacts_updated_successfully"),"success")};if(!s||!s.id)return e.jsxs(C,{children:[e.jsx(S,{title:t("companies_show.error_title")}),e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("companies_show.company_not_found")}),e.jsx("p",{className:"text-gray-600 mb-6",children:t("companies_show.company_not_found_message")}),e.jsx("button",{onClick:()=>b.visit(route("companies.index")),className:"px-6 py-3 bg-[#054748] text-white rounded-lg hover:bg-[#0a5d5e] transition-colors font-medium",children:t("companies_show.back_to_companies_list")}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("companies_show.debug_info")}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t("companies_show.url"),":"," ",window.location.href,e.jsx("br",{}),t("companies_show.route"),": companies.show",e.jsx("br",{}),t("companies_show.received_props"),":"," ",Object.keys(q).join(", ")]})]})]})})]});const o={company:{...s,contact_person:s.contact_person||s.primary_contact?.name||t("companies_show.not_available"),contact_email:s.contact_email||s.primary_contact?.email||t("companies_show.not_available"),contact_phone:s.contact_phone||s.primary_contact?.phone||t("companies_show.not_available"),contact_position:s.contact_position||s.primary_contact?.position||t("companies_show.not_available")},statistics:P||{},quotations:T||[],invoices:h||[],payments:k||[],projects:w||[],contacts:I,grouped_quotations:M||[]},U=()=>{if(L)return e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#054748]"}),e.jsx("span",{className:"ml-3 text-gray-600",children:t("companies_show.loading_data")})]});switch(m){case"profile":return e.jsx(E,{data:o.company});case"quotation":return e.jsx(K,{data:o.quotations,groupedData:o.grouped_quotations,companyId:o.company.id,auth_permissions:d});case"invoice":return e.jsx(Q,{data:o.invoices,companyId:s.id,auth_permissions:d});case"payment":return e.jsx(J,{data:o.payments,companyId:o.company.id,showInvoiceAmount:!0,auth_permissions:d});case"project":return e.jsx(V,{data:o.projects,onEdit:$,onDelete:F,auth_permissions:d});case"contact":return e.jsx(Y,{contacts:o.contacts,companyId:o.company.id,onUpdate:X,isLoading:A,auth_permissions:d});default:return e.jsx(E,{data:o.company})}},W=()=>{switch(m){case"contact":return null;default:return null}};return e.jsxs(C,{children:[e.jsx(S,{title:`${o.company.client_code} - ${t("companies_show.detail_company")}`}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(B,{activeTab:m,setActiveTab:D})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"p-0",children:[s&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg mx-6 mt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:t("companies_show.success_loaded_company_data")}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[t("companies_show.viewing"),":"," ",e.jsx("span",{className:"font-bold",children:o.company.client_code})," ","|",t("companies_show.invoices"),":"," ",e.jsx("span",{className:"font-bold",children:o.invoices?.length||0})," ","|",t("companies_show.contacts"),":"," ",e.jsx("span",{className:"font-bold",children:o.contacts?.length||0})," ","|",t("companies_show.projects"),":"," ",e.jsx("span",{className:"font-bold",children:o.projects?.length||0})]})]})]})}),e.jsx("div",{className:"px-6",children:e.jsx(G,{company:o.company,activeTab:m,data:o,statistics:o.statistics})}),e.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow-sm border border-gray-100 mx-6 p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("div",{}),W()]}),U()]})]})})]}),R&&u&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(ee,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t("companies_show.delete_project")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t("companies_show.action_cannot_undone")})]})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:t("companies_show.confirm_delete_project",{name:u.project_description})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{x(!1),f(null)},className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex-1",children:t("companies_show.cancel")}),e.jsx("button",{onClick:O,className:"px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex-1",children:t("companies_show.delete")})]})]})})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-700",children:t("companies_show.saving_project")})]})})]})};export{nt as default};
