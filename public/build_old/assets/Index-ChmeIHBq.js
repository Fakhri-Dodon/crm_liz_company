import{b as W,r as d,j as e}from"./app--V8YQuQk.js";import{H as me}from"./HeaderLayout-Bk7u9NLn.js";import{T as ue}from"./TableLayout-BTyK602-.js";import{F as xe}from"./file-text-BkpdNTL0.js";import{c as he}from"./createLucideIcon-D7A-7CJ7.js";import{X as fe}from"./x-DGqtnagE.js";import{L as pe}from"./loader-circle-DdQx-sZ8.js";import{S as ge}from"./save-ChX0yG6a.js";import{P as Z}from"./PrimaryButton-D8xKtEFh.js";import{u as be}from"./useTranslation-DGCn9e9S.js";import"./transition-D2W53CQ5.js";import"./index-DvGSOaWZ.js";import"./settings-B2fgqRwV.js";import"./send-BzvzPsAY.js";import"./globe-DUm1N8J0.js";import"./chevron-down-DnOCgVxl.js";import"./check-BtXJC3Kt.js";import"./user-D9rdox91.js";const ye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],je=he("user-plus",ye),X={async getAll(){try{console.log("ðŸ“ž GET /api/leads");const o=await W.get("/api/leads");return console.log("âœ… GET Response:",o.data),o}catch(o){throw console.error("âŒ GET Error:",o.response?.data||o.message),o}},async create(o){try{console.log("ðŸ“ POST /api/leads",o);const n=await W.post("/api/leads",o);return console.log("âœ… POST Response:",n.data),n}catch(n){throw n.response?.data?.message&&console.error("âŒ Server Message:",n.response.data.message),n.response?.data?.errors&&console.error("âŒ Validation Errors:",n.response.data.errors),console.error("âŒ POST Error Detail:",n.response?.data||n.message),n}},async update(o,n){try{console.log("ðŸ“ PUT /api/leads/"+o,n);const f=await W.put(`/api/leads/${o}`,n);return console.log("âœ… PUT Response:",f.data),f}catch(f){throw console.error("âŒ PUT Error:",f.response?.data||f.message),f}},async delete(o){try{console.log("ðŸ—‘ï¸ DELETE /api/leads/"+o);const n=await W.delete(`/api/leads/${o}`);return console.log("âœ… DELETE Response:",n.data),n}catch(n){throw console.error("âŒ DELETE Error:",n.response?.data||n.message),n}}};function ve({open:o,onClose:n,onSubmit:f,initialData:i,currentUser:y,isAdmin:S=!1}){const[l,T]=d.useState({company_name:"",address:"",contact_person:"",email:"",phone:"",position:"",status:"",assigned_to:""}),[O,u]=d.useState([]),[P,C]=d.useState([]),[D,q]=d.useState(!1),[R,$]=d.useState(!1),[h,_]=d.useState(!1);d.useEffect(()=>{o&&(z(),v(),_(!1))},[o]),d.useEffect(()=>{const r=m=>{m.keyCode===27&&n()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[n]);const z=async()=>{try{q(!0);const m=await(await fetch("/api/lead-statuses")).json();if(u(m),!i&&m.length>0&&!l.status){const U=m.find(L=>L.name.toLowerCase()==="new")||m[0];T(L=>({...L,status:U.id}))}}catch(r){console.error("Failed to fetch statuses:",r),u([])}finally{q(!1)}},v=async()=>{try{$(!0);const r=await fetch("/api/users");if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const m=await r.json();if(m.error){await E();return}C(m)}catch(r){console.error("Failed to fetch users:",r),await E()}finally{$(!1)}},E=async()=>{try{const r=await fetch("/api/users-simple");if(r.ok){const m=await r.json();C(m)}else C([{id:y?.id||"1",name:y?.name||"Current User",email:y?.email||"user@example.com"},{id:"2",name:"John Doe",email:"john@example.com"},{id:"3",name:"Jane Smith",email:"jane@example.com"}])}catch(r){console.error("Fallback also failed:",r),C([])}};d.useEffect(()=>{o&&T(i?{company_name:i.company_name||"",address:i.address||"",contact_person:i.contact_person||"",email:i.email||"",phone:i.phone||"",position:i.position||"",status:i.lead_statuses_id||"",assigned_to:i.assigned_to||""}:{company_name:"",address:"",contact_person:"",email:"",phone:"",position:"",status:"",assigned_to:y?.id||""})},[i,o,y]);const c=r=>{const{name:m,value:U}=r.target;T(L=>({...L,[m]:U}))},F=async r=>{if(r.preventDefault(),!h){_(!0);try{if(!l.company_name.trim()||!l.contact_person.trim()||!l.status){alert("Please fill required fields"),_(!1);return}const m={...l,lead_statuses_id:l.status,assigned_to:l.assigned_to||(i?l.assigned_to:y?.id||null)};delete m.status,await f(m)}catch(m){console.error("Error submitting form:",m),alert("Failed to submit form.")}finally{_(!1)}}},H=()=>l.assigned_to?P.find(r=>r.id===l.assigned_to):null;if(!o)return null;const k=H(),J=i?xe:je;return e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50 transition-all duration-300",children:e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#005954]/10 rounded-lg",children:e.jsx(J,{className:"w-6 h-6 text-[#005954]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:i?"Edit Lead":"Create New Lead"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:i?"Update lead information":"Add a new lead to your database"})]})]}),e.jsx("button",{onClick:n,disabled:h,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"company_name",value:l.company_name,onChange:c,disabled:h,placeholder:"Enter company name",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all disabled:bg-gray-50",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Contact Person ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"contact_person",value:l.contact_person,onChange:c,disabled:h,placeholder:"Full Name",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["Position ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"position",value:l.position,onChange:c,disabled:h,placeholder:"Job Title",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:[" Email ",e.jsx("span",{className:"text-red-500",children:"*"})," "]}),e.jsx("input",{name:"email",type:"email",value:l.email,onChange:c,disabled:h,placeholder:"name@company.com",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:[" Phone ",e.jsx("span",{className:"text-red-500",children:"*"})," "]}),e.jsx("input",{name:"phone",value:l.phone,onChange:c,disabled:h,placeholder:"+62...",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:[" Status ",e.jsx("span",{className:"text-red-500",children:"*"})," "]}),e.jsxs("select",{name:"status",value:l.status,onChange:c,disabled:h||D,className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all appearance-none bg-white",required:!0,children:[e.jsx("option",{value:"",children:"Select Status"}),O.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:" Assign To "}),e.jsxs("select",{name:"assigned_to",value:l.assigned_to||"",onChange:c,disabled:h||R,className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all appearance-none bg-white",children:[e.jsx("option",{value:"",children:"Unassigned"}),P.map(r=>e.jsxs("option",{value:r.id,children:[r.name," ",r.id===y?.id?"(You)":""]},r.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:" Address "}),e.jsx("textarea",{name:"address",value:l.address,onChange:c,disabled:h,rows:"2",placeholder:"Enter full address",className:"w-full border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#005954]/20 focus:border-[#005954] outline-none transition-all resize-none"})]})]}),k&&e.jsxs("div",{className:"mt-2 p-3 bg-[#005954]/5 border border-[#005954]/10 rounded-xl flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#005954] rounded-full flex items-center justify-center text-white text-xs font-bold",children:k.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:k.name}),e.jsx("p",{className:"text-xs text-gray-500",children:k.email})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex flex-col-reverse sm:flex-row gap-3",children:[e.jsx("button",{type:"button",onClick:n,disabled:h,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:h||!l.company_name||!l.status,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d48] transition-all font-medium flex-1 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[h?e.jsx(pe,{className:"w-5 h-5 animate-spin"}):e.jsx(ge,{className:"w-5 h-5"}),i?"Update Lead":"Create Lead"]})]})]})]})})})}const we=({isOpen:o,onClose:n,onConfirm:f,lead:i})=>o?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[e.jsx("div",{className:"bg-white px-6 py-5",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Lead"}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:i?.company_name}),"?"]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:()=>f(i),className:"inline-flex w-full justify-center rounded-md bg-red-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto transition-colors",children:"Delete"}),e.jsx("button",{type:"button",onClick:n,className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-4 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto transition-colors",children:"Cancel"})]})]})})]}):null,Ne=({isOpen:o,onClose:n,type:f,title:i,message:y})=>{if(!o)return null;const S={success:{bg:"bg-green-100",text:"text-green-600",icon:"âœ“"},error:{bg:"bg-red-100",text:"text-red-600",icon:"!"},warning:{bg:"bg-yellow-100",text:"text-yellow-600",icon:"âš "},info:{bg:"bg-blue-100",text:"text-blue-600",icon:"i"}},l=S[f]||S.info;return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"bg-white px-6 py-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full ${l.bg}`,children:e.jsx("span",{className:`text-lg font-bold ${l.text}`,children:l.icon})}),e.jsxs("div",{className:"ml-4 text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:i}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-sm text-gray-500",children:y})})]})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-4",children:e.jsx("button",{type:"button",onClick:n,className:"inline-flex w-full justify-center rounded-md bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 transition-colors",children:"OK"})})]})})]})};function Be({leads:o=[],auth:n,auth_permissions:f}){const[i,y]=d.useState(o),[S,l]=d.useState([]),[T,O]=d.useState(!1),{t:u}=be();f.can_read;const P=f.can_create===1,C=f.can_update===1,D=f.can_delete===1,[q,R]=d.useState(!1),[$,h]=d.useState(!1),[_,z]=d.useState(null),[v,E]=d.useState(""),[c,F]=d.useState(""),[H,k]=d.useState(!1),[J,r]=d.useState(!1),[m,U]=d.useState({type:"success",title:"",message:""}),[L,ee]=d.useState(null),[B,Y]=d.useState(null),[w,G]=d.useState([]),x=n?.user||null,se=x?.is_admin||!1;d.useEffect(()=>{te(),ae()},[]);const te=async()=>{try{O(!0);const s=await fetch("/api/users");if(s.ok){const t=await s.json();l(t)}}catch(s){console.error("Failed to fetch users:",s),l([])}finally{O(!1)}},ae=async()=>{try{const s=await fetch("/api/lead-statuses");if(s.ok){const t=await s.json();G(t)}else console.error("Failed to fetch lead statuses:",s.status),K()}catch(s){console.error("Error fetching lead statuses:",s),K()}},K=async()=>{try{const s=await fetch("/api/lead-status");if(s.ok){const t=await s.json();G(t)}else{const t=await fetch("/api/leads");if(t.ok){const a=await t.json(),g=[],b=new Set;a.forEach(p=>{p.status_id&&p.status_name&&p.status_color&&!b.has(p.status_id)&&(b.add(p.status_id),g.push({id:p.status_id,name:p.status_name,color:p.status_color}))}),g.length>0?G(g):console.error("No lead statuses available")}}}catch(s){console.error("Error fetching lead statuses from alternative source:",s)}};d.useEffect(()=>{console.log("=== LEAD STATUSES FROM DATABASE ==="),console.log("Total statuses:",w.length),console.log("Statuses data:",w)},[w]);const re=async(s,t)=>{try{R(!0);const a=w.find(b=>b.id===t);if(!a)throw new Error("Status not found");console.log("Selected status object:",a),console.log("Lead ID to update:",s);const g={lead_statuses_id:t,status:a.name,status_name:a.name,status_color:a.color||"#3b82f6",_method:"PUT"};console.log("Updating status with payload:",g);try{const b=await fetch(`/api/leads/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(g)}),p=await b.json();if(console.log("Update response:",p),!b.ok)throw new Error(p.message||p.error||`Update failed with status ${b.status}`);y(N=>N.map(M=>M.id===s?{...M,lead_statuses_id:t,status_id:t,status_name:a.name,status_color:a.color||"#3b82f6",status:a.name}:M)),Y(null),j("success","Status Updated",`Lead status changed to ${a.name}`)}catch(b){throw console.error("Fetch error:",b),b}}catch(a){console.error("Status update error:",a),console.error("Full error:",a);let g="Failed to update status";a.response?.data?g=a.response.data.message||a.response.data.error||JSON.stringify(a.response.data.errors||a.response.data):a.message&&(g=a.message),j("error","Update Failed",g)}finally{R(!1)}},ne=s=>{if(!x){j("error","Authentication Required","Please login to update lead status");return}if(w.length===0){j("error","No Status Available","Cannot update status: No status data available");return}Y(B===s?null:s)};d.useEffect(()=>{const s=t=>{B&&!t.target.closest(".status-dropdown-container")&&Y(null)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[B]);const oe=[{key:"company_name",label:u("leads.table.company_name")||"Company Name",sortable:!0},{key:"address",label:u("leads.table.address")||"Address"},{key:"contact_person",label:u("leads.table.contact_person")||"Contact Person",render:(s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.contact_person||"-"}),e.jsx("div",{className:"text-gray-500 text-sm mt-1",children:t.position||"-"})]})},{key:"email",label:u("leads.table.email_phone")||"Email & Phone",render:(s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.email||"-"}),e.jsx("div",{className:"text-gray-500 text-sm mt-1",children:t.phone||"-"})]})},{key:"assigned_user",label:u("leads.table.assigned_to")||"Assigned To",render:(s,t)=>{if(s&&s.name){const a=x&&s.id===x.id;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:[s.name,a&&e.jsx("span",{className:"ml-1 text-xs font-normal text-green-600",children:"(You)"})]}),s.email&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:s.email})]})]})}return t.assigned_to&&!s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-semibold text-sm",children:"?"})}),e.jsxs("div",{className:"text-sm text-gray-500",children:["User ID: ",t.assigned_to.substring(0,8),"..."]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})})}),e.jsx("span",{className:"text-gray-400 text-sm",children:"Unassigned"})]})}},{key:"status_name",label:u("leads.table.status")||"Status",render:(s,t)=>{const a=w.find(N=>N.id===t.status_id||N.name===(t.status_name||t.status)),g=a?.color||t.status_color||"#3b82f6",b=a?.name||t.status_name||t.status||"New",p=B===t.id;return e.jsxs("div",{className:"relative status-dropdown-container",children:[e.jsxs("button",{type:"button",onClick:()=>ne(t.id),className:`inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold transition-all duration-200 hover:shadow-sm ${p?"ring-2 ring-blue-300 ring-offset-1":""}`,style:{backgroundColor:`${g}15`,color:g,border:`1px solid ${g}30`,cursor:x?"pointer":"default"},disabled:!x||w.length===0,children:[b,x&&w.length>0&&e.jsx("svg",{className:`ml-1.5 h-3.5 w-3.5 transition-transform duration-200 ${p?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p&&x&&w.length>0&&e.jsxs("div",{className:"absolute z-50 mt-1 w-48 bg-white shadow-lg border border-gray-200 py-1",children:[w.map(N=>{const M=a?.id===N.id||b===N.name;return e.jsxs("button",{type:"button",onClick:()=>re(t.id,N.id),className:`w-full px-3 py-2.5 text-left hover:bg-gray-50 flex items-center justify-between ${M?"bg-blue-50":""}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full mr-3",style:{backgroundColor:N.color||"#3b82f6"}}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.name})]}),M&&e.jsx("svg",{className:"h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},N.id)}),q&&e.jsx("div",{className:"px-3 py-2 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"Updating..."})]})})]})]})}},{key:"created_at",label:u("leads.table.created_at")||"Created",render:s=>e.jsx("div",{className:"text-sm text-gray-600",children:s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"})}],j=(s,t,a)=>{U({type:s,title:t,message:a}),r(!0)},V=()=>{if(!x){j("error","Authentication Required","Please login to create a lead");return}z(null),h(!0)},le=s=>{if(!x){j("error","Authentication Required","Please login to edit leads");return}z(s),h(!0)},ie=async s=>{console.log("Submitting lead:",s);try{_?(await X.update(_.id,s),j("success","Success","Lead updated successfully!")):(await X.create(s),j("success","Success","Lead created successfully!")),h(!1),window.location.reload()}catch(t){console.error("Submit error:",t),j("error","Save Failed",t.response?.data?.message||t.message)}},de=s=>{if(!x){j("error","Authentication Required","Please login to delete leads");return}ee(s),k(!0)},ce=async s=>{try{await X.delete(s.id),y(t=>t.filter(a=>a.id!==s.id)),k(!1),j("success","Deleted",`"${s.company_name}" has been deleted.`),setTimeout(()=>{window.location.reload()},1e3)}catch(t){k(!1),j("error","Delete Failed",t.response?.data?.message||t.message)}},I=Array.isArray(i)?i.filter(s=>{const t=s.company_name?.toLowerCase().includes(v.toLowerCase())||s.contact_person?.toLowerCase().includes(v.toLowerCase())||s.email?.toLowerCase().includes(v.toLowerCase())||(s.assigned_user?.name||"").toLowerCase().includes(v.toLowerCase())||(s.assigned_user?.email||"").toLowerCase().includes(v.toLowerCase());let a=!0;return c&&(c==="unassigned"?a=!s.assigned_to||s.assigned_to==="":c==="me"?a=x&&s.assigned_to===x.id:c==="others"?a=x&&s.assigned_to&&s.assigned_to!==x.id:a=s.assigned_to===c),t&&a}):[];Array.isArray(i)&&[...new Set(i.filter(s=>s.company_name).map(s=>s.company_name).sort())];const Q=()=>{E(""),F("")},A=v||c;return e.jsxs(e.Fragment,{children:[e.jsx(me,{title:u("leads.title")||"Leads Management",subtitle:u("leads.sub_title")||"Manage all company leads"}),e.jsx("div",{className:"px-8 py-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:u("leads.title")})}),e.jsx("div",{className:"sm:w-auto",children:P&&e.jsxs(Z,{onClick:V,disabled:!x,className:"inline-flex items-center rounded-md border border-transparent px-5 py-2.5 text-sm font-medium font-semibold uppercase tracking-widest text-white transition duration-150 ease-in-out bg-[rgb(17,94,89)] hover:bg-[rgb(13,75,71)] focus:bg-[rgb(13,75,71)] focus:outline-none focus:ring-2 focus:ring-[rgb(17,94,89)] focus:ring-offset-2 active:bg-[rgb(10,60,57)] w-full sm:w-auto flex items-center justify-center gap-2 shadow-sm hover:shadow",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"font-semibold",children:u("leads.button_add")||"Add New Lead"})]})})]})}),e.jsx("div",{className:"bg-white border-b border-gray-200 px-8",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:u("leads.filters.search_placeholder"),value:v,onChange:s=>E(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm transition-all duration-200"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:c,onChange:s=>F(s.target.value),className:"w-full sm:w-64 border border-gray-300 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white pr-10",children:[e.jsx("option",{value:"",children:u("leads.filters.all_assignments")||"All Assignments"}),e.jsx("option",{value:"me",children:u("leads.filters.assigned_to_me")||"Assigned to Me"}),e.jsx("option",{value:"unassigned",children:u("leads.filters.unassigned")||"Unassigned"}),e.jsx("option",{value:"others",children:u("leads.filters.assined_to_others")||"Assigned to Others"}),e.jsx("optgroup",{label:u("leads.filters.specific_user")||"Specific Users",children:S.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",x&&s.id===x.id&&"(You)"]},s.id))})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}),A&&e.jsxs("button",{onClick:Q,className:"px-4 py-3 border border-gray-300 text-gray-700 rounded-xl text-sm font-medium hover:bg-gray-50 transition-colors duration-200 flex items-center gap-2 whitespace-nowrap",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),u("leads.filters.clear_search")||"Clear Filters"]})]}),A&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[v&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:['Search: "',v,'"',e.jsx("button",{onClick:()=>E(""),className:"ml-1.5 text-blue-600 hover:text-blue-800",children:"Ã—"})]}),c&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[c==="me"&&"Assigned to Me",c==="unassigned"&&"Unassigned",c==="others"&&"Assigned to Others",!["me","unassigned","others"].includes(c)&&`Assigned to: ${S.find(s=>s.id===c)?.name||"User"}`,e.jsx("button",{onClick:()=>F(""),className:"ml-1.5 text-green-600 hover:text-green-800",children:"Ã—"})]})]})]})})}),e.jsx("div",{className:"px-8 py-6",children:x?I.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50",children:[e.jsx("div",{className:"h-16 w-16 text-gray-300 mb-5",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-500 font-medium mb-2 text-lg",children:A?"No matching leads found":"No leads in database"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6 text-center max-w-md",children:A?"Try adjusting your search criteria or filters":"Get started by adding your first lead to the system"}),e.jsxs("div",{className:"flex gap-3",children:[A&&e.jsx("button",{onClick:Q,className:"px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors",children:"Clear All Filters"}),!A&&e.jsxs(Z,{onClick:V,className:"px-6 py-3 text-sm font-semibold",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Your First Lead"]})]})]}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx(ue,{columns:oe,data:I,onEdit:C?le:null,onDelete:D?de:null,showAction:C||D})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50",children:[e.jsx("div",{className:"h-16 w-16 text-gray-300 mb-5",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("p",{className:"text-gray-500 font-medium mb-2 text-lg",children:"Authentication Required"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6 text-center max-w-md",children:"You need to be logged in to view and manage leads. Please sign in to continue."})]})}),e.jsx(ve,{open:$,onClose:()=>h(!1),onSubmit:ie,initialData:_,currentUser:x,isAdmin:se,users:S,statuses:w}),e.jsx(we,{isOpen:H,onClose:()=>k(!1),onConfirm:ce,lead:L}),e.jsx(Ne,{isOpen:J,onClose:()=>r(!1),type:m.type,title:m.title,message:m.message})]})}export{Be as default};
