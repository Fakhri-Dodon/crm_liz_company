import{a as z,r as n,b as p,j as e,H as C,c as S}from"./app-BTbkV42h.js";import G from"./Sidebar-hJdiLF-8.js";import K from"./CompanyHeader-BbGThLGL.js";import k from"./ProfileTable-BmnTuqgq.js";import Q from"./QuotationTable-D2gBrDrh.js";import J from"./InvoiceTable-W0heSN6R.js";import V from"./PaymentTable-GCQDsMeZ.js";import Y from"./ProjectTable-DhkVGiLU.js";import Z from"./ContactTable-BH6F27uh.js";import{P as ee}from"./ProjectModal-BGVIrmly.js";import{H as E}from"./HeaderLayout-BOd0q3W-.js";import{u as te}from"./useTranslation-CATg2OkV.js";import{T as se}from"./trash-2-DAvdOtVv.js";import"./building-2-gPSzt0QW.js";import"./createLucideIcon-DHxmSlVR.js";import"./file-text-DZzzDjT5.js";import"./receipt-B79npxa6.js";import"./credit-card-Lb72NZgA.js";import"./folder-kanban-GhzLJhih.js";import"./users-CIlJNvUQ.js";import"./chevron-right-BtKS4KLw.js";import"./map-pin-CoQOVUzC.js";import"./globe-CiSLK2lF.js";import"./mail-CMvUT1Eg.js";import"./phone-CJHv2jh8.js";import"./calendar-BTlTyD--.js";import"./info-_39fDCir.js";import"./building-CPZWQ5XQ.js";import"./landmark-Ds5uhNSv.js";import"./user-DWczQdUG.js";import"./chevron-up-Cgif7c7Y.js";import"./chevron-down-BBjuMcoq.js";import"./refresh-cw-c1U8ceJg.js";import"./circle-alert-DoOS-5uy.js";import"./circle-x-BUzq9hWu.js";import"./clock-DbhAJd2o.js";import"./send-stj9b7Y9.js";import"./circle-check-big-eNIFlt7A.js";import"./square-pen-6MOQKBaz.js";import"./x-bUU7PHNQ.js";import"./save-CRESjzdO.js";import"./search-OnmWdDDk.js";import"./check-CMDYYhgh.js";import"./dollar-sign-s5RRFvp2.js";import"./percent-B6QSAovG.js";import"./triangle-alert-851T3JNd.js";import"./ContactModal-tQT8leHI.js";import"./briefcase-C2LcnxdB.js";import"./plus-CvJgb19b.js";import"./loader-circle-DvkhTUhf.js";import"./transition-MPasdNlU.js";import"./settings-CdYEu26S.js";const ot=({company:s,quotations:j,invoices:m,payments:T,projects:_,contacts:r,statistics:P,grouped_quotations:L})=>{const{props:M}=z(),{t}=te(),[c,D]=n.useState("profile"),[A,oe]=n.useState(!1),[g,h]=n.useState(!1),[q,u]=n.useState(!1),[l,i]=n.useState(null),[b,w]=n.useState("create"),[H,x]=n.useState(r||[]),[I,v]=n.useState(!1);console.log("========== SHOW PAGE DATA =========="),console.log("Company:",s),console.log("Contacts data received:",r),console.log("Invoices data received:",m),console.log("Projects data:",_),console.log("==================================="),n.useEffect(()=>{p.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",p.defaults.withCredentials=!0;const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");a&&(p.defaults.headers.common["X-CSRF-TOKEN"]=a)},[]),n.useEffect(()=>{!s||!s.id?console.error("ERROR: Company data is missing!"):console.log("SUCCESS: Company data received:",{id:s.id,name:s.client_code,contact_person:s.contact_person,invoices_count:m?.length||0,contacts_count:r?.length||0}),r&&x(r)},[s,r,m]);const N=async()=>{if(s?.id){v(!0);try{const a=await p.get(`/companies/${s.id}/contacts`);console.log("Fetched contacts:",a.data),a.data.success?x(a.data.data):console.error("Failed to fetch contacts:",a.data.message)}catch(a){console.error("Error fetching contacts:",a),x(r||[])}finally{v(!1)}}};n.useEffect(()=>{c==="contact"&&s?.id&&N()},[c,s?.id]);const f=(a,U="success")=>{document.querySelectorAll(".custom-toast").forEach(X=>X.remove());const d=document.createElement("div");d.className=`custom-toast fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${U==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,d.innerHTML=`
            <div class="flex items-center">
                <span>${a}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                    ✕
                </button>
            </div>
        `,document.body.appendChild(d),setTimeout(()=>{d.parentElement&&d.remove()},3e3)},R=a=>{console.log("Editing project:",a),i(a),w("edit"),h(!0)},O=a=>{console.log("Deleting project:",a),i(a),u(!0)},$=()=>{l&&S.delete(route("projects.destroy",l.id),{preserveScroll:!0,onSuccess:()=>{u(!1),i(null),f(t("companies_show.project_deleted_successfully"),"success")},onError:()=>{f(t("companies_show.failed_to_delete_project"),"error")}})},W=()=>{console.log("Refreshing contacts data..."),N(),f(t("companies_show.contacts_updated_successfully"),"success")},y=()=>{i(null),w("create"),h(!0)};if(!s||!s.id)return e.jsxs(E,{children:[e.jsx(C,{title:t("companies_show.error_title")}),e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("companies_show.company_not_found")}),e.jsx("p",{className:"text-gray-600 mb-6",children:t("companies_show.company_not_found_message")}),e.jsx("button",{onClick:()=>S.visit(route("companies.index")),className:"px-6 py-3 bg-[#054748] text-white rounded-lg hover:bg-[#0a5d5e] transition-colors font-medium",children:t("companies_show.back_to_companies_list")}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("companies_show.debug_info")}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t("companies_show.url"),": ",window.location.href,e.jsx("br",{}),t("companies_show.route"),": companies.show",e.jsx("br",{}),t("companies_show.received_props"),": ",Object.keys(M).join(", ")]})]})]})})]});const o={company:{...s,contact_person:s.contact_person||s.primary_contact?.name||t("companies_show.not_available"),contact_email:s.contact_email||s.primary_contact?.email||t("companies_show.not_available"),contact_phone:s.contact_phone||s.primary_contact?.phone||t("companies_show.not_available"),contact_position:s.contact_position||s.primary_contact?.position||t("companies_show.not_available")},statistics:P||{},quotations:j||[],invoices:m||[],payments:T||[],projects:_||[],contacts:H,grouped_quotations:L||[]},B=()=>{if(A)return e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#054748]"}),e.jsx("span",{className:"ml-3 text-gray-600",children:t("companies_show.loading_data")})]});switch(c){case"profile":return e.jsx(k,{data:o.company});case"quotation":return e.jsx(Q,{data:o.quotations,groupedData:o.grouped_quotations,companyId:o.company.id});case"invoice":return e.jsx(J,{data:o.invoices,companyId:s.id});case"payment":return e.jsx(V,{data:o.payments,companyId:o.company.id,showInvoiceAmount:!0});case"project":return e.jsx(Y,{data:o.projects,onEdit:R,onDelete:O,onAdd:y});case"contact":return e.jsx(Z,{contacts:o.contacts,companyId:o.company.id,onUpdate:W,isLoading:I});default:return e.jsx(k,{data:o.company})}},F=()=>{switch(c){case"project":return e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-[#054748] text-white rounded-lg hover:bg-[#0a5d5e] transition-colors font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),t("companies_show.add_project_button")]});case"contact":return null;default:return null}};return e.jsxs(E,{children:[e.jsx(C,{title:`${o.company.client_code} - ${t("companies_show.detail_company")}`}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(G,{activeTab:c,setActiveTab:D})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"p-0",children:[s&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg mx-6 mt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:t("companies_show.success_loaded_company_data")}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[t("companies_show.viewing"),": ",e.jsx("span",{className:"font-bold",children:o.company.client_code})," |",t("companies_show.invoices"),": ",e.jsx("span",{className:"font-bold",children:o.invoices?.length||0})," |",t("companies_show.contacts"),": ",e.jsx("span",{className:"font-bold",children:o.contacts?.length||0})," |",t("companies_show.projects"),": ",e.jsx("span",{className:"font-bold",children:o.projects?.length||0})]})]})]})}),e.jsx("div",{className:"px-6",children:e.jsx(K,{company:o.company,activeTab:c,data:o,statistics:o.statistics})}),e.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow-sm border border-gray-100 mx-6 p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("div",{}),F()]}),B()]})]})})]}),g&&e.jsx(ee,{show:g,onClose:()=>{h(!1),i(null)},projectId:l?.id,companies:[{id:s.id,name:s.client_code,client_code:s.client_code,city:s.city||""}],quotations:j||[],statusOptions:[{value:"in_progress",label:t("companies_show.status_in_progress")},{value:"completed",label:t("companies_show.status_completed")},{value:"pending",label:t("companies_show.status_pending")},{value:"cancelled",label:t("companies_show.status_cancelled")}],isEdit:b==="edit",title:t(b==="edit"?"companies_show.edit_project":"companies_show.add_project")}),q&&l&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(se,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t("companies_show.delete_project")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t("companies_show.action_cannot_undone")})]})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:t("companies_show.confirm_delete_project",{name:l.project_description})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{u(!1),i(null)},className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex-1",children:t("companies_show.cancel")}),e.jsx("button",{onClick:$,className:"px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex-1",children:t("companies_show.delete")})]})]})})})]})};export{ot as default};
