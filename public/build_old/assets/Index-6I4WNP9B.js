import{u as I,r as n,j as e,a as K,H as Q,c as V}from"./app-DSAstNJH.js";import{H as W}from"./HeaderLayout-PFXXfuQf.js";import{T as Z}from"./TableLayout-DeF2PwM4.js";import{P as T}from"./ProjectModal-CoH_oeVK.js";import{X as O}from"./x-D-I7aP1o.js";import{D as ee}from"./DeleteModal-D8XyMHjw.js";import{P as te}from"./plus-Bdnms-js.js";import{S as se}from"./search-DZZ_GgUd.js";import{C as ae}from"./calendar-G4u4f0fT.js";import{F as le}from"./funnel-BOCY2HbZ.js";import{R as re}from"./refresh-cw-m21x-Xyc.js";import"./transition-CHb-6Grs.js";import"./useTranslation-BTkknNM_.js";import"./settings-BO8HVa9i.js";import"./createLucideIcon-B1SYFIyP.js";import"./send-CNJV6gwc.js";import"./globe-DUEaYrgg.js";import"./chevron-down-CC24HzTf.js";import"./check-ZSv3oBxE.js";import"./user-QIOkK541.js";import"./file-text-DfBuK0ep.js";import"./loader-circle-Crps2aKD.js";import"./building-CbxBv0Gq.js";import"./clock-RFUf-FY5.js";import"./triangle-alert-9alNtL-H.js";function oe({show:u,onClose:m,project:s,statusOptions:y}){const{data:x,setData:f,put:c,processing:o,errors:j,reset:d}=I({status:s?.status||""});n.useEffect(()=>{s&&f("status",s.status)},[s]);const S=l=>{l.preventDefault(),s&&c(route("projects.status.update",s.id),{preserveScroll:!0,onSuccess:()=>{m(),d()},onError:()=>{console.error("Failed to update status:",j)}})};if(!u)return null;const v={in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",cancelled:"bg-red-100 text-red-800"};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:m}),e.jsx("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:e.jsxs("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Update Project Status"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-500",children:e.jsx(O,{className:"w-5 h-5"})})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:s.project_description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${v[s.status]||"bg-gray-100 text-gray-800"}`,children:["Current: ",y?.find(l=>l.value===s.status)?.label||s.status]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["• Client: ",s.client?.name||"N/A"]})]})]}),e.jsxs("form",{onSubmit:S,children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Status"}),e.jsxs("select",{value:x.status,onChange:l=>f("status",l.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0,disabled:o,children:[e.jsx("option",{value:"",children:"Select Status"}),y?.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),j.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.status})]})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:o||!x.status,children:o?"Updating...":"Update Status"})]})]})]})})]})})}function Fe({projects:u,summary:m,filters:s,years:y,companies:x,quotations:f,statusOptions:c,auth_permissions:o}){const{props:j}=K(),d=j.flash||{},[S,v]=n.useState(!1),[l,E]=n.useState(!1),[L,$]=n.useState(!1),[H,C]=n.useState(!1),[w,g]=n.useState(null),[P,h]=n.useState(null),[i,M]=n.useState({search:s?.search||"",status:s?.status||"all",month:s?.month||"",year:s?.year||""});o.can_read;const R=o.can_create===1,_=o.can_update===1,A=o.can_delete===1,{data:p,setData:F,get:D,reset:ne}=I({search:i.search,status:i.status,month:i.month,year:i.year}),U={in_progress:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200"},completed:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200"},pending:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200"},cancelled:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200"}};n.useEffect(()=>{if(d.success||d.error){const t=d.success||d.error,a=d.success?"success":"error";k(t,a)}},[d]);const k=(t,a="success")=>{const r=document.createElement("div");r.className=`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${a==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,r.innerHTML=`
            <div class="flex items-center">
                <span>${t}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                    ✕
                </button>
            </div>
        `,document.body.appendChild(r),setTimeout(()=>{r.parentElement&&r.remove()},3e3)},N=(t,a)=>{M(r=>({...r,[t]:a})),F(t,a)},J=()=>{D(route("projects.index"),{preserveState:!0,preserveScroll:!0,data:{search:p.search,status:p.status!=="all"?p.status:"",month:p.month,year:p.year}})},q=()=>{M({search:"",status:"all",month:"",year:""}),F({search:"",status:"all",month:"",year:""}),D(route("projects.index"),{preserveState:!0,preserveScroll:!0})},z=t=>{console.log("Editing project ID:",t.id),g(t.id),h(t),E(!0)},Y=t=>{g(t.id),h(t),C(!0)},X=()=>{w&&V.delete(route("projects.destroy",w),{preserveScroll:!0,onSuccess:()=>{C(!1),g(null),h(null),k("Project deleted successfully!","success")},onError:()=>{k("Failed to delete project!","error")}})},B=[{value:"",label:"All Months"},{value:"1",label:"Jan"},{value:"2",label:"Feb"},{value:"3",label:"Mar"},{value:"4",label:"Apr"},{value:"5",label:"May"},{value:"6",label:"Jun"},{value:"7",label:"Jul"},{value:"8",label:"Aug"},{value:"9",label:"Sep"},{value:"10",label:"Oct"},{value:"11",label:"Nov"},{value:"12",label:"Dec"}],G=["in_progress","completed","pending","cancelled"];return e.jsx(W,{children:e.jsxs("div",{className:"px-4 md:px-8 py-6",children:[e.jsx(Q,{title:"Project Management"}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"PROJECT"})}),R&&e.jsxs("button",{onClick:()=>v(!0),className:"px-4 py-3 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors shadow-sm hover:shadow-md w-full sm:w-auto justify-center",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Add Project"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8",children:G.map(t=>{const a=U[t],r=c?.find(b=>b.value===t)?.label||t.split("_").map(b=>b.charAt(0).toUpperCase()+b.slice(1)).join(" ");return e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${a.border} ${a.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.text} uppercase tracking-wide`,children:r}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:m[t]||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Total Project"})]}),e.jsx("div",{className:`p-3 rounded-full ${a.bg}`,children:e.jsx("span",{className:"text-lg",children:a.icon})})]})},t)})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Projects"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by project description, company, or note...",value:i.search,onChange:t=>N("search",t.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:flex lg:space-x-4 gap-4",children:[e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:i.status,onChange:t=>N("status",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),c?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Month"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("select",{value:i.month,onChange:t=>N("month",t.target.value),className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:B.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"lg:w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year"}),e.jsxs("select",{value:i.year,onChange:t=>N("year",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"",children:"All Years"}),(y||[]).map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{onClick:J,className:"px-4 py-2.5 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors justify-center text-sm font-medium",children:[e.jsx(le,{className:"w-4 h-4"}),"Apply"]}),e.jsxs("button",{onClick:q,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 justify-center text-sm font-medium",children:[e.jsx(re,{className:"w-4 h-4"}),"Reset"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx(Z,{columns:[{key:"project_description",label:"Description"},{key:"name",label:"Client",render:(t,a)=>a?a.quotation?.lead?.company_name||"N/A":"-"},{key:"start_date",label:"Start Date",render:t=>t?new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-"},{key:"deadline",label:"Deadline",render:t=>t?new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-"},{key:"status",label:"Status",render:(t,a)=>{const r=c?.find(b=>b.value===t)?.label||t;return e.jsx("span",{children:r})}},{key:"note",label:"Note"}],data:u.data||[],onEdit:_?z:null,onDelete:A?Y:null,showAction:_||A,pagination:{currentPage:u.current_page,totalPages:u.last_page,totalItems:u.total,itemsPerPage:u.per_page,onPageChange:t=>D(route("projects.index",{...p,page:t}),{preserveScroll:!0})}})}),e.jsx(T,{show:S,onClose:()=>v(!1),companies:x||[],quotations:f||[],statusOptions:c||[],title:"Add Project"}),w&&e.jsxs(e.Fragment,{children:[e.jsx(T,{show:l,onClose:()=>{E(!1),g(null),h(null)},projectId:w,companies:x||[],quotations:f||[],statusOptions:c||[],isEdit:!0,title:"Edit Project"}),P&&e.jsx(oe,{show:L,onClose:()=>{$(!1),g(null),h(null)},project:P,statusOptions:c||[],companies:x||[]}),e.jsx(ee,{show:H,onClose:()=>{C(!1),g(null),h(null)},onConfirm:X,title:"Delete Project",message:`Are you sure you want to delete project "${P?.project_description}"? This action cannot be undone.`})]})]})})}export{Fe as default};
