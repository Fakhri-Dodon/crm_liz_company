import{r as h,b as g,j as e}from"./app-D-CXuYp-.js";import{u as S}from"./useTranslation-C5DOJpQ8.js";import{X as C}from"./x-7oBENnvo.js";import{U as R}from"./user-FnYjhWZf.js";import{M}from"./mail-CPS2hZM_.js";import{P as E}from"./phone-CLSBwmXQ.js";import{B as q}from"./briefcase-MmDWfAjW.js";import{c as F}from"./createLucideIcon-Da68c0mB.js";const T=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],L=F("star",T),D=({isOpen:f,onClose:b,companyId:m,contact:l=null,mode:d="add",onSuccess:y})=>{const{t:s}=S(),[c,v]=h.useState(!1),[r,i]=h.useState({}),[t,_]=h.useState({name:"",email:"",phone:"",position:"",is_primary:!1,is_active:!0});h.useEffect(()=>{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");o&&(g.defaults.headers.common["X-CSRF-TOKEN"]=o),g.defaults.headers.common.Accept="application/json",g.defaults.headers.common["Content-Type"]="application/json"},[]),h.useEffect(()=>{f&&(console.log("ContactModal opened:",{mode:d,contact:l,companyId:m,isOpen:f}),i({}),v(!1),d==="edit"&&l?(console.log("Setting edit form data:",l),_({name:l.name||"",email:l.email||"",phone:l.phone||"",position:l.position||"",is_primary:l.is_primary||!1,is_active:l.is_active!==void 0?l.is_active:!0})):(console.log("Setting add form data"),_({name:"",email:"",phone:"",position:"",is_primary:!1,is_active:!0})))},[f,d,l,m]);const x=o=>{const{name:a,value:u,type:n,checked:p}=o.target,N=n==="checkbox"?p:u;console.log(`Input change: ${a} = ${N}`),_(j=>({...j,[a]:N})),r[a]&&i(j=>({...j,[a]:null}))},w=()=>{console.log("Validating form data:",t);const o={};return t.name.trim()||(o.name=s("contact_modal.validation_name_required")),t.email.trim()?/\S+@\S+\.\S+/.test(t.email)||(o.email=s("contact_modal.validation_email_invalid")):o.email=s("contact_modal.validation_email_required"),t.phone.trim()||(o.phone=s("contact_modal.validation_phone_required")),console.log("Validation errors:",o),i(o),Object.keys(o).length===0},k=async o=>{if(o.preventDefault(),console.log("=== FORM SUBMIT STARTED ==="),console.log("Mode:",d),console.log("Company ID:",m),console.log("Form Data:",t),!w()){console.log("Form validation failed");return}v(!0),i({});try{const a=`/companies/${m}/contacts`;console.log("API Endpoint:",a);const u={name:t.name.trim(),email:t.email.trim(),phone:t.phone.trim(),position:t.position.trim(),is_primary:!!t.is_primary,is_active:!!t.is_active};console.log("Request Data:",u);let n;if(d==="edit"&&l){const p=`${a}/${l.id}`;console.log("PUT request to:",p),n=await g.put(p,u)}else console.log("POST request to:",a),n=await g.post(a,u);console.log("Server Response:",n),console.log("Response Data:",n.data),n.data.success?(console.log("Success! Data:",n.data.data),y&&y(n.data.data,d),b()):(console.error("Server returned error:",n.data),i(n.data.errors||{}),n.data.message&&i(p=>({...p,submit:n.data.message})))}catch(a){console.error("=== ERROR SAVING CONTACT ==="),console.error("Error object:",a),console.error("Error message:",a.message),console.error("Error code:",a.code),console.error("Error config:",a.config),a.response?(console.error("Response status:",a.response.status),console.error("Response headers:",a.response.headers),console.error("Response data:",a.response.data),a.response.status===422?(console.error("Validation errors:",a.response.data.errors),i(a.response.data.errors||{})):a.response.status===404?i({submit:s("contact_modal.error_route_not_found")}):a.response.status===500?i({submit:s("contact_modal.error_server_error",{message:a.response.data.message||"Internal server error"})}):i({submit:a.response.data?.message||s("contact_modal.error_save_failed")})):a.request?(console.error("No response received:",a.request),i({submit:s("contact_modal.error_no_response")})):(console.error("Error setting up request:",a.message),i({submit:s("contact_modal.error_request_setup",{message:a.message})})),console.error("Current URL:",window.location.href),console.error("CSRF Token:",document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"))}finally{v(!1),console.log("=== FORM SUBMIT COMPLETED ===")}};return f?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b z-10",children:e.jsxs("div",{className:"flex justify-between items-center p-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s(d==="edit"?"contact_modal.edit_title":"contact_modal.add_title")}),e.jsxs("p",{className:"text-gray-600 mt-1 text-sm",children:[s(d==="edit"?"contact_modal.edit_subtitle":"contact_modal.add_subtitle"),m&&e.jsxs("span",{className:"block text-xs text-teal-600 mt-1",children:[s("contact_modal.company_id"),": ",m]})]})]}),e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-lg transition",disabled:c,children:e.jsx(C,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("form",{onSubmit:k,className:"p-6",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("contact_modal.full_name")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:x,className:`w-full pl-10 pr-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors ${r.name?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:s("contact_modal.name_placeholder"),disabled:c,autoFocus:!0})]}),r.name&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mr-2"}),r.name]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("contact_modal.email_address")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:x,className:`w-full pl-10 pr-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors ${r.email?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:s("contact_modal.email_placeholder"),disabled:c})]}),r.email&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mr-2"}),r.email]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("contact_modal.phone_number")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(E,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:x,className:`w-full pl-10 pr-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors ${r.phone?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,placeholder:s("contact_modal.phone_placeholder"),disabled:c})]}),r.phone&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mr-2"}),r.phone]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("contact_modal.position_role")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(q,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"position",value:t.position,onChange:x,className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors hover:border-gray-400",placeholder:s("contact_modal.position_placeholder"),disabled:c})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:s("contact_modal.position_optional")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"is_primary",name:"is_primary",checked:t.is_primary,onChange:x,className:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded",disabled:c}),e.jsxs("label",{htmlFor:"is_primary",className:"ml-3 flex items-center text-sm text-gray-700",children:[e.jsx(L,{className:"w-4 h-4 text-yellow-500 mr-2"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s("contact_modal.set_as_primary")}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s("contact_modal.primary_warning")})]})]})]}),e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"is_active",name:"is_active",checked:t.is_active,onChange:x,className:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded",disabled:c}),e.jsxs("label",{htmlFor:"is_active",className:"ml-3 flex items-center text-sm text-gray-700",children:[e.jsx("div",{className:"w-4 h-4 mr-2 flex items-center justify-center",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${t.is_active?"bg-green-500":"bg-gray-300"}`})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s("contact_modal.active_contact")}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s("contact_modal.active_description")})]})]})]})]}),!1,r.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:s("contact_modal.error_title")}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:r.submit})})]})]})}),Object.keys(r).filter(o=>o!=="submit").length>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:s("contact_modal.check_fields")}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[r.name&&e.jsx("li",{children:s("contact_modal.validation_name_required")}),r.email&&e.jsx("li",{children:r.email}),r.phone&&e.jsx("li",{children:s("contact_modal.validation_phone_required")})]})})]})]})})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:b,disabled:c,className:"px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:s("contact_modal.cancel")}),e.jsx("button",{type:"submit",disabled:c,className:`px-6 py-2.5 font-medium rounded-lg flex items-center gap-2 transition-all ${c?"bg-gray-400 text-white cursor-not-allowed":"bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white shadow-md hover:shadow-lg"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s(d==="edit"?"contact_modal.updating":"contact_modal.adding")]}):e.jsx(e.Fragment,{children:d==="edit"?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),s("contact_modal.update_contact")]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),s("contact_modal.add_contact")]})})})]})]})]})}):null},I=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));export{D as C,L as S,I as a};
