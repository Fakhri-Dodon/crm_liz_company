import{S as ce,s as de,D as G,E as xe,B as U,m as z,r as o,q as ue,C as me,a as he,u as pe,j as e,c as y}from"./app-DSAstNJH.js";import{B as c,t as h}from"./index-Du7KK6u-.js";import{T as F,a as R,b as u,c as n,d as A,e as a}from"./Table-C5Np3-aJ.js";import{a as be}from"./api-pUWmD5-k.js";import{S as K}from"./switch-DMCinasU.js";import{S as L}from"./SimpleModal-CNVGIV5r.js";import{P as ge}from"./plus-Bdnms-js.js";import{S as fe}from"./square-pen-EjYThDv6.js";import{T as je}from"./trash-2-CVjnwYw9.js";import{L as P}from"./loader-circle-Crps2aKD.js";var Ne=class extends ce{#t;#a=void 0;#e;#s;constructor(s,r){super(),this.#t=s,this.setOptions(r),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const r=this.options;this.options=this.#t.defaultMutationOptions(s),de(this.options,r)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),r?.mutationKey&&this.options.mutationKey&&G(r.mutationKey)!==G(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#r(),this.#l(s)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#r(),this.#l()}mutate(s,r){return this.#s=r,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(s)}#r(){const s=this.#e?.state??xe();this.#a={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#l(s){U.batch(()=>{if(this.#s&&this.hasListeners()){const r=this.#a.variables,d=this.#a.context,l={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};s?.type==="success"?(this.#s.onSuccess?.(s.data,r,d,l),this.#s.onSettled?.(s.data,null,r,d,l)):s?.type==="error"&&(this.#s.onError?.(s.error,r,d,l),this.#s.onSettled?.(void 0,s.error,r,d,l))}this.listeners.forEach(r=>{r(this.#a)})})}};function ye(s,r){const d=z(),[l]=o.useState(()=>new Ne(d,s));o.useEffect(()=>{l.setOptions(s)},[l,s]);const g=o.useSyncExternalStore(o.useCallback(p=>l.subscribe(U.batchCalls(p)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),f=o.useCallback((p,D)=>{l.mutate(p,D).catch(ue)},[l]);if(g.error&&me(l.options.throwOnError,[g.error]))throw g.error;return{...g,mutate:f,mutateAsync:g.mutate}}function Te(){const{numbering:s,config:r,statuses:d,templates:l}=he().props,g=z(),[f,p]=o.useState(!1),[D,O]=o.useState(!1),[V,v]=o.useState(!1),[H,j]=o.useState(!1),[M,I]=o.useState(null),[w,q]=o.useState(null),[m,E]=o.useState({id:null,prefix:"",padding:"",next_number:"",name:""}),{data:N,setData:S,post:Q,put:X,delete:W,processing:_,reset:C,errors:ve}=pe({name:"",note:"",color:"",color_name:""}),J=()=>{I(null),C(),v(!0)},Y=()=>{E({id:s?.id||null,prefix:s?.prefix||"",padding:s?.padding||"",next_number:s?.next_number||""}),O(!0)},Z=t=>{I(t),S({name:t.name,note:t.note||"",color:t.color,color_name:t.color_name}),v(!0)},ee=()=>{q(null),C(),j(!0)},te=t=>{q(t.id),S({name:t.name}),j(!0)},se=t=>{t.preventDefault(),M?X(`/setting/proposal-status/update/${M.id}`,{onSuccess:()=>{h.success("Status updated successfully"),v(!1)}}):Q("/setting/proposal-status/store",{onSuccess:()=>{h.success("Status added successfully"),v(!1),C()}})},ae=t=>{confirm("Are you sure you want to delete this status?")&&W(`/setting/proposal-status/destroy/${t}`,{onSuccess:()=>h.success("Status deleted successfully"),onError:()=>h.error("Failed to delete status")})},re=t=>{t.preventDefault(),p(!0),y.post(`/setting/proposal_numbering/update/${m.id}`,m,{preserveScroll:!0,onSuccess:()=>{h.success("Numbering setting updated!"),O(!1)},onError:()=>h.error("Something went wrong"),onFinish:()=>p(!1)})},le=t=>{t.preventDefault(),w?y.get(route("settings.proposal-element.edit",w),N,{preserveState:!1,preserveScroll:!0,onSuccess:()=>{C(),j(!1)}}):y.get(route("settings.proposal-element.create"),N,{preserveState:!1,preserveScroll:!0,onSuccess:()=>{C(),j(!1)}})},oe=t=>{t.preventDefault(),w?y.get(route("settings.proposal-element.editNama",w),N,{preserveState:!1,preserveScroll:!0,onSuccess:()=>{C(),j(!1)}}):console.error("Data Template tidak memiliki ID",item)},ne=t=>{confirm("Are you sure you want to delete this status?")&&(t?y.delete(`/setting/proposal-element/${t}`):console.error("Data Template tidak memiliki ID",item))},B=t=>t===!0||t===1||t==="1"||t==="true",[b,T]=o.useState({proposal_user_base_visibility:!1,proposal_default_filter_by_login:!1});o.useEffect(()=>{r&&T({proposal_user_base_visibility:B(r.proposal_user_base_visibility),proposal_default_filter_by_login:B(r.proposal_default_filter_by_login)})},[r]);const $=(t,x)=>{const k=!x;T(i=>({...i,[t]:k})),p(!0),y.post("/setting/general/store",{[t]:k?1:0},{preserveScroll:!0,onSuccess:()=>{h.success("Settings updated")},onError:()=>{T(i=>({...i,[t]:x})),h.error("Failed to update settings")},onFinish:()=>p(!1)})};ye({mutationFn:t=>be.entities.ProposalStatus.delete(t),onSuccess:()=>{g.invalidateQueries(["proposalStatuses"]),h.success("Status deleted"),y.reload()}});const ie=t=>({orange:"text-orange-500 border-orange-500",blue:"text-blue-500 border-blue-500",green:"text-green-500 border-green-500",red:"text-red-500 border-red-500",draft:"text-gray-500 border-gray-400"})[t]||"text-gray-500 border-gray-500";return e.jsxs("div",{className:"space-y-12 pt-10 px-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-red-700 mb-6 uppercase tracking-wider",children:"Proposal Settings"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:"Proposal Numbering Setting"}),e.jsx(c,{onClick:Y,className:"bg-teal-800 hover:bg-teal-900 text-white px-8 h-9 font-bold uppercase text-xs tracking-widest",children:"Edit"})]}),e.jsx("div",{className:"-mx-4 sm:mx-0 px-4 sm:px-0 overflow-x-auto",children:e.jsx("div",{className:"min-w-[720px]",children:e.jsx("div",{className:"border border-teal-900 rounded-t-lg overflow-hidden mb-4 shadow-sm",children:e.jsxs(F,{children:[e.jsx(R,{className:"bg-teal-900 text-white",children:e.jsxs(u,{className:"hover:bg-teal-900 border-none",children:[e.jsx(n,{className:"text-white font-bold w-16 text-center",children:"No"}),e.jsx(n,{className:"text-white font-bold w-32 text-center",children:"Field"}),e.jsx(n,{className:"text-white font-bold w-32 text-center",children:"Value"}),e.jsx(n,{className:"text-white font-bold text-center",children:"Description"})]})}),e.jsxs(A,{children:[e.jsxs(u,{className:"border-b border-gray-300",children:[e.jsx(a,{className:"text-center font-medium",children:"1"}),e.jsx(a,{className:"text-center font-bold uppercase text-xs",children:"Prefix"}),e.jsx(a,{className:"text-center font-bold text-teal-700",children:s.prefix}),e.jsx(a,{className:"text-gray-600 italic text-sm",children:s.prefix_description})]}),e.jsxs(u,{className:"border-b border-gray-300",children:[e.jsx(a,{className:"text-center font-medium",children:"2"}),e.jsx(a,{className:"text-center font-bold uppercase text-xs",children:"Padding"}),e.jsx(a,{className:"text-center font-bold text-teal-700",children:s.padding}),e.jsx(a,{className:"text-gray-600 italic text-sm",children:s.padding_description})]}),e.jsxs(u,{className:"border-b border-gray-300",children:[e.jsx(a,{className:"text-center font-medium",children:"3"}),e.jsx(a,{className:"text-center font-bold uppercase text-xs",children:"Next Number"}),e.jsx(a,{className:"text-center font-bold text-teal-700",children:s.next_number}),e.jsx(a,{className:"text-gray-600 italic text-sm",children:s.next_number_description})]})]})]})})})}),e.jsxs("h1",{className:"font-bold uppercase text-[10px]",children:[e.jsx("span",{className:"text-red-700",children:"EXAMPLE "}),": PRO-00001 (Padding 5), PRO-0001 (Padding 4)"]}),e.jsx("h1",{className:"font-bold uppercase text-[10px]",children:'Display proposal number when saving proposal, for example "PRO-00001"'}),e.jsx(L,{isOpen:D,onClose:()=>O(!1),title:"EDIT PROPOSAL NUMBERING",children:e.jsxs("form",{onSubmit:re,className:"space-y-5",children:[e.jsx("input",{type:"hidden",value:m.id}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-teal-900 uppercase",children:"Prefix"}),e.jsx("input",{type:"text",className:"w-full border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 text-sm",value:m.prefix,onChange:t=>E({...m,prefix:t.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-teal-900 uppercase",children:"Padding (Length)"}),e.jsx("input",{type:"number",className:"w-full border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 text-sm",value:m.padding,onChange:t=>E({...m,padding:t.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-teal-900 uppercase",children:"Next Number"}),e.jsx("input",{type:"number",className:"w-full border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 text-sm",value:m.next_number,onChange:t=>E({...m,next_number:t.target.value}),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>O(!1),className:"px-4 py-2 text-xs font-bold text-gray-500 hover:text-gray-700 uppercase",children:"Cancel"}),e.jsx(c,{type:"submit",disabled:f,className:"bg-teal-800 hover:bg-teal-900 text-white px-6 py-2 text-xs font-bold uppercase tracking-widest",children:f?"Saving...":"Save Changes"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4 mt-10",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:"Proposal Status"}),e.jsxs(c,{onClick:()=>J(),className:"bg-teal-800 hover:bg-teal-900 text-white shadow-md flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"})," Add Status"]})]}),e.jsx("div",{className:"-mx-4 sm:mx-0 px-4 sm:px-0 overflow-x-auto",children:e.jsx("div",{className:"min-w-[720px]",children:e.jsx("div",{className:"border border-teal-900 rounded-t-lg overflow-hidden mb-12 shadow-sm",children:e.jsxs(F,{children:[e.jsx(R,{className:"bg-teal-900 text-white",children:e.jsxs(u,{className:"hover:bg-teal-900 border-none",children:[e.jsx(n,{className:"text-white font-bold w-16 text-center",children:"ID"}),e.jsx(n,{className:"text-white font-bold w-32 text-center",children:"Status"}),e.jsx(n,{className:"text-white font-bold text-center",children:"Note"}),e.jsx(n,{className:"text-white font-bold w-32 text-center",children:"Color"}),e.jsx(n,{className:"text-white font-bold w-24 text-center",children:"Action"})]})}),e.jsx(A,{children:d&&d.length>0?d.map((t,x)=>e.jsxs(u,{className:"border-b border-gray-300",children:[e.jsx(a,{className:"text-center font-medium",children:x+1}),e.jsx(a,{className:`text-center font-bold ${ie(t.color).split(" ")[0]}`,children:t.name}),e.jsx(a,{className:"text-sm text-gray-600",children:t.note||"-"}),e.jsx(a,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),t.color_name]})}),e.jsx(a,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-blue-600",onClick:()=>Z(t),children:e.jsx(fe,{className:"w-4 h-4"})}),!t.is_system&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-600",onClick:()=>ae(t.id),children:e.jsx(je,{className:"w-4 h-4"})})]})})]},t.id)):e.jsx(u,{children:e.jsx(a,{colSpan:5,className:"text-center py-8 text-gray-400 italic",children:"No statuses available."})})})]})})})}),e.jsx(L,{isOpen:V,onClose:()=>v(!1),title:M?"Edit Proposal Status":"Create New Proposal Status",children:e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status Name"}),e.jsx("input",{type:"text",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-teal-500 focus:border-teal-500",value:N.name,onChange:t=>S("name",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Note"}),e.jsx("textarea",{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-teal-500 focus:border-teal-500",rows:"2",value:N.note,onChange:t=>S("note",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Color"}),e.jsxs("select",{required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-teal-500 focus:border-teal-500",value:N.color_name,onChange:t=>{const x=t.target.value,k={Orange:"#F97316",Blue:"#3B82F6",Green:"#22C55E",Red:"#ef4444",Gray:"#6B7280"};S(i=>({...i,color_name:x,color:k[x]||""}))},children:[e.jsx("option",{value:"",children:"-- Choose Color --"}),e.jsx("option",{value:"Orange",children:"Orange"}),e.jsx("option",{value:"Red",children:"Red"}),e.jsx("option",{value:"Blue",children:"Blue"}),e.jsx("option",{value:"Green",children:"Green"}),e.jsx("option",{value:"Gray",children:"Gray"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(c,{type:"submit",className:"bg-teal-900 text-white",disabled:_,children:_?e.jsx(P,{className:"w-4 h-4 animate-spin"}):"Save Changes"})]})]})}),e.jsx("h3",{className:"font-bold text-gray-800 mb-4 uppercase text-sm tracking-widest",children:"Proposal Restrictions"}),e.jsx("div",{className:"-mx-4 sm:mx-0 px-4 sm:px-0 overflow-x-auto",children:e.jsx("div",{className:"min-w-[720px]",children:e.jsx("div",{className:"border border-teal-900 rounded-lg overflow-hidden bg-white shadow-sm mb-12",children:e.jsxs(F,{children:[e.jsx(R,{className:"bg-teal-900",children:e.jsxs(u,{className:"hover:bg-teal-900 border-none",children:[e.jsx(n,{className:"text-white font-bold w-48 text-center border-r border-teal-800",children:"Field"}),e.jsx(n,{className:"text-white font-bold w-32 text-center border-r border-teal-800",children:"Setting"}),e.jsx(n,{className:"text-white font-bold text-center border-r border-teal-800",children:"Description"}),e.jsx(n,{className:"text-white font-bold w-64 text-center",children:"Current Status"})]})}),e.jsxs(A,{children:[e.jsxs(u,{className:"border-b",children:[e.jsx(a,{className:"font-bold px-4 text-center border-r bg-gray-50/50",children:"User-Base Visibility"}),e.jsx(a,{className:"text-center py-6 border-r",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(K,{checked:b.proposal_user_base_visibility,onCheckedChange:()=>$("proposal_user_base_visibility",b.proposal_user_base_visibility),disabled:f}),e.jsx("span",{className:`text-[10px] font-black uppercase ${b.proposal_user_base_visibility?"text-green-600":"text-red-600"}`,children:b.proposal_user_base_visibility?"ON":"OFF"})]})}),e.jsx(a,{className:"px-4 text-sm border-r",children:"Restrict users to see only Proposals they created or related to their Leads."}),e.jsx(a,{className:"px-4 text-sm bg-gray-50/50",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-red-700 uppercase text-[10px]",children:"ON"})," ","= User sees only their Leads"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-red-700 uppercase text-[10px]",children:"OFF"})," ","= User sees all accessible Leads"]})]})})]}),e.jsxs(u,{children:[e.jsx(a,{className:"font-bold px-4 text-center border-r bg-gray-50/50",children:"Default Filter by Login"}),e.jsx(a,{className:"text-center py-6 border-r",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(K,{checked:b.proposal_default_filter_by_login,onCheckedChange:()=>$("proposal_default_filter_by_login",b.proposal_default_filter_by_login),disabled:f}),e.jsx("span",{className:`text-[10px] font-black uppercase ${b.proposal_default_filter_by_login?"text-green-600":"text-red-600"}`,children:b.proposal_default_filter_by_login?"ON":"OFF"})]})}),e.jsx(a,{className:"px-4 text-sm border-r",children:"Automatically filter Proposal table to show only data related to the logged-in user."}),e.jsxs(a,{className:"px-4 text-sm bg-gray-50/50 italic text-gray-600",children:["If"," ",e.jsx("span",{className:"font-bold text-red-700 uppercase text-[10px]",children:"OFF"}),", table shows all visible Leads initially; user can still filter manually."]})]})]})]})})})})]}),e.jsxs("div",{className:"pt-4 pb-10",children:[e.jsx("h2",{className:"text-xl font-bold text-red-700 mb-6 uppercase tracking-wider text-right",children:"Templates"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mb-6",children:l.map((t,x)=>{const k=t?.preview_image?`/storage/proposal_thumbnails/${t.preview_image}`:null;return e.jsx("a",{href:`/proposal/${t.id}`,target:"_blank",rel:"noopener noreferrer",children:e.jsxs("div",{className:"group cursor-pointer",children:[e.jsxs("div",{className:"relative border border-gray-300 aspect-[3/4] flex flex-col transition-all group-hover:shadow-lg group-hover:border-teal-500 rounded-md overflow-hidden",children:[e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-2 opacity-0 group-hover:opacity-100 transition",children:[e.jsx("button",{className:"hover:bg-black text-blue-600 px-1 rounded-full shadow",onClick:i=>{i.preventDefault(),i.stopPropagation(),te(t)},children:"âœŽ"}),e.jsx("button",{className:"hover:bg-black text-red-600 px-2 rounded-full shadow",onClick:i=>{i.preventDefault(),i.stopPropagation(),ne(t.id)},children:"X"})]}),e.jsx("div",{className:"h-2/3 w-full bg-cover bg-center group-hover:opacity-90",style:{backgroundImage:`url(${k})`}}),e.jsx("div",{className:"h-1/3 w-full bg-white flex items-center justify-center text-[10px] font-bold text-gray-300 tracking-widest",children:"PREVIEW"})]}),e.jsx("p",{className:"mt-3 text-xs font-bold text-gray-700 uppercase text-center",children:t.name})]},x)})})}),e.jsx("div",{className:"flex justify-end gap-4 mt-8",children:e.jsx(c,{onClick:ee,className:"bg-teal-800 hover:bg-teal-900 text-white px-10 h-9 font-bold uppercase text-xs tracking-widest",children:"Add New Template"})}),e.jsx(L,{isOpen:H,onClose:()=>j(!1),title:w?"EDIT TEMPLATE NAME":"ADD PROPOSAL TEMPLATE",children:e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Template Name"}),e.jsx("input",{type:"text",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-teal-500 focus:border-teal-500",value:N.name,onChange:t=>S("name",t.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),w?e.jsx(c,{type:"button",className:"bg-green-900 text-white",onClick:oe,disabled:_,children:_?e.jsx(P,{className:"w-4 h-4 animate-spin"}):"Save Name"}):null,e.jsx(c,{type:"submit",className:"bg-teal-900 text-white",disabled:_,children:_?e.jsx(P,{className:"w-4 h-4 animate-spin"}):"Save Changes"})]})]})})]}),f&&e.jsxs("div",{className:"fixed bottom-8 right-8 bg-teal-900 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 z-50 border border-teal-500/50 animate-in fade-in slide-in-from-bottom-4",children:[e.jsx(P,{className:"w-5 h-5 animate-spin text-teal-300"}),e.jsx("span",{className:"font-bold text-[10px] uppercase tracking-widest",children:"Synchronizing..."})]})]})}export{Te as P};
