import{r as l,j as e,u as O,H as T,c as W}from"./app--V8YQuQk.js";import{H as z}from"./HeaderLayout-Bk7u9NLn.js";import{T as U}from"./TableLayout-BTyK602-.js";import{M as R}from"./ModalAdd-Ck_CNFB1.js";import{P as N}from"./PrimaryButton-D8xKtEFh.js";import{u as G}from"./useTranslation-DGCn9e9S.js";import{C as J}from"./chevron-down-DnOCgVxl.js";import"./transition-D2W53CQ5.js";import"./index-DvGSOaWZ.js";import"./settings-B2fgqRwV.js";import"./createLucideIcon-D7A-7CJ7.js";import"./send-BzvzPsAY.js";import"./globe-DUm1N8J0.js";import"./check-BtXJC3Kt.js";import"./user-D9rdox91.js";import"./file-text-BkpdNTL0.js";import"./x-DGqtnagE.js";function xe({proposals:c,statusOptions:K,summary:p,filters:o,filterData:Q,lead:b,auth_permissions:d}){const{t:s}=G(),[w,n]=l.useState(!1),[_,V]=l.useState(!1),[i,g]=l.useState("add"),[k,h]=l.useState(null);d.can_read;const C=d.can_create===1,f=d.can_update===1,j=d.can_delete===1;l.useEffect(()=>{console.log("Inertia summary:",p)},[p]);const M=[{key:"no",label:s("proposals.table.no_date"),render:(t,a)=>{const r=!!a.edited;return e.jsxs("div",{children:[e.jsx("a",{href:r?`/proposal/${a.element_id}`:void 0,target:r?"_blank":void 0,rel:r?"noopener noreferrer":void 0,onClick:H=>{r||H.preventDefault()},className:`font-semibold flex items-center gap-1 ${r?"text-blue-600 hover:underline":"text-gray-400 cursor-not-allowed"}`,children:t}),e.jsx("div",{className:"text-gray-500 text-sm mt-1",children:a.date||"-"})]})}},{key:"title",label:s("proposals.table.title")},{key:"company_name",label:s("proposals.table.company_name"),render:(t,a)=>{const r=!!a.is_client;return e.jsx("span",{className:`font-medium ${r?"text-blue-600":"text-black"}`,children:a.lead?.company_name||t})}},{key:"contact",label:s("proposals.table.contact")},{key:"created_by",label:s("proposals.table.created_by")},{key:"status",label:s("proposals.table.status"),render:(t,a)=>{const r={approved:"border-greed-500 text-greed-700 bg-greed-50",opened:"border-greed-500 text-greed-700 bg-greed-50",draft:"border-grey-500 text-grey-700 bg-grey-50",sent:"border-blue-500 text-blue-700 bg-blue-50",failed:"border-orange-500 text-orange-700 bg-orange-50",rejected:"border-red-500 text-red-700 bg-red-50",revised:"border-red-500 text-red-700 bg-red-50"};return e.jsxs("select",{value:t,disabled:!0,style:{backgroundImage:"none",WebkitAppearance:"none",MozAppearance:"none"},className:`appearance-none text-xs font-bold py-1 px-2 rounded-lg border-2 focus:ring-0 cursor-pointer transition-all ${r[t]||"border-gray-300"}`,children:[e.jsx("option",{value:"approved",children:s("proposals.stats.approved")}),e.jsx("option",{value:"opened",children:s("proposals.stats.opened")}),e.jsx("option",{value:"draft",children:s("proposals.stats.draft")}),e.jsx("option",{value:"sent",children:s("proposals.stats.sent")}),e.jsx("option",{value:"failed",children:s("proposals.stats.failed")}),e.jsx("option",{value:"rejected",children:s("proposals.stats.rejected")}),e.jsx("option",{value:"revised",children:s("proposals.stats.revised")})]})}}],[m,S]=l.useState({search:o?.search||"",status:o?.status||"all",proposal_id:o?.proposal_id||""});l.useEffect(()=>{S({search:o?.search||"",status:o?.status||"all",month:o?.month||"",year:o?.year||""})},[o]);const $={sent:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200",icon:"⚡"},opened:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",icon:"✅"},rejected:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200",icon:"⏳"},failed:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:"❌"}},y=c.data.map(t=>({id:t.id,no:t.proposal_number,date:t.date,title:t.title||"-",lead_id:t.lead_id||"-",company_name:t.lead?.company_name||"-",contact:t.lead?.contact_person||"-",created_by:t.creator?.name||"Admin",status:t.status,edited:t.edited,element_id:t.proposal_element_template_id})),{data:v,setData:x,post:D,put:E,processing:L,errors:P,reset:u}=O({name:"",lead_id:""}),I=()=>{g("add"),h(null),u(),n(!0)},A=t=>{i==="add"&&D(route("proposal.add"),{onSuccess:()=>{u(),n(!1)}}),i==="edit"&&E(route("proposal.update",k),{onSuccess:()=>{u(),n(!1)}})},B=t=>{console.log(t),g("edit"),h(t.id),x({name:t.title??"",lead_id:t.lead_id??""}),n(!0)},F=t=>{t&&t.id?W.delete(`/proposal/${t.id}`):console.error("Data proposal tidak memiliki ID",t)};return c?.data&&[...new Set(c.data.map(t=>t.title).filter(Boolean))],e.jsxs(e.Fragment,{children:[e.jsx(R,{isOpen:w,onClose:()=>n(!1),title:i==="add"?"Create Proposal":"Edit Proposal",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(!1),className:"text-gray-500 hover:text-gray-700 font-bold px-4 py-2",children:"Cancel"}),e.jsx(N,{onClick:A,disabled:L,className:"w-full sm:w-auto px-5 py-2.5 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:e.jsx("span",{children:i==="add"?"Create":"Update"})})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"title*"}),e.jsx("input",{type:"text",value:v.name,onChange:t=>x("name",t.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name*"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:v.lead_id,onChange:t=>x("lead_id",t.target.value),className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent appearance-none transition-colors ${P.lead_id?"border-red-300":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",className:"text-gray-400",children:"Select Company Name"}),b&&b.map(t=>e.jsx("option",{value:t.id,children:t.company_name},t.id))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(J,{className:"w-4 h-4"})})]})]})]})})}),e.jsx(z,{title:"Proposals Management",subtitle:"Manage all company proposals"}),e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Proposal"}),C&&e.jsxs(N,{onClick:I,className:"w-full sm:w-auto px-5 py-2.5 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:s("proposals.button_add")})]})]}),e.jsx(T,{title:"Proposals"}),e.jsx("div",{className:"grid grid-cols-4 gap-6 my-7",children:Object.entries($).map(([t,a])=>e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${a.border} ${a.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${a.text} uppercase tracking-wide`,children:s(`proposals.stats.${t}`)}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:p[t]||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Total Proposal"})]}),e.jsx("div",{className:`p-3 rounded-full ${a.bg}`,children:e.jsx("span",{className:"text-lg",children:a.icon})})]})},t))}),e.jsx("div",{className:"bg-white border-none border-gray-200 py-2",children:e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full lg:w-auto"})})}),e.jsx("div",{className:"py-3",children:_?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 border border-gray-200 rounded-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:s("common.loading")||"Loading..."})]}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 border border-gray-200 rounded-sm bg-gray-50",children:[e.jsx("div",{className:"h-12 w-12 text-gray-300 mb-4",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-gray-500 font-medium mb-2",children:m.search?s("proposals.empty.no_match"):s("proposals.empty.no_data")}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:m.search?s("proposals.empty.try_again"):s("proposals.empty.start_add")}),m.search&&e.jsx("button",{onClick:()=>setSearch(""),className:"px-4 py-2 text-blue-600 hover:text-blue-800 text-sm font-medium hover:bg-blue-50 rounded-lg transition-colors",children:s("proposals.filters.clear_search")})]}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-sm overflow-hidden shadow-sm",children:e.jsx(U,{data:y,columns:M,onEdit:f?B:null,onDelete:j?F:null,showAction:f||j})})})]})]})}export{xe as default};
