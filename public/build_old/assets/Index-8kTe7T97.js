import{r as m,u as ie,b as z,j as e,H as de,c as g}from"./app-D-CXuYp-.js";import{H as me,F as ce,S as P}from"./HeaderLayout-DNM94YMu.js";import{T as ue}from"./TableLayout-DegOKxQR.js";import{u as pe}from"./useTranslation-C5DOJpQ8.js";import{S as xe}from"./search-BSE1nh5m.js";import{C as ye}from"./calendar-BLzufnGW.js";import{F as he}from"./funnel-roI5fP4i.js";import{R as be}from"./refresh-cw-DQMJkT9J.js";import{F as ge}from"./file-text-cCH1Ukzd.js";import{X as B}from"./x-7oBENnvo.js";import"./transition-Dd6dQS9p.js";import"./index-Dml3iHVq.js";import"./settings--wXcYxvN.js";import"./createLucideIcon-Da68c0mB.js";import"./send-WSU91zWN.js";import"./globe-Ct8OYrI2.js";import"./chevron-down-D5S3ga3K.js";import"./check-BdhqU_fL.js";import"./user-FnYjhWZf.js";const Le=(C,f="success")=>{P.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:h=>{h.onmouseenter=P.stopTimer,h.onmouseleave=P.resumeTimer}}).fire({icon:f,title:C})};function Oe({payments:C=[],stats:f={},filters:j={},auth_permissions:h}){const{t:a}=pe(),[D,p]=m.useState(!1),[H,N]=m.useState(!1),[l,T]=m.useState(null),[Y,M]=m.useState(null),[_,R]=m.useState([]),[v,F]=m.useState(null),[x,y]=m.useState(!1);h.can_read;const U=h.can_create===1,L=h.can_update===1,O=h.can_delete===1,[r,c]=m.useState({invoice_id:"",company_name:"",amount:"",method:"transfer",date:"",bank:"",note:""}),G=[a("payments.method.transfer"),a("payments.method.cash"),a("payments.method.check")],X=[{value:"",label:a("payments.filters.all_months")||"All Months"},{value:"1",label:a("payments.month.january")},{value:"2",label:a("payments.month.february")},{value:"3",label:a("payments.month.march")},{value:"4",label:a("payments.month.april")},{value:"5",label:a("payments.month.may")},{value:"6",label:a("payments.month.june")},{value:"7",label:a("payments.month.july")},{value:"8",label:a("payments.month.august")},{value:"9",label:a("payments.month.september")},{value:"10",label:a("payments.month.october")},{value:"11",label:a("payments.month.november")},{value:"12",label:a("payments.month.december")}],J={total_payment:{bg:"bg-blue-100",text:"text-blue-800",border:"border-blue-200",icon:"ðŸ“Š"},transfer:{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",icon:"ðŸ’¸"},cash:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200",icon:"ðŸ’µ"},check:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:"ðŸ§¾"}},K=["total_payment","transfer","cash","check"],{data:d,setData:q,get:Q}=ie({keyword:j.keyword||"",method:j.method||"all",month:j.month||"",year:j.year||""}),[u,I]=m.useState({keyword:d.keyword||"",method:d.method||"all",month:d.month||"",year:d.year||""});m.useEffect(()=>{I({keyword:d.keyword||"",method:d.method||"all",month:d.month||"",year:d.year||""})},[d.keyword,d.method,d.month,d.year]);const w=(t,n)=>{I(i=>({...i,[t]:n})),q(t,n)},V=()=>{Q(route("payment.index"),{preserveState:!0,preserveScroll:!0,replace:!0,data:{keyword:u.keyword,method:u.method!=="all"?u.method:"",month:u.month,year:u.year}})},W=()=>{const t={keyword:"",method:"all",month:"",year:""};I(t),q(t),g.get(route("payment.index"),{},{replace:!0,preserveState:!1,preserveScroll:!0})},E=t=>new Intl.NumberFormat("id-ID").format(t),Z=[{key:"invoice",label:a("payments.table.invoice")},{key:"date",label:a("payments.table.date")},{key:"company_name",label:a("payments.table.company_name")},{key:"amount",label:a("payments.table.amount")},{key:"method",label:a("payments.table.method")},{key:"bank",label:a("payments.table.bank")},{key:"note",label:a("payments.table.note")}],ee=C.map(t=>({id:t.id,no:t.invoice_number||`#${t.id}`,date:t.payment_date,invoice:t.invoice_number,company_name:t.company_name||"N/A",amount:`Rp ${E(t.amount)}`,method:t.methode,bank:t.bank||"-",note:t.note||"-",original:t}));m.useEffect(()=>{D&&!l&&te()},[D]);const te=async()=>{try{const n=((await z.get(route("payment.get-invoices"))).data||[]).filter(i=>(i.remaining_amount??0)>0);R(n)}catch(t){console.error("Failed to load invoices:",t)}},ae=()=>{T(null),F(null),c({invoice_id:"",company_name:"",amount:"",method:"transfer",date:"",bank:"",note:""}),p(!0)},ne=t=>{const n=_.find(i=>i.id===t);n&&(F(n),c(i=>({...i,invoice_id:t,company_name:n.company_name,amount:n.remaining_amount||n.total_amount-n.paid_amount})))},se=async t=>{const n=t.original?t.original:t;T(n);const i=o=>{if(o==null)return"";if(typeof o=="number")return String(o);let s=String(o).replace(/[^0-9,\.\-]/g,"").trim();return s.indexOf(",")>-1&&s.indexOf(".")>-1?s.lastIndexOf(",")>s.lastIndexOf(".")?s=s.replace(/\./g,"").replace(/,/g,"."):s=s.replace(/,/g,""):s=s.replace(/,/g,""),s},k=o=>{if(!o)return"";if(/^\d{2}-\d{2}-\d{4}$/.test(o))return o.split("-").reverse().join("-");if(/^\d{2}\/\d{2}\/\d{4}$/.test(o)){const[b,$,A]=o.split("/");return`${A}-${b.padStart(2,"0")}-${$.padStart(2,"0")}`}const s=new Date(o);if(!isNaN(s)){const b=s.getFullYear(),$=String(s.getMonth()+1).padStart(2,"0"),A=String(s.getDate()).padStart(2,"0");return`${b}-${$}-${A}`}return""},S=o=>{let s=o.find(b=>b.id===n.invoice_id);!s&&n.invoice_id&&(s={id:n.invoice_id,invoice_number:n.invoice_number||t.invoice||null,company_name:n.company_name||t.company_name||"No Company",remaining_amount:n.amount??0,total_amount:n.amount??0,paid_amount:0},o=[...o,s],R(o)),F(s||null),c({invoice_id:n.invoice_id||t.invoice_id||"",company_name:s?s.company_name:n.company_name||t.company_name||"",amount:i(n.amount??t.amount??""),method:(n.methode??n.method??t.method??"transfer").toString().toLowerCase(),date:k(n.payment_date??t.payment_date??t.date??""),bank:n.bank||t.bank||"",note:n.note||t.note||""})};if(_.length>0)S(_),p(!0);else try{const s=((await z.get(route("payment.get-invoices"))).data||[]).filter(b=>(b.remaining_amount??0)>0);S(s),p(!0)}catch{c({invoice_id:n.invoice_id||t.invoice_id||"",company_name:n.company_name||t.company_name||"",amount:i(n.amount??t.amount??""),method:(n.methode??n.method??t.method??"transfer").toString().toLowerCase(),date:k(n.payment_date??t.payment_date??t.date??""),bank:n.bank||t.bank||"",note:n.note||t.note||""}),p(!0)}},re=t=>{M(t),N(!0)},oe=t=>{t.preventDefault(),y(!0);const n={invoice_id:r.invoice_id,amount:r.amount,method:r.method,date:r.date,bank:r.bank,note:r.note};l?g.patch(route("payment.update",l.id),n,{preserveScroll:!0,onSuccess:()=>{p(!1),y(!1),g.reload()},onError:()=>{y(!1)}}):g.post(route("payment.store"),n,{preserveScroll:!0,onSuccess:()=>{p(!1),y(!1),g.reload()},onError:()=>{y(!1)}})},le=()=>{y(!0),g.delete(route("payment.destroy",Y.id),{preserveScroll:!0,onSuccess:()=>{N(!1),M(null),y(!1),g.reload()},onError:()=>{y(!1)}})};return e.jsxs(me,{children:[e.jsx(de,{title:a("payments.title")}),e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a("payments.title")}),U&&e.jsx("button",{onClick:ae,className:"bg-teal-700 hover:bg-teal-800 text-white px-6 py-2 rounded-md transition-colors",children:a("payments.button_add")})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:K.map(t=>{const n=J[t],i=a(t==="total_payment"?"payments.title":`payments.method.${t}`),k=t==="total_payment"?f.total_payment?.count||0:f[t]?.count||0,S=t==="total_payment"?f.total_payment?.amount||0:f[t]?.amount||0;return e.jsx("div",{className:`rounded-xl p-5 shadow-sm border ${n.border} ${n.bg} transition-transform hover:scale-[1.02] hover:shadow-md`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${n.text} uppercase tracking-wide`,children:i}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-2",children:k}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Rp ",E(S)]})]}),e.jsx("div",{className:`p-3 rounded-full ${n.bg}`,children:e.jsx("span",{className:"text-lg",children:n.icon})})]})},t)})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.search_placeholder")}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:a("payments.filters.search_placeholder"),value:u.keyword,onChange:t=>w("keyword",t.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:flex lg:space-x-4 gap-4",children:[e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.method")}),e.jsxs("select",{value:u.method,onChange:t=>w("method",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"all",children:a("payments.filters.all_methods")||"All Methods"}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.month")}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("select",{value:u.month,onChange:t=>w("month",t.target.value),className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:X.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"lg:w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.filters.year")}),e.jsxs("select",{value:u.year,onChange:t=>w("year",t.target.value),className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#005954] focus:border-transparent bg-white text-sm",children:[e.jsx("option",{value:"",children:a("payments.filters.all_years")||"All Years"}),e.jsx("option",{value:"2024",children:"2024"}),e.jsx("option",{value:"2025",children:"2025"}),e.jsx("option",{value:"2026",children:"2026"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{onClick:V,className:"px-4 py-2.5 bg-[#005954] text-white rounded-lg hover:bg-[#004d47] flex items-center gap-2 transition-colors justify-center text-sm font-medium",children:[e.jsx(he,{className:"w-4 h-4"}),a("payments.filters.apply")]}),e.jsxs("button",{onClick:W,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 justify-center text-sm font-medium",children:[e.jsx(be,{className:"w-4 h-4"}),a("payments.filters.reset")]})]})]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:e.jsx(ue,{data:ee,columns:Z,onEdit:L?se:null,onDelete:O?re:null,showAction:L||O})})}),D&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#005954]/10 rounded-lg",children:e.jsx(ge,{className:"w-6 h-6 text-[#005954]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:a(l?"payments.edit_title":"payments.add_title")}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:l?a("payments.edit_subtitle")||"Update payment details":a("payments.add_subtitle")||"Create a new payment"})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",disabled:x,children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:oe,className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.invoice"),e.jsx("span",{className:"text-red-500",children:"*"})]}),l?e.jsx("input",{type:"text",value:(v&&v.invoice_number?v.invoice_number+" - ":l.invoice_number?l.invoice_number+" - ":"")+(v&&v.company_name?v.company_name:l.company_name||"No Company"),disabled:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-100 text-sm"}):e.jsxs("select",{value:r.invoice_id,onChange:t=>ne(t.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0,children:[e.jsx("option",{value:"",children:a("payments.select_invoice")||"Select Invoice"}),(()=>{let t=_.slice();return l&&r.invoice_id&&(t.some(i=>i.id===r.invoice_id)||t.push({id:r.invoice_id,invoice_number:l.invoice_number,company_name:l.company_name,remaining_amount:l.amount,total_amount:l.amount,paid_amount:0})),t.length>0?t.map(n=>e.jsxs("option",{value:n.id,children:[n.invoice_number," - ",n.company_name||"No Company"," (Remaining: Rp ",E(n.remaining_amount??n.total_amount-n.paid_amount),")"]},n.id)):e.jsx("option",{value:"",disabled:!0,children:a("payments.no_unpaid_invoice")||"No unpaid invoices available"})})()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.table.company_name")}),e.jsx("input",{type:"text",value:r.company_name,disabled:!0,placeholder:"Appears when selecting invoice",className:"w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-100 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.amount"),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:r.amount,onChange:t=>c({...r,amount:t.target.value}),placeholder:"Rp.",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.method"),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.method,onChange:t=>c({...r,method:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0,children:[e.jsx("option",{value:"transfer",children:a("payments.method.transfer")}),e.jsx("option",{value:"cash",children:a("payments.method.cash")}),e.jsx("option",{value:"check",children:a("payments.method.check")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a("payments.table.date"),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:r.date,onChange:t=>c({...r,date:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.table.bank")}),e.jsx("input",{type:"text",value:r.bank,onChange:t=>c({...r,bank:t.target.value}),placeholder:"Bank name and branch",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("payments.table.note")}),e.jsx("textarea",{value:r.note,onChange:t=>c({...r,note:t.target.value}),rows:"3",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent min-h-[100px] resize-none text-sm"})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-6 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),disabled:x,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:a("payments.close")||"CANCEL"}),e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d47] transition-colors font-medium flex-1 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm hover:shadow-md",children:x?a("payments.processing")||"PROCESSING...":a("payments.submit")||"SUBMIT"})]})]})]})})}),H&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#005954]/10 rounded-lg",children:e.jsx("span",{className:"text-[#005954]",children:e.jsx(ce,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a("payments.delete_title")||"Delete Payment"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a("payments.delete_confirm")||"Are you sure?"})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",disabled:x,children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"border border-gray-300 rounded-md p-4 mb-6",children:e.jsx("p",{className:"text-red-600 text-center",children:a("payments.delete_warning")||"Do you really want to delete this payment permanently. You cannot undo this action"})}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>N(!1),disabled:x,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:a("payments.no")||"NO"}),e.jsx("button",{onClick:le,disabled:x,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d47] transition-colors font-medium flex-1 disabled:opacity-50",children:x?a("payments.deleting")||"DELETING...":a("payments.yes")||"YES"})]})]})]})})})]})]})}export{Oe as default,Le as toast};
