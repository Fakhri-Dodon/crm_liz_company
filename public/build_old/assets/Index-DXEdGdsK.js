import{r as o,u as B,j as e,c as f}from"./app-BTbkV42h.js";import{H as R}from"./HeaderLayout-BOd0q3W-.js";import{P as $}from"./PrimaryButton-tLhKuWAj.js";import{T as W}from"./TableLayout-C2tjGemz.js";import{M as q}from"./ModalAdd-B8tK-ZdA.js";import{n as l}from"./index-CsoFOmIB.js";import{u as J}from"./useTranslation-CATg2OkV.js";import"./transition-MPasdNlU.js";import"./settings-CdYEu26S.js";import"./createLucideIcon-DHxmSlVR.js";import"./send-stj9b7Y9.js";import"./globe-CiSLK2lF.js";import"./chevron-down-BBjuMcoq.js";import"./check-CMDYYhgh.js";import"./user-DWczQdUG.js";import"./file-text-DZzzDjT5.js";import"./x-bUU7PHNQ.js";function xe({users:N,roles:k,templates:_,auth_permissions:c}){const[S,n]=o.useState(!1),[i,u]=o.useState(null),[C,x]=o.useState(!1),[E,p]=o.useState(!1),[d,g]=o.useState(null),[V,G]=o.useState("welcome"),[m,T]=o.useState("");c.can_read;const M=c.can_create===1,j=c.can_update===1,y=c.can_delete===1,{t:a}=J(),{data:t,setData:r,post:I,processing:v,errors:K,reset:b}=B({name:"",position:"",email:"",phone:"",password:"",role_id:""}),L=[{key:"name",label:a("users.table.name")||"Name"},{key:"position",label:a("users.table.position")||"Position"},{key:"role",label:a("users.table.role")||"Role"},{key:"email",label:a("users.table.email")||"Email"},{key:"phone",label:a("users.table.phone")||"Phone"},{key:"last_seen",label:a("users.table.last_seen")||"Last Seen"}],P=N.map(s=>({id:s.id,name:s.name,position:s.position,role:s.role?.name,role_id:s.role_id,email:s.email,phone:s.phone,last_seen:s.last_seen_formatted})),U=()=>{u(null),b(),n(!0)},D=s=>{s.preventDefault(),i?f.patch(`/user/update/${i}`,t,{onSuccess:()=>{n(!1),u(null),b()}}):I("/user/store",{onSuccess:()=>{n(!1),b()}})},A=s=>{u(s.id),r({name:s.name,position:s.position,email:s.email,phone:s.phone,role_id:s.role_id,password:""}),n(!0)},F=s=>{const h=typeof s=="object"?s.id:s;if(console.log("Menghapus ID:",h),!h){l.error("Error: ID tidak ditemukan!");return}if(confirm("Are you sure you want to delete this user?")){const w=l.loading("Menghapus user...");f.delete(`/user/destroy/${h}`,{onSuccess:()=>{l.success("User deleted successfully",{id:w})},onError:z=>{console.error("Terjadi kesalahan:",z),l.error("Terjadi kesalahan saat menghapus user.",{id:w})}})}},H=s=>{if(!s.email){l.error("User ini tidak memiliki alamat email.");return}g(s),p(!0)},O=()=>{!d||!m||(p(!1),console.log("Mengirim Template ID:",m),f.post(`/user/send-email/${d.id}`,{template:m},{onStart:()=>{x(!0),l.loading("Sedang mengirim email...",{id:"send-email-toast"})},onFinish:()=>{x(!1),l.dismiss("send-email-toast")},onSuccess:()=>{l.success(`Email berhasil dikirim ke ${d.name}!`),g(null)},onError:s=>{l.error("Terjadi kesalahan saat mengirim email."),console.error(s)},preserveScroll:!0}))};return e.jsxs(e.Fragment,{children:[e.jsx(q,{isOpen:S,onClose:()=>n(!1),title:i?a("users.modals.edit_title")||"Edit User":a("users.modals.add_title")||"Add User",subtitle:i?"Update existing user information":"Create a new user account",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(!1),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium flex-1",children:a("users.modals.btn_cancel")||"Cancel"}),e.jsxs("button",{onClick:D,disabled:v,className:"px-6 py-3 bg-[#005954] text-white rounded-xl hover:bg-[#004d47] transition-colors font-medium flex-1 disabled:opacity-50 flex items-center justify-center gap-2 shadow-sm",children:[v?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:i?a("users.modals.btn_update")||"Update":a("users.modals.btn_add")||"Add"})]})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("users.modals.label_name")||"Name*"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>r("name",s.target.value),placeholder:"Full Name",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("users.modals.label_position")||"Position*"}),e.jsx("input",{type:"text",value:t.position,onChange:s=>r("position",s.target.value),placeholder:"Job Position",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("users.modals.label_email")||"Email*"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>r("email",s.target.value),placeholder:"email@example.com",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("users.modals.label_phone")||"Phone*"}),e.jsx("input",{type:"text",value:t.phone,onChange:s=>r("phone",s.target.value),placeholder:"Phone Number",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("users.modals.label_role")||"Role*"}),e.jsxs("select",{value:t.role_id,onChange:s=>r("role_id",s.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors appearance-none",children:[e.jsx("option",{value:"",children:a("users.modals.choose_role")||"-- Choose Role --"}),k?.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("users.modals.label_password")||"Password*"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>r("password",s.target.value),placeholder:"••••••••",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#005954] focus:border-transparent transition-colors"})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-black/50 backdrop-blur-sm transition-opacity",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold text-gray-800 text-lg",children:a("users.email_overlay.sending")||"Sending Email..."}),e.jsx("p",{className:"text-sm text-gray-500",children:a("users.email_overlay.wait")||"Please wait while we process your request."})]}),e.jsx("button",{onClick:()=>x(!1),className:"mt-2 text-xs text-gray-400 hover:text-gray-600 underline",children:a("users.email_overlay.hide")||"Cancel"})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in zoom-in duration-300",children:[e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-50 mb-4",children:e.jsx("svg",{className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-gray-800",children:a("users.email_modal.title")||"Send Email Template"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a("users.email_modal.subtitle")||"Send message to"," ",e.jsx("span",{className:"font-bold text-gray-700",children:d?.name})]})]}),e.jsxs("div",{className:"space-y-2 text-left mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:a("users.email_modal.label_template")||"Choose Email Template"}),e.jsxs("select",{value:m,onChange:s=>T(s.target.value),className:"w-full border border-gray-200 rounded-xl p-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:a("users.email_modal.choose_template")||"-- Choose Template --"}),_.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.subject]},s.id))]})]}),e.jsxs("div",{className:"mt-4 px-4 py-2 bg-blue-50/50 rounded-lg border border-blue-100 flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 animate-pulse"}),e.jsx("span",{className:"text-blue-700 text-[11px] font-bold truncate uppercase",children:d?.email})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row p-4 gap-3 bg-gray-50",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-4 py-3 text-gray-500 font-bold hover:bg-white rounded-xl transition-all border border-transparent hover:border-gray-200",children:a("users.email_modal.btn_cancel")||"Cancel"}),e.jsx("button",{onClick:O,className:"flex-1 px-4 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all",children:a("users.email_modal.btn_send")||"Send Email"})]})]})}),e.jsx(R,{title:a("users.title")}),e.jsxs("div",{className:"px-4 sm:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a("users.title")}),M&&e.jsxs($,{onClick:U,className:"w-full sm:w-auto px-5 py-2.5 text-white text-sm font-medium rounded-lg hover:bg-[#004d47] transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:a("users.button_add")})]})]}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"-mx-4 sm:mx-0 px-4 sm:px-0 overflow-x-auto",children:e.jsx("div",{className:"min-w-[720px]",children:e.jsx(W,{data:P,columns:L,onSendEmail:s=>H(s),onEdit:j?A:null,onDelete:y?F:null,showAction:j||y})})})})]})]})}export{xe as default};
